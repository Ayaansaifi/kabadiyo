[{"filePath":"E:\\edrivekabadi\\kabadiwala\\android\\app\\build\\intermediates\\assets\\debug\\mergeDebugAssets\\native-bridge.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'nativeBridge' is assigned a value but never used.","line":5,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":17},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported).","line":36,"column":5,"severity":1,"nodeType":null,"fix":{"range":[1144,1171],"text":" "}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ignored' is defined but never used.","line":96,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":190,"column":25,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":190,"endColumn":176},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'no-prototype-builtins').","line":208,"column":29,"severity":1,"nodeType":null,"fix":{"range":[8158,8207],"text":" "}},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":296,"column":17,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":298,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":302,"column":17,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":302,"endColumn":159},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":306,"column":17,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":306,"endColumn":158},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":310,"column":17,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":310,"endColumn":154},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":365,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":365,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":848,"column":25,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":848,"endColumn":135},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":861,"column":25,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":861,"endColumn":135},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":918,"column":25,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":918,"endColumn":180},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":922,"column":21,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":922,"endColumn":131},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":979,"column":25,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":979,"endColumn":145},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":986,"column":21,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":986,"endColumn":131}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_pluginId' is defined but never used.","line":1010,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":1010,"endColumn":40,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_fn' is defined but never used.","line":1010,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":1010,"endColumn":45,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":2,"source":"\n/*! Capacitor: https://capacitorjs.com/ - MIT License */\n/* Generated File. Do not edit. */\n\nvar nativeBridge = (function (exports) {\n    'use strict';\n\n    var ExceptionCode;\n    (function (ExceptionCode) {\n        /**\n         * API is not implemented.\n         *\n         * This usually means the API can't be used because it is not implemented for\n         * the current platform.\n         */\n        ExceptionCode[\"Unimplemented\"] = \"UNIMPLEMENTED\";\n        /**\n         * API is not available.\n         *\n         * This means the API can't be used right now because:\n         *   - it is currently missing a prerequisite, such as network connectivity\n         *   - it requires a particular platform or browser version\n         */\n        ExceptionCode[\"Unavailable\"] = \"UNAVAILABLE\";\n    })(ExceptionCode || (ExceptionCode = {}));\n    class CapacitorException extends Error {\n        constructor(message, code, data) {\n            super(message);\n            this.message = message;\n            this.code = code;\n            this.data = data;\n        }\n    }\n\n    // For removing exports for iOS/Android, keep let for reassignment\n    // eslint-disable-next-line\n    let dummy = {};\n    const readFileAsBase64 = (file) => new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onloadend = () => {\n            const data = reader.result;\n            resolve(btoa(data));\n        };\n        reader.onerror = reject;\n        reader.readAsBinaryString(file);\n    });\n    const convertFormData = async (formData) => {\n        const newFormData = [];\n        for (const pair of formData.entries()) {\n            const [key, value] = pair;\n            if (value instanceof File) {\n                const base64File = await readFileAsBase64(value);\n                newFormData.push({\n                    key,\n                    value: base64File,\n                    type: 'base64File',\n                    contentType: value.type,\n                    fileName: value.name,\n                });\n            }\n            else {\n                newFormData.push({ key, value, type: 'string' });\n            }\n        }\n        return newFormData;\n    };\n    const convertBody = async (body, contentType) => {\n        if (body instanceof ReadableStream || body instanceof Uint8Array) {\n            let encodedData;\n            if (body instanceof ReadableStream) {\n                const reader = body.getReader();\n                const chunks = [];\n                while (true) {\n                    const { done, value } = await reader.read();\n                    if (done)\n                        break;\n                    chunks.push(value);\n                }\n                const concatenated = new Uint8Array(chunks.reduce((acc, chunk) => acc + chunk.length, 0));\n                let position = 0;\n                for (const chunk of chunks) {\n                    concatenated.set(chunk, position);\n                    position += chunk.length;\n                }\n                encodedData = concatenated;\n            }\n            else {\n                encodedData = body;\n            }\n            let data = new TextDecoder().decode(encodedData);\n            let type;\n            if (contentType === 'application/json') {\n                try {\n                    data = JSON.parse(data);\n                }\n                catch (ignored) {\n                    // ignore\n                }\n                type = 'json';\n            }\n            else if (contentType === 'multipart/form-data') {\n                type = 'formData';\n            }\n            else if (contentType === null || contentType === void 0 ? void 0 : contentType.startsWith('image')) {\n                type = 'image';\n            }\n            else if (contentType === 'application/octet-stream') {\n                type = 'binary';\n            }\n            else {\n                type = 'text';\n            }\n            return {\n                data,\n                type,\n                headers: { 'Content-Type': contentType || 'application/octet-stream' },\n            };\n        }\n        else if (body instanceof URLSearchParams) {\n            return {\n                data: body.toString(),\n                type: 'text',\n            };\n        }\n        else if (body instanceof FormData) {\n            return {\n                data: await convertFormData(body),\n                type: 'formData',\n            };\n        }\n        else if (body instanceof File) {\n            const fileData = await readFileAsBase64(body);\n            return {\n                data: fileData,\n                type: 'file',\n                headers: { 'Content-Type': body.type },\n            };\n        }\n        return { data: body, type: 'json' };\n    };\n    const CAPACITOR_HTTP_INTERCEPTOR = '/_capacitor_http_interceptor_';\n    const CAPACITOR_HTTP_INTERCEPTOR_URL_PARAM = 'u';\n    // TODO: export as Cap function\n    const isRelativeOrProxyUrl = (url) => !url || !(url.startsWith('http:') || url.startsWith('https:')) || url.indexOf(CAPACITOR_HTTP_INTERCEPTOR) > -1;\n    // TODO: export as Cap function\n    const createProxyUrl = (url, win) => {\n        var _a, _b;\n        if (isRelativeOrProxyUrl(url))\n            return url;\n        const bridgeUrl = new URL((_b = (_a = win.Capacitor) === null || _a === void 0 ? void 0 : _a.getServerUrl()) !== null && _b !== void 0 ? _b : '');\n        bridgeUrl.pathname = CAPACITOR_HTTP_INTERCEPTOR;\n        bridgeUrl.searchParams.append(CAPACITOR_HTTP_INTERCEPTOR_URL_PARAM, url);\n        return bridgeUrl.toString();\n    };\n    const initBridge = (w) => {\n        const getPlatformId = (win) => {\n            var _a, _b;\n            if (win === null || win === void 0 ? void 0 : win.androidBridge) {\n                return 'android';\n            }\n            else if ((_b = (_a = win === null || win === void 0 ? void 0 : win.webkit) === null || _a === void 0 ? void 0 : _a.messageHandlers) === null || _b === void 0 ? void 0 : _b.bridge) {\n                return 'ios';\n            }\n            else {\n                return 'web';\n            }\n        };\n        const convertFileSrcServerUrl = (webviewServerUrl, filePath) => {\n            if (typeof filePath === 'string') {\n                if (filePath.startsWith('/')) {\n                    return webviewServerUrl + '/_capacitor_file_' + filePath;\n                }\n                else if (filePath.startsWith('file://')) {\n                    return webviewServerUrl + filePath.replace('file://', '/_capacitor_file_');\n                }\n                else if (filePath.startsWith('content://')) {\n                    return webviewServerUrl + filePath.replace('content:/', '/_capacitor_content_');\n                }\n            }\n            return filePath;\n        };\n        const initEvents = (win, cap) => {\n            cap.addListener = (pluginName, eventName, callback) => {\n                const callbackId = cap.nativeCallback(pluginName, 'addListener', {\n                    eventName: eventName,\n                }, callback);\n                return {\n                    remove: async () => {\n                        var _a;\n                        (_a = win === null || win === void 0 ? void 0 : win.console) === null || _a === void 0 ? void 0 : _a.debug('Removing listener', pluginName, eventName);\n                        cap.removeListener(pluginName, callbackId, eventName, callback);\n                    },\n                };\n            };\n            cap.removeListener = (pluginName, callbackId, eventName, callback) => {\n                cap.nativeCallback(pluginName, 'removeListener', {\n                    callbackId: callbackId,\n                    eventName: eventName,\n                }, callback);\n            };\n            cap.createEvent = (eventName, eventData) => {\n                const doc = win.document;\n                if (doc) {\n                    const ev = doc.createEvent('Events');\n                    ev.initEvent(eventName, false, false);\n                    if (eventData && typeof eventData === 'object') {\n                        for (const i in eventData) {\n                            // eslint-disable-next-line no-prototype-builtins\n                            if (eventData.hasOwnProperty(i)) {\n                                ev[i] = eventData[i];\n                            }\n                        }\n                    }\n                    return ev;\n                }\n                return null;\n            };\n            cap.triggerEvent = (eventName, target, eventData) => {\n                const doc = win.document;\n                const cordova = win.cordova;\n                eventData = eventData || {};\n                const ev = cap.createEvent(eventName, eventData);\n                if (ev) {\n                    if (target === 'document') {\n                        if (cordova === null || cordova === void 0 ? void 0 : cordova.fireDocumentEvent) {\n                            cordova.fireDocumentEvent(eventName, eventData);\n                            return true;\n                        }\n                        else if (doc === null || doc === void 0 ? void 0 : doc.dispatchEvent) {\n                            return doc.dispatchEvent(ev);\n                        }\n                    }\n                    else if (target === 'window' && win.dispatchEvent) {\n                        return win.dispatchEvent(ev);\n                    }\n                    else if (doc === null || doc === void 0 ? void 0 : doc.querySelector) {\n                        const targetEl = doc.querySelector(target);\n                        if (targetEl) {\n                            return targetEl.dispatchEvent(ev);\n                        }\n                    }\n                }\n                return false;\n            };\n            win.Capacitor = cap;\n        };\n        const initLegacyHandlers = (win, cap) => {\n            // define cordova if it's not there already\n            win.cordova = win.cordova || {};\n            const doc = win.document;\n            const nav = win.navigator;\n            if (nav) {\n                nav.app = nav.app || {};\n                nav.app.exitApp = () => {\n                    var _a;\n                    if (!((_a = cap.Plugins) === null || _a === void 0 ? void 0 : _a.App)) {\n                        win.console.warn('App plugin not installed');\n                    }\n                    else {\n                        cap.nativeCallback('App', 'exitApp', {});\n                    }\n                };\n            }\n            if (doc) {\n                const docAddEventListener = doc.addEventListener;\n                doc.addEventListener = (...args) => {\n                    var _a;\n                    const eventName = args[0];\n                    const handler = args[1];\n                    if (eventName === 'deviceready' && handler) {\n                        Promise.resolve().then(handler);\n                    }\n                    else if (eventName === 'backbutton' && cap.Plugins.App) {\n                        // Add a dummy listener so Capacitor doesn't do the default\n                        // back button action\n                        if (!((_a = cap.Plugins) === null || _a === void 0 ? void 0 : _a.App)) {\n                            win.console.warn('App plugin not installed');\n                        }\n                        else {\n                            cap.Plugins.App.addListener('backButton', () => {\n                                // ignore\n                            });\n                        }\n                    }\n                    return docAddEventListener.apply(doc, args);\n                };\n            }\n            win.Capacitor = cap;\n        };\n        const initVendor = (win, cap) => {\n            const Ionic = (win.Ionic = win.Ionic || {});\n            const IonicWebView = (Ionic.WebView = Ionic.WebView || {});\n            const Plugins = cap.Plugins;\n            IonicWebView.getServerBasePath = (callback) => {\n                var _a;\n                (_a = Plugins === null || Plugins === void 0 ? void 0 : Plugins.WebView) === null || _a === void 0 ? void 0 : _a.getServerBasePath().then((result) => {\n                    callback(result.path);\n                });\n            };\n            IonicWebView.setServerAssetPath = (path) => {\n                var _a;\n                (_a = Plugins === null || Plugins === void 0 ? void 0 : Plugins.WebView) === null || _a === void 0 ? void 0 : _a.setServerAssetPath({ path });\n            };\n            IonicWebView.setServerBasePath = (path) => {\n                var _a;\n                (_a = Plugins === null || Plugins === void 0 ? void 0 : Plugins.WebView) === null || _a === void 0 ? void 0 : _a.setServerBasePath({ path });\n            };\n            IonicWebView.persistServerBasePath = () => {\n                var _a;\n                (_a = Plugins === null || Plugins === void 0 ? void 0 : Plugins.WebView) === null || _a === void 0 ? void 0 : _a.persistServerBasePath();\n            };\n            IonicWebView.convertFileSrc = (url) => cap.convertFileSrc(url);\n            win.Capacitor = cap;\n            win.Ionic.WebView = IonicWebView;\n        };\n        const initLogger = (win, cap) => {\n            const BRIDGED_CONSOLE_METHODS = ['debug', 'error', 'info', 'log', 'trace', 'warn'];\n            const createLogFromNative = (c) => (result) => {\n                if (isFullConsole(c)) {\n                    const success = result.success === true;\n                    const tagStyles = success\n                        ? 'font-style: italic; font-weight: lighter; color: gray'\n                        : 'font-style: italic; font-weight: lighter; color: red';\n                    c.groupCollapsed('%cresult %c' + result.pluginId + '.' + result.methodName + ' (#' + result.callbackId + ')', tagStyles, 'font-style: italic; font-weight: bold; color: #444');\n                    if (result.success === false) {\n                        c.error(result.error);\n                    }\n                    else {\n                        c.dir(JSON.stringify(result.data));\n                    }\n                    c.groupEnd();\n                }\n                else {\n                    if (result.success === false) {\n                        c.error('LOG FROM NATIVE', result.error);\n                    }\n                    else {\n                        c.log('LOG FROM NATIVE', result.data);\n                    }\n                }\n            };\n            const createLogToNative = (c) => (call) => {\n                if (isFullConsole(c)) {\n                    c.groupCollapsed('%cnative %c' + call.pluginId + '.' + call.methodName + ' (#' + call.callbackId + ')', 'font-weight: lighter; color: gray', 'font-weight: bold; color: #000');\n                    c.dir(call);\n                    c.groupEnd();\n                }\n                else {\n                    c.log('LOG TO NATIVE: ', call);\n                }\n            };\n            const isFullConsole = (c) => {\n                if (!c) {\n                    return false;\n                }\n                return typeof c.groupCollapsed === 'function' || typeof c.groupEnd === 'function' || typeof c.dir === 'function';\n            };\n            const serializeConsoleMessage = (msg) => {\n                try {\n                    if (typeof msg === 'object') {\n                        msg = JSON.stringify(msg);\n                    }\n                    return String(msg);\n                }\n                catch (e) {\n                    return '';\n                }\n            };\n            const platform = getPlatformId(win);\n            if (platform == 'android' && typeof win.CapacitorSystemBarsAndroidInterface !== 'undefined') {\n                // add DOM ready listener for System Bars\n                document.addEventListener('DOMContentLoaded', function () {\n                    win.CapacitorSystemBarsAndroidInterface.onDOMReady();\n                });\n            }\n            if (platform == 'android' || platform == 'ios') {\n                // patch document.cookie on Android/iOS\n                win.CapacitorCookiesDescriptor =\n                    Object.getOwnPropertyDescriptor(Document.prototype, 'cookie') ||\n                        Object.getOwnPropertyDescriptor(HTMLDocument.prototype, 'cookie');\n                let doPatchCookies = false;\n                // check if capacitor cookies is disabled before patching\n                if (platform === 'ios') {\n                    // Use prompt to synchronously get capacitor cookies config.\n                    // https://stackoverflow.com/questions/29249132/wkwebview-complex-communication-between-javascript-native-code/49474323#49474323\n                    const payload = {\n                        type: 'CapacitorCookies.isEnabled',\n                    };\n                    const isCookiesEnabled = prompt(JSON.stringify(payload));\n                    if (isCookiesEnabled === 'true') {\n                        doPatchCookies = true;\n                    }\n                }\n                else if (typeof win.CapacitorCookiesAndroidInterface !== 'undefined') {\n                    const isCookiesEnabled = win.CapacitorCookiesAndroidInterface.isEnabled();\n                    if (isCookiesEnabled === true) {\n                        doPatchCookies = true;\n                    }\n                }\n                if (doPatchCookies) {\n                    Object.defineProperty(document, 'cookie', {\n                        get: function () {\n                            var _a, _b, _c;\n                            if (platform === 'ios') {\n                                // Use prompt to synchronously get cookies.\n                                // https://stackoverflow.com/questions/29249132/wkwebview-complex-communication-between-javascript-native-code/49474323#49474323\n                                const payload = {\n                                    type: 'CapacitorCookies.get',\n                                };\n                                const res = prompt(JSON.stringify(payload));\n                                return res;\n                            }\n                            else if (typeof win.CapacitorCookiesAndroidInterface !== 'undefined') {\n                                // return original document.cookie since Android does not support filtering of `httpOnly` cookies\n                                return (_c = (_b = (_a = win.CapacitorCookiesDescriptor) === null || _a === void 0 ? void 0 : _a.get) === null || _b === void 0 ? void 0 : _b.call(document)) !== null && _c !== void 0 ? _c : '';\n                            }\n                        },\n                        set: function (val) {\n                            const cookiePairs = val.split(';');\n                            const domainSection = val.toLowerCase().split('domain=')[1];\n                            const domain = cookiePairs.length > 1 && domainSection != null && domainSection.length > 0\n                                ? domainSection.split(';')[0].trim()\n                                : '';\n                            if (platform === 'ios') {\n                                // Use prompt to synchronously set cookies.\n                                // https://stackoverflow.com/questions/29249132/wkwebview-complex-communication-between-javascript-native-code/49474323#49474323\n                                const payload = {\n                                    type: 'CapacitorCookies.set',\n                                    action: val,\n                                    domain,\n                                };\n                                prompt(JSON.stringify(payload));\n                            }\n                            else if (typeof win.CapacitorCookiesAndroidInterface !== 'undefined') {\n                                win.CapacitorCookiesAndroidInterface.setCookie(domain, val);\n                            }\n                        },\n                    });\n                }\n                // patch fetch / XHR on Android/iOS\n                // store original fetch & XHR functions\n                win.CapacitorWebFetch = window.fetch;\n                win.CapacitorWebXMLHttpRequest = {\n                    abort: window.XMLHttpRequest.prototype.abort,\n                    constructor: window.XMLHttpRequest.prototype.constructor,\n                    fullObject: window.XMLHttpRequest,\n                    getAllResponseHeaders: window.XMLHttpRequest.prototype.getAllResponseHeaders,\n                    getResponseHeader: window.XMLHttpRequest.prototype.getResponseHeader,\n                    open: window.XMLHttpRequest.prototype.open,\n                    prototype: window.XMLHttpRequest.prototype,\n                    send: window.XMLHttpRequest.prototype.send,\n                    setRequestHeader: window.XMLHttpRequest.prototype.setRequestHeader,\n                };\n                let doPatchHttp = false;\n                // check if capacitor http is disabled before patching\n                if (platform === 'ios') {\n                    // Use prompt to synchronously get capacitor http config.\n                    // https://stackoverflow.com/questions/29249132/wkwebview-complex-communication-between-javascript-native-code/49474323#49474323\n                    const payload = {\n                        type: 'CapacitorHttp',\n                    };\n                    const isHttpEnabled = prompt(JSON.stringify(payload));\n                    if (isHttpEnabled === 'true') {\n                        doPatchHttp = true;\n                    }\n                }\n                else if (typeof win.CapacitorHttpAndroidInterface !== 'undefined') {\n                    const isHttpEnabled = win.CapacitorHttpAndroidInterface.isEnabled();\n                    if (isHttpEnabled === true) {\n                        doPatchHttp = true;\n                    }\n                }\n                if (doPatchHttp) {\n                    // fetch patch\n                    window.fetch = async (resource, options) => {\n                        const headers = new Headers(options === null || options === void 0 ? void 0 : options.headers);\n                        const contentType = headers.get('Content-Type') || headers.get('content-type');\n                        if ((options === null || options === void 0 ? void 0 : options.body) instanceof FormData &&\n                            (contentType === null || contentType === void 0 ? void 0 : contentType.includes('multipart/form-data')) &&\n                            !contentType.includes('boundary')) {\n                            headers.delete('Content-Type');\n                            headers.delete('content-type');\n                            options.headers = headers;\n                        }\n                        const request = new Request(resource, options);\n                        if (request.url.startsWith(`${cap.getServerUrl()}/`)) {\n                            return win.CapacitorWebFetch(resource, options);\n                        }\n                        const { method } = request;\n                        if (method.toLocaleUpperCase() === 'GET' ||\n                            method.toLocaleUpperCase() === 'HEAD' ||\n                            method.toLocaleUpperCase() === 'OPTIONS' ||\n                            method.toLocaleUpperCase() === 'TRACE') {\n                            // a workaround for following android webview issue:\n                            // https://issues.chromium.org/issues/40450316\n                            // Sets the user-agent header to a custom value so that its not stripped\n                            // on its way to the native layer\n                            if (platform === 'android' && (options === null || options === void 0 ? void 0 : options.headers)) {\n                                const userAgent = headers.get('User-Agent') || headers.get('user-agent');\n                                if (userAgent !== null) {\n                                    headers.set('x-cap-user-agent', userAgent);\n                                    options.headers = headers;\n                                }\n                            }\n                            if (typeof resource === 'string') {\n                                return await win.CapacitorWebFetch(createProxyUrl(resource, win), options);\n                            }\n                            else if (resource instanceof Request) {\n                                const modifiedRequest = new Request(createProxyUrl(resource.url, win), resource);\n                                return await win.CapacitorWebFetch(modifiedRequest, options);\n                            }\n                        }\n                        const tag = `CapacitorHttp fetch ${Date.now()} ${resource}`;\n                        console.time(tag);\n                        try {\n                            const { body } = request;\n                            const optionHeaders = Object.fromEntries(request.headers.entries());\n                            const { data: requestData, type, headers: requestHeaders, } = await convertBody((options === null || options === void 0 ? void 0 : options.body) || body || undefined, optionHeaders['Content-Type'] || optionHeaders['content-type']);\n                            const nativeHeaders = Object.assign(Object.assign({}, requestHeaders), optionHeaders);\n                            if (platform === 'android') {\n                                if (headers.has('User-Agent')) {\n                                    nativeHeaders['User-Agent'] = headers.get('User-Agent');\n                                }\n                                if (headers.has('user-agent')) {\n                                    nativeHeaders['user-agent'] = headers.get('user-agent');\n                                }\n                            }\n                            const nativeResponse = await cap.nativePromise('CapacitorHttp', 'request', {\n                                url: request.url,\n                                method: method,\n                                data: requestData,\n                                dataType: type,\n                                headers: nativeHeaders,\n                            });\n                            const contentType = nativeResponse.headers['Content-Type'] || nativeResponse.headers['content-type'];\n                            let data = (contentType === null || contentType === void 0 ? void 0 : contentType.startsWith('application/json'))\n                                ? JSON.stringify(nativeResponse.data)\n                                : nativeResponse.data;\n                            // use null data for 204 No Content HTTP response\n                            if (nativeResponse.status === 204) {\n                                data = null;\n                            }\n                            // intercept & parse response before returning\n                            const response = new Response(data, {\n                                headers: nativeResponse.headers,\n                                status: nativeResponse.status,\n                            });\n                            /*\n                             * copy url to response, `cordova-plugin-ionic` uses this url from the response\n                             * we need `Object.defineProperty` because url is an inherited getter on the Response\n                             * see: https://stackoverflow.com/a/57382543\n                             * */\n                            Object.defineProperty(response, 'url', {\n                                value: nativeResponse.url,\n                            });\n                            console.timeEnd(tag);\n                            return response;\n                        }\n                        catch (error) {\n                            console.timeEnd(tag);\n                            return Promise.reject(error);\n                        }\n                    };\n                    window.XMLHttpRequest = function () {\n                        const xhr = new win.CapacitorWebXMLHttpRequest.constructor();\n                        Object.defineProperties(xhr, {\n                            _headers: {\n                                value: {},\n                                writable: true,\n                            },\n                            _method: {\n                                value: xhr.method,\n                                writable: true,\n                            },\n                        });\n                        const prototype = win.CapacitorWebXMLHttpRequest.prototype;\n                        const isProgressEventAvailable = () => typeof ProgressEvent !== 'undefined' && ProgressEvent.prototype instanceof Event;\n                        // XHR patch abort\n                        prototype.abort = function () {\n                            if (isRelativeOrProxyUrl(this._url)) {\n                                return win.CapacitorWebXMLHttpRequest.abort.call(this);\n                            }\n                            this.readyState = 0;\n                            setTimeout(() => {\n                                this.dispatchEvent(new Event('abort'));\n                                this.dispatchEvent(new Event('loadend'));\n                            });\n                        };\n                        // XHR patch open\n                        prototype.open = function (method, url) {\n                            this._method = method.toLocaleUpperCase();\n                            this._url = url;\n                            if (!this._method ||\n                                this._method === 'GET' ||\n                                this._method === 'HEAD' ||\n                                this._method === 'OPTIONS' ||\n                                this._method === 'TRACE') {\n                                if (isRelativeOrProxyUrl(url)) {\n                                    return win.CapacitorWebXMLHttpRequest.open.call(this, method, url);\n                                }\n                                this._url = createProxyUrl(this._url, win);\n                                return win.CapacitorWebXMLHttpRequest.open.call(this, method, this._url);\n                            }\n                            Object.defineProperties(this, {\n                                readyState: {\n                                    get: function () {\n                                        var _a;\n                                        return (_a = this._readyState) !== null && _a !== void 0 ? _a : 0;\n                                    },\n                                    set: function (val) {\n                                        this._readyState = val;\n                                        setTimeout(() => {\n                                            this.dispatchEvent(new Event('readystatechange'));\n                                        });\n                                    },\n                                },\n                            });\n                            setTimeout(() => {\n                                this.dispatchEvent(new Event('loadstart'));\n                            });\n                            this.readyState = 1;\n                        };\n                        // XHR patch set request header\n                        prototype.setRequestHeader = function (header, value) {\n                            // a workaround for the following android web view issue:\n                            // https://issues.chromium.org/issues/40450316\n                            // Sets the user-agent header to a custom value so that its not stripped\n                            // on its way to the native layer\n                            if (platform === 'android' && (header === 'User-Agent' || header === 'user-agent')) {\n                                header = 'x-cap-user-agent';\n                            }\n                            if (isRelativeOrProxyUrl(this._url)) {\n                                return win.CapacitorWebXMLHttpRequest.setRequestHeader.call(this, header, value);\n                            }\n                            this._headers[header] = value;\n                        };\n                        // XHR patch send\n                        prototype.send = function (body) {\n                            if (isRelativeOrProxyUrl(this._url)) {\n                                return win.CapacitorWebXMLHttpRequest.send.call(this, body);\n                            }\n                            const tag = `CapacitorHttp XMLHttpRequest ${Date.now()} ${this._url}`;\n                            console.time(tag);\n                            try {\n                                this.readyState = 2;\n                                Object.defineProperties(this, {\n                                    response: {\n                                        value: '',\n                                        writable: true,\n                                    },\n                                    responseText: {\n                                        value: '',\n                                        writable: true,\n                                    },\n                                    responseURL: {\n                                        value: '',\n                                        writable: true,\n                                    },\n                                    status: {\n                                        value: 0,\n                                        writable: true,\n                                    },\n                                });\n                                convertBody(body).then(({ data, type, headers }) => {\n                                    let otherHeaders = this._headers != null && Object.keys(this._headers).length > 0 ? this._headers : undefined;\n                                    if (body instanceof FormData) {\n                                        if (!this._headers['Content-Type'] && !this._headers['content-type']) {\n                                            otherHeaders = Object.assign(Object.assign({}, otherHeaders), { 'Content-Type': `multipart/form-data; boundary=----WebKitFormBoundary${Math.random().toString(36).substring(2, 15)}` });\n                                        }\n                                    }\n                                    // intercept request & pass to the bridge\n                                    cap\n                                        .nativePromise('CapacitorHttp', 'request', {\n                                        url: this._url,\n                                        method: this._method,\n                                        data: data !== null ? data : undefined,\n                                        headers: Object.assign(Object.assign({}, headers), otherHeaders),\n                                        dataType: type,\n                                    })\n                                        .then((nativeResponse) => {\n                                        var _a;\n                                        // intercept & parse response before returning\n                                        if (this.readyState == 2) {\n                                            //TODO: Add progress event emission on native side\n                                            if (isProgressEventAvailable()) {\n                                                this.dispatchEvent(new ProgressEvent('progress', {\n                                                    lengthComputable: true,\n                                                    loaded: nativeResponse.data.length,\n                                                    total: nativeResponse.data.length,\n                                                }));\n                                            }\n                                            this._headers = nativeResponse.headers;\n                                            this.status = nativeResponse.status;\n                                            if (this.responseType === '' || this.responseType === 'text') {\n                                                this.response =\n                                                    typeof nativeResponse.data !== 'string'\n                                                        ? JSON.stringify(nativeResponse.data)\n                                                        : nativeResponse.data;\n                                            }\n                                            else {\n                                                this.response = nativeResponse.data;\n                                            }\n                                            this.responseText = ((_a = (nativeResponse.headers['Content-Type'] || nativeResponse.headers['content-type'])) === null || _a === void 0 ? void 0 : _a.startsWith('application/json'))\n                                                ? JSON.stringify(nativeResponse.data)\n                                                : nativeResponse.data;\n                                            this.responseURL = nativeResponse.url;\n                                            this.readyState = 4;\n                                            setTimeout(() => {\n                                                this.dispatchEvent(new Event('load'));\n                                                this.dispatchEvent(new Event('loadend'));\n                                            });\n                                        }\n                                        console.timeEnd(tag);\n                                    })\n                                        .catch((error) => {\n                                        this.status = error.status;\n                                        this._headers = error.headers;\n                                        this.response = error.data;\n                                        this.responseText = JSON.stringify(error.data);\n                                        this.responseURL = error.url;\n                                        this.readyState = 4;\n                                        if (isProgressEventAvailable()) {\n                                            this.dispatchEvent(new ProgressEvent('progress', {\n                                                lengthComputable: false,\n                                                loaded: 0,\n                                                total: 0,\n                                            }));\n                                        }\n                                        setTimeout(() => {\n                                            this.dispatchEvent(new Event('error'));\n                                            this.dispatchEvent(new Event('loadend'));\n                                        });\n                                        console.timeEnd(tag);\n                                    });\n                                });\n                            }\n                            catch (error) {\n                                this.status = 500;\n                                this._headers = {};\n                                this.response = error;\n                                this.responseText = error.toString();\n                                this.responseURL = this._url;\n                                this.readyState = 4;\n                                if (isProgressEventAvailable()) {\n                                    this.dispatchEvent(new ProgressEvent('progress', {\n                                        lengthComputable: false,\n                                        loaded: 0,\n                                        total: 0,\n                                    }));\n                                }\n                                setTimeout(() => {\n                                    this.dispatchEvent(new Event('error'));\n                                    this.dispatchEvent(new Event('loadend'));\n                                });\n                                console.timeEnd(tag);\n                            }\n                        };\n                        // XHR patch getAllResponseHeaders\n                        prototype.getAllResponseHeaders = function () {\n                            if (isRelativeOrProxyUrl(this._url)) {\n                                return win.CapacitorWebXMLHttpRequest.getAllResponseHeaders.call(this);\n                            }\n                            let returnString = '';\n                            for (const key in this._headers) {\n                                if (key != 'Set-Cookie') {\n                                    returnString += key + ': ' + this._headers[key] + '\\r\\n';\n                                }\n                            }\n                            return returnString;\n                        };\n                        // XHR patch getResponseHeader\n                        prototype.getResponseHeader = function (name) {\n                            if (isRelativeOrProxyUrl(this._url)) {\n                                return win.CapacitorWebXMLHttpRequest.getResponseHeader.call(this, name);\n                            }\n                            return this._headers[name];\n                        };\n                        Object.setPrototypeOf(xhr, prototype);\n                        return xhr;\n                    };\n                    Object.assign(window.XMLHttpRequest, win.CapacitorWebXMLHttpRequest.fullObject);\n                }\n            }\n            // patch window.console on iOS and store original console fns\n            const isIos = getPlatformId(win) === 'ios';\n            if (win.console && isIos) {\n                Object.defineProperties(win.console, BRIDGED_CONSOLE_METHODS.reduce((props, method) => {\n                    const consoleMethod = win.console[method].bind(win.console);\n                    props[method] = {\n                        value: (...args) => {\n                            const msgs = [...args];\n                            cap.toNative('Console', 'log', {\n                                level: method,\n                                message: msgs.map(serializeConsoleMessage).join(' '),\n                            });\n                            return consoleMethod(...args);\n                        },\n                    };\n                    return props;\n                }, {}));\n            }\n            cap.logJs = (msg, level) => {\n                switch (level) {\n                    case 'error':\n                        win.console.error(msg);\n                        break;\n                    case 'warn':\n                        win.console.warn(msg);\n                        break;\n                    case 'info':\n                        win.console.info(msg);\n                        break;\n                    default:\n                        win.console.log(msg);\n                }\n            };\n            cap.logToNative = createLogToNative(win.console);\n            cap.logFromNative = createLogFromNative(win.console);\n            cap.handleError = (err) => win.console.error(err);\n            win.Capacitor = cap;\n        };\n        function initNativeBridge(win) {\n            const cap = win.Capacitor || {};\n            // keep a collection of callbacks for native response data\n            const callbacks = new Map();\n            const webviewServerUrl = typeof win.WEBVIEW_SERVER_URL === 'string' ? win.WEBVIEW_SERVER_URL : '';\n            cap.getServerUrl = () => webviewServerUrl;\n            cap.convertFileSrc = (filePath) => convertFileSrcServerUrl(webviewServerUrl, filePath);\n            // Counter of callback ids, randomized to avoid\n            // any issues during reloads if a call comes back with\n            // an existing callback id from an old session\n            let callbackIdCount = Math.floor(Math.random() * 134217728);\n            let postToNative = null;\n            const isNativePlatform = () => true;\n            const getPlatform = () => getPlatformId(win);\n            cap.getPlatform = getPlatform;\n            cap.isPluginAvailable = (name) => Object.prototype.hasOwnProperty.call(cap.Plugins, name);\n            cap.isNativePlatform = isNativePlatform;\n            // create the postToNative() fn if needed\n            if (getPlatformId(win) === 'android') {\n                // android platform\n                postToNative = (data) => {\n                    var _a;\n                    try {\n                        win.androidBridge.postMessage(JSON.stringify(data));\n                    }\n                    catch (e) {\n                        (_a = win === null || win === void 0 ? void 0 : win.console) === null || _a === void 0 ? void 0 : _a.error(e);\n                    }\n                };\n            }\n            else if (getPlatformId(win) === 'ios') {\n                // ios platform\n                postToNative = (data) => {\n                    var _a;\n                    try {\n                        data.type = data.type ? data.type : 'message';\n                        win.webkit.messageHandlers.bridge.postMessage(data);\n                    }\n                    catch (e) {\n                        (_a = win === null || win === void 0 ? void 0 : win.console) === null || _a === void 0 ? void 0 : _a.error(e);\n                    }\n                };\n            }\n            cap.handleWindowError = (msg, url, lineNo, columnNo, err) => {\n                const str = msg.toLowerCase();\n                if (str.indexOf('script error') > -1) ;\n                else {\n                    const errObj = {\n                        type: 'js.error',\n                        error: {\n                            message: msg,\n                            url: url,\n                            line: lineNo,\n                            col: columnNo,\n                            errorObject: JSON.stringify(err),\n                        },\n                    };\n                    if (err !== null) {\n                        cap.handleError(err);\n                    }\n                    postToNative(errObj);\n                }\n                return false;\n            };\n            if (cap.DEBUG) {\n                window.onerror = cap.handleWindowError;\n            }\n            initLogger(win, cap);\n            /**\n             * Send a plugin method call to the native layer\n             */\n            cap.toNative = (pluginName, methodName, options, storedCallback) => {\n                var _a, _b;\n                try {\n                    if (typeof postToNative === 'function') {\n                        let callbackId = '-1';\n                        if (storedCallback &&\n                            (typeof storedCallback.callback === 'function' || typeof storedCallback.resolve === 'function')) {\n                            // store the call for later lookup\n                            callbackId = String(++callbackIdCount);\n                            callbacks.set(callbackId, storedCallback);\n                        }\n                        const callData = {\n                            callbackId: callbackId,\n                            pluginId: pluginName,\n                            methodName: methodName,\n                            options: options || {},\n                        };\n                        if (cap.isLoggingEnabled && pluginName !== 'Console') {\n                            cap.logToNative(callData);\n                        }\n                        // post the call data to native\n                        postToNative(callData);\n                        return callbackId;\n                    }\n                    else {\n                        (_a = win === null || win === void 0 ? void 0 : win.console) === null || _a === void 0 ? void 0 : _a.warn(`implementation unavailable for: ${pluginName}`);\n                    }\n                }\n                catch (e) {\n                    (_b = win === null || win === void 0 ? void 0 : win.console) === null || _b === void 0 ? void 0 : _b.error(e);\n                }\n                return null;\n            };\n            if (win === null || win === void 0 ? void 0 : win.androidBridge) {\n                win.androidBridge.onmessage = function (event) {\n                    returnResult(JSON.parse(event.data));\n                };\n            }\n            /**\n             * Process a response from the native layer.\n             */\n            cap.fromNative = (result) => {\n                returnResult(result);\n            };\n            const returnResult = (result) => {\n                var _a, _b;\n                if (cap.isLoggingEnabled && result.pluginId !== 'Console') {\n                    cap.logFromNative(result);\n                }\n                // get the stored call, if it exists\n                try {\n                    const storedCall = callbacks.get(result.callbackId);\n                    if (storedCall) {\n                        // looks like we've got a stored call\n                        if (result.error) {\n                            // ensure stacktraces by copying error properties to an Error\n                            result.error = Object.keys(result.error).reduce((err, key) => {\n                                // use any type to avoid importing util and compiling most of .ts files\n                                err[key] = result.error[key];\n                                return err;\n                            }, new cap.Exception(''));\n                        }\n                        if (typeof storedCall.callback === 'function') {\n                            // callback\n                            if (result.success) {\n                                storedCall.callback(result.data);\n                            }\n                            else {\n                                storedCall.callback(null, result.error);\n                            }\n                        }\n                        else if (typeof storedCall.resolve === 'function') {\n                            // promise\n                            if (result.success) {\n                                storedCall.resolve(result.data);\n                            }\n                            else {\n                                storedCall.reject(result.error);\n                            }\n                            // no need to keep this stored callback\n                            // around for a one time resolve promise\n                            callbacks.delete(result.callbackId);\n                        }\n                    }\n                    else if (!result.success && result.error) {\n                        // no stored callback, but if there was an error let's log it\n                        (_a = win === null || win === void 0 ? void 0 : win.console) === null || _a === void 0 ? void 0 : _a.warn(result.error);\n                    }\n                    if (result.save === false) {\n                        callbacks.delete(result.callbackId);\n                    }\n                }\n                catch (e) {\n                    (_b = win === null || win === void 0 ? void 0 : win.console) === null || _b === void 0 ? void 0 : _b.error(e);\n                }\n                // always delete to prevent memory leaks\n                // overkill but we're not sure what apps will do with this data\n                delete result.data;\n                delete result.error;\n            };\n            cap.nativeCallback = (pluginName, methodName, options, callback) => {\n                if (typeof options === 'function') {\n                    console.warn(`Using a callback as the 'options' parameter of 'nativeCallback()' is deprecated.`);\n                    callback = options;\n                    options = null;\n                }\n                return cap.toNative(pluginName, methodName, options, { callback });\n            };\n            cap.nativePromise = (pluginName, methodName, options) => {\n                return new Promise((resolve, reject) => {\n                    cap.toNative(pluginName, methodName, options, {\n                        resolve: resolve,\n                        reject: reject,\n                    });\n                });\n            };\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\n            cap.withPlugin = (_pluginId, _fn) => dummy;\n            cap.Exception = CapacitorException;\n            initEvents(win, cap);\n            initLegacyHandlers(win, cap);\n            initVendor(win, cap);\n            win.Capacitor = cap;\n        }\n        initNativeBridge(w);\n    };\n    initBridge(typeof globalThis !== 'undefined'\n        ? globalThis\n        : typeof self !== 'undefined'\n            ? self\n            : typeof window !== 'undefined'\n                ? window\n                : typeof global !== 'undefined'\n                    ? global\n                    : {});\n\n    dummy = initBridge;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n    return exports;\n\n})({});\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\android\\app\\build\\intermediates\\assets\\debug\\mergeDebugAssets\\public\\cordova.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\android\\app\\build\\intermediates\\assets\\debug\\mergeDebugAssets\\public\\cordova_plugins.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\android\\app\\build\\intermediates\\assets\\debug\\mergeDebugAssets\\public\\sw.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":80,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":80,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const CACHE_NAME = 'kabadiwala-v1';\r\nconst OFFLINE_URL = '/offline.html';\r\n\r\n// Files to cache for offline use\r\nconst STATIC_CACHE_URLS = [\r\n    '/',\r\n    '/manifest.json',\r\n    '/offline.html',\r\n    '/icons/icon-192x192.png',\r\n    '/icons/icon-512x512.png'\r\n];\r\n\r\n// Install event - cache static assets\r\nself.addEventListener('install', (event) => {\r\n    event.waitUntil(\r\n        caches.open(CACHE_NAME).then((cache) => {\r\n            console.log('Caching static assets');\r\n            return cache.addAll(STATIC_CACHE_URLS);\r\n        })\r\n    );\r\n    self.skipWaiting();\r\n});\r\n\r\n// Activate event - clean old caches\r\nself.addEventListener('activate', (event) => {\r\n    event.waitUntil(\r\n        caches.keys().then((cacheNames) => {\r\n            return Promise.all(\r\n                cacheNames\r\n                    .filter((name) => name !== CACHE_NAME)\r\n                    .map((name) => caches.delete(name))\r\n            );\r\n        })\r\n    );\r\n    self.clients.claim();\r\n});\r\n\r\n// Fetch event - network first, fallback to cache\r\nself.addEventListener('fetch', (event) => {\r\n    // Skip non-GET requests\r\n    if (event.request.method !== 'GET') return;\r\n\r\n    // Skip API requests\r\n    if (event.request.url.includes('/api/')) return;\r\n\r\n    event.respondWith(\r\n        fetch(event.request)\r\n            .then((response) => {\r\n                // Clone response and cache it\r\n                if (response.status === 200) {\r\n                    const responseClone = response.clone();\r\n                    caches.open(CACHE_NAME).then((cache) => {\r\n                        cache.put(event.request, responseClone);\r\n                    });\r\n                }\r\n                return response;\r\n            })\r\n            .catch(() => {\r\n                // Network failed, try cache\r\n                return caches.match(event.request).then((cachedResponse) => {\r\n                    if (cachedResponse) {\r\n                        return cachedResponse;\r\n                    }\r\n                    // Return offline page for navigation requests\r\n                    if (event.request.mode === 'navigate') {\r\n                        return caches.match(OFFLINE_URL);\r\n                    }\r\n                    return new Response('Offline', { status: 503 });\r\n                });\r\n            })\r\n    );\r\n});\r\n\r\n// Push notification handling\r\nself.addEventListener('push', (event) => {\r\n    let data = { title: 'Kabadiwala', body: 'New notification', url: '/dashboard', icon: '/icons/icon-192x192.png' };\r\n\r\n    try {\r\n        data = event.data.json();\r\n    } catch (e) {\r\n        data.body = event.data.text();\r\n    }\r\n\r\n    const options = {\r\n        body: data.body,\r\n        icon: data.icon,\r\n        badge: '/icons/badge.png',\r\n        vibrate: [100, 50, 100],\r\n        data: {\r\n            url: data.url\r\n        }\r\n    };\r\n\r\n    event.waitUntil(\r\n        self.registration.showNotification(data.title, options)\r\n    );\r\n});\r\n\r\n// Notification click handling\r\nself.addEventListener('notificationclick', (event) => {\r\n    event.notification.close();\r\n\r\n    if (event.notification.data && event.notification.data.url) {\r\n        event.waitUntil(\r\n            clients.openWindow(event.notification.data.url)\r\n        );\r\n    } else {\r\n        event.waitUntil(\r\n            clients.openWindow('/dashboard')\r\n        );\r\n    }\r\n});\r\n\r\n// Background sync for offline actions\r\nself.addEventListener('sync', (event) => {\r\n    if (event.tag === 'sync-orders') {\r\n        event.waitUntil(syncOfflineOrders());\r\n    }\r\n});\r\n\r\nasync function syncOfflineOrders() {\r\n    // Sync pending orders when back online\r\n    console.log('Syncing offline orders...');\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\android\\app\\src\\main\\assets\\public\\cordova.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\android\\app\\src\\main\\assets\\public\\cordova_plugins.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\android\\app\\src\\main\\assets\\public\\sw.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":80,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":80,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const CACHE_NAME = 'kabadiwala-v1';\r\nconst OFFLINE_URL = '/offline.html';\r\n\r\n// Files to cache for offline use\r\nconst STATIC_CACHE_URLS = [\r\n    '/',\r\n    '/manifest.json',\r\n    '/offline.html',\r\n    '/icons/icon-192x192.png',\r\n    '/icons/icon-512x512.png'\r\n];\r\n\r\n// Install event - cache static assets\r\nself.addEventListener('install', (event) => {\r\n    event.waitUntil(\r\n        caches.open(CACHE_NAME).then((cache) => {\r\n            console.log('Caching static assets');\r\n            return cache.addAll(STATIC_CACHE_URLS);\r\n        })\r\n    );\r\n    self.skipWaiting();\r\n});\r\n\r\n// Activate event - clean old caches\r\nself.addEventListener('activate', (event) => {\r\n    event.waitUntil(\r\n        caches.keys().then((cacheNames) => {\r\n            return Promise.all(\r\n                cacheNames\r\n                    .filter((name) => name !== CACHE_NAME)\r\n                    .map((name) => caches.delete(name))\r\n            );\r\n        })\r\n    );\r\n    self.clients.claim();\r\n});\r\n\r\n// Fetch event - network first, fallback to cache\r\nself.addEventListener('fetch', (event) => {\r\n    // Skip non-GET requests\r\n    if (event.request.method !== 'GET') return;\r\n\r\n    // Skip API requests\r\n    if (event.request.url.includes('/api/')) return;\r\n\r\n    event.respondWith(\r\n        fetch(event.request)\r\n            .then((response) => {\r\n                // Clone response and cache it\r\n                if (response.status === 200) {\r\n                    const responseClone = response.clone();\r\n                    caches.open(CACHE_NAME).then((cache) => {\r\n                        cache.put(event.request, responseClone);\r\n                    });\r\n                }\r\n                return response;\r\n            })\r\n            .catch(() => {\r\n                // Network failed, try cache\r\n                return caches.match(event.request).then((cachedResponse) => {\r\n                    if (cachedResponse) {\r\n                        return cachedResponse;\r\n                    }\r\n                    // Return offline page for navigation requests\r\n                    if (event.request.mode === 'navigate') {\r\n                        return caches.match(OFFLINE_URL);\r\n                    }\r\n                    return new Response('Offline', { status: 503 });\r\n                });\r\n            })\r\n    );\r\n});\r\n\r\n// Push notification handling\r\nself.addEventListener('push', (event) => {\r\n    let data = { title: 'Kabadiwala', body: 'New notification', url: '/dashboard', icon: '/icons/icon-192x192.png' };\r\n\r\n    try {\r\n        data = event.data.json();\r\n    } catch (e) {\r\n        data.body = event.data.text();\r\n    }\r\n\r\n    const options = {\r\n        body: data.body,\r\n        icon: data.icon,\r\n        badge: '/icons/badge.png',\r\n        vibrate: [100, 50, 100],\r\n        data: {\r\n            url: data.url\r\n        }\r\n    };\r\n\r\n    event.waitUntil(\r\n        self.registration.showNotification(data.title, options)\r\n    );\r\n});\r\n\r\n// Notification click handling\r\nself.addEventListener('notificationclick', (event) => {\r\n    event.notification.close();\r\n\r\n    if (event.notification.data && event.notification.data.url) {\r\n        event.waitUntil(\r\n            clients.openWindow(event.notification.data.url)\r\n        );\r\n    } else {\r\n        event.waitUntil(\r\n            clients.openWindow('/dashboard')\r\n        );\r\n    }\r\n});\r\n\r\n// Background sync for offline actions\r\nself.addEventListener('sync', (event) => {\r\n    if (event.tag === 'sync-orders') {\r\n        event.waitUntil(syncOfflineOrders());\r\n    }\r\n});\r\n\r\nasync function syncOfflineOrders() {\r\n    // Sync pending orders when back online\r\n    console.log('Syncing offline orders...');\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\capacitor.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\copy_icons.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":25},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":29}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const fs = require('fs');\r\nconst path = require('path');\r\n\r\nconst source = 'C:/Users/ACER/.gemini/antigravity/brain/e96c0c62-9dab-4b06-bcda-9938af6ca14c/kabadiwala_icon_1765136621247.png';\r\nconst destDir = 'e:/kabadiwala/public/icons';\r\nconst files = [\r\n    'icon-72x72.png',\r\n    'icon-96x96.png',\r\n    'icon-128x128.png',\r\n    'icon-144x144.png',\r\n    'icon-152x152.png',\r\n    'icon-192x192.png',\r\n    'icon-384x384.png',\r\n    'icon-512x512.png',\r\n    'shortcut-market.png',\r\n    'shortcut-orders.png',\r\n    'shortcut-chat.png'\r\n];\r\n\r\nif (!fs.existsSync(destDir)) {\r\n    fs.mkdirSync(destDir, { recursive: true });\r\n}\r\n\r\nfiles.forEach(file => {\r\n    fs.copyFileSync(source, path.join(destDir, file));\r\n    console.log(`Copied to ${file}`);\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\create_env.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const fs = require('fs');\r\nconst content = `DATABASE_URL=\"file:./dev.db\"\r\nAUTH_SECRET=\"secret\"`;\r\nfs.writeFileSync('.env', content);\r\nconsole.log('.env created');\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\get_ids.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":51}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { PrismaClient } = require('@prisma/client')\r\nconst prisma = new PrismaClient()\r\n\r\nasync function main() {\r\n    const seller = await prisma.user.findUnique({ where: { phone: '9876543210' }, select: { id: true } })\r\n    const kabadiwala = await prisma.user.findUnique({ where: { phone: '9999999999' }, select: { id: true } })\r\n    console.log('SELLER_ID:', seller?.id)\r\n    console.log('KABADIWALA_ID:', kabadiwala?.id)\r\n}\r\n\r\nmain()\r\n    .catch(e => console.error(e))\r\n    .finally(async () => await prisma.$disconnect())\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\get_ids_simple.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":51}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { PrismaClient } = require('@prisma/client')\r\nconst prisma = new PrismaClient()\r\n\r\nasync function main() {\r\n    try {\r\n        const seller = await prisma.user.findUnique({ where: { phone: '9876543210' } })\r\n        const kabadiwala = await prisma.user.findUnique({ where: { phone: '9999999999' } })\r\n\r\n        console.log('---START_IDS---')\r\n        console.log('SELLER_ID=' + (seller ? seller.id : 'NOT_FOUND'))\r\n        console.log('KABADIWALA_ID=' + (kabadiwala ? kabadiwala.id : 'NOT_FOUND'))\r\n        console.log('---END_IDS---')\r\n    } catch (e) {\r\n        console.error(e)\r\n    }\r\n}\r\n\r\nmain()\r\n    .finally(async () => await prisma.$disconnect())\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\get_users.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":51}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { PrismaClient } = require('@prisma/client')\r\nconst prisma = new PrismaClient()\r\n\r\nasync function main() {\r\n    const users = await prisma.user.findMany({\r\n        select: { id: true, name: true, phone: true, role: true }\r\n    })\r\n    console.log(JSON.stringify(users, null, 2))\r\n}\r\n\r\nmain()\r\n    .catch(e => console.error(e))\r\n    .finally(async () => await prisma.$disconnect())\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\prisma\\seed.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\public\\sw.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":80,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":80,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const CACHE_NAME = 'kabadiwala-v1';\r\nconst OFFLINE_URL = '/offline.html';\r\n\r\n// Files to cache for offline use\r\nconst STATIC_CACHE_URLS = [\r\n    '/',\r\n    '/manifest.json',\r\n    '/offline.html',\r\n    '/icons/icon-192x192.png',\r\n    '/icons/icon-512x512.png'\r\n];\r\n\r\n// Install event - cache static assets\r\nself.addEventListener('install', (event) => {\r\n    event.waitUntil(\r\n        caches.open(CACHE_NAME).then((cache) => {\r\n            console.log('Caching static assets');\r\n            return cache.addAll(STATIC_CACHE_URLS);\r\n        })\r\n    );\r\n    self.skipWaiting();\r\n});\r\n\r\n// Activate event - clean old caches\r\nself.addEventListener('activate', (event) => {\r\n    event.waitUntil(\r\n        caches.keys().then((cacheNames) => {\r\n            return Promise.all(\r\n                cacheNames\r\n                    .filter((name) => name !== CACHE_NAME)\r\n                    .map((name) => caches.delete(name))\r\n            );\r\n        })\r\n    );\r\n    self.clients.claim();\r\n});\r\n\r\n// Fetch event - network first, fallback to cache\r\nself.addEventListener('fetch', (event) => {\r\n    // Skip non-GET requests\r\n    if (event.request.method !== 'GET') return;\r\n\r\n    // Skip API requests\r\n    if (event.request.url.includes('/api/')) return;\r\n\r\n    event.respondWith(\r\n        fetch(event.request)\r\n            .then((response) => {\r\n                // Clone response and cache it\r\n                if (response.status === 200) {\r\n                    const responseClone = response.clone();\r\n                    caches.open(CACHE_NAME).then((cache) => {\r\n                        cache.put(event.request, responseClone);\r\n                    });\r\n                }\r\n                return response;\r\n            })\r\n            .catch(() => {\r\n                // Network failed, try cache\r\n                return caches.match(event.request).then((cachedResponse) => {\r\n                    if (cachedResponse) {\r\n                        return cachedResponse;\r\n                    }\r\n                    // Return offline page for navigation requests\r\n                    if (event.request.mode === 'navigate') {\r\n                        return caches.match(OFFLINE_URL);\r\n                    }\r\n                    return new Response('Offline', { status: 503 });\r\n                });\r\n            })\r\n    );\r\n});\r\n\r\n// Push notification handling\r\nself.addEventListener('push', (event) => {\r\n    let data = { title: 'Kabadiwala', body: 'New notification', url: '/dashboard', icon: '/icons/icon-192x192.png' };\r\n\r\n    try {\r\n        data = event.data.json();\r\n    } catch (e) {\r\n        data.body = event.data.text();\r\n    }\r\n\r\n    const options = {\r\n        body: data.body,\r\n        icon: data.icon,\r\n        badge: '/icons/badge.png',\r\n        vibrate: [100, 50, 100],\r\n        data: {\r\n            url: data.url\r\n        }\r\n    };\r\n\r\n    event.waitUntil(\r\n        self.registration.showNotification(data.title, options)\r\n    );\r\n});\r\n\r\n// Notification click handling\r\nself.addEventListener('notificationclick', (event) => {\r\n    event.notification.close();\r\n\r\n    if (event.notification.data && event.notification.data.url) {\r\n        event.waitUntil(\r\n            clients.openWindow(event.notification.data.url)\r\n        );\r\n    } else {\r\n        event.waitUntil(\r\n            clients.openWindow('/dashboard')\r\n        );\r\n    }\r\n});\r\n\r\n// Background sync for offline actions\r\nself.addEventListener('sync', (event) => {\r\n    if (event.tag === 'sync-orders') {\r\n        event.waitUntil(syncOfflineOrders());\r\n    }\r\n});\r\n\r\nasync function syncOfflineOrders() {\r\n    // Sync pending orders when back online\r\n    console.log('Syncing offline orders...');\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\scripts\\admin-reset.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\scripts\\check-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\scripts\\give-points.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\scripts\\seed-rewards.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\seed.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\actions\\gamification.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\analytics\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\content\\reviews\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":76,"column":41,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[3221,3264],"text":"\r\n                                        &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[3221,3264],"text":"\r\n                                        &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[3221,3264],"text":"\r\n                                        &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[3221,3264],"text":"\r\n                                        &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":76,"column":58,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[3280,3319],"text":"&quot;\r\n                                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[3280,3319],"text":"&ldquo;\r\n                                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[3280,3319],"text":"&#34;\r\n                                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[3280,3319],"text":"&rdquo;\r\n                                    "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from \"@/lib/db\"\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow,\r\n} from \"@/components/ui/table\"\r\nimport { ReviewActions } from \"./review-actions\" // Client component\r\nimport { Star } from \"lucide-react\"\r\n\r\nasync function getReviews() {\r\n    return await db.review.findMany({\r\n        include: {\r\n            reviewer: {\r\n                select: { name: true, phone: true }\r\n            },\r\n            order: {\r\n                include: {\r\n                    seller: { // The Kabadiwala being reviewed\r\n                        include: {\r\n                            kabadiwalaProfile: { select: { businessName: true } }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        orderBy: { createdAt: 'desc' }\r\n    })\r\n}\r\n\r\nexport default async function ReviewsPage() {\r\n    const reviews = await getReviews()\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <h2 className=\"text-3xl font-bold tracking-tight\">Review Moderation</h2>\r\n\r\n            <div className=\"rounded-md border bg-card\">\r\n                <Table>\r\n                    <TableHeader>\r\n                        <TableRow>\r\n                            <TableHead>Rating</TableHead>\r\n                            <TableHead>Reviewer</TableHead>\r\n                            <TableHead>Kabadiwala</TableHead>\r\n                            <TableHead>Comment</TableHead>\r\n                            <TableHead className=\"text-right\">Actions</TableHead>\r\n                        </TableRow>\r\n                    </TableHeader>\r\n                    <TableBody>\r\n                        {reviews.length === 0 ? (\r\n                            <TableRow>\r\n                                <TableCell colSpan={5} className=\"text-center py-8 text-muted-foreground\">\r\n                                    No reviews found\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        ) : (\r\n                            reviews.map((review) => (\r\n                                <TableRow key={review.id}>\r\n                                    <TableCell>\r\n                                        <div className=\"flex items-center text-yellow-500 font-medium\">\r\n                                            {review.rating} <Star className=\"h-3 w-3 ml-1 fill-current\" />\r\n                                        </div>\r\n                                    </TableCell>\r\n                                    <TableCell>\r\n                                        <div className=\"text-sm\">\r\n                                            <div>{review.reviewer.name}</div>\r\n                                            <div className=\"text-xs text-muted-foreground\">{review.reviewer.phone}</div>\r\n                                        </div>\r\n                                    </TableCell>\r\n                                    <TableCell>\r\n                                        {review.order.seller.kabadiwalaProfile?.businessName || \"Unknown\"}\r\n                                    </TableCell>\r\n                                    <TableCell className=\"max-w-md truncate text-muted-foreground\">\r\n                                        \"{review.comment}\"\r\n                                    </TableCell>\r\n                                    <TableCell className=\"text-right\">\r\n                                        <ReviewActions reviewId={review.id} />\r\n                                    </TableCell>\r\n                                </TableRow>\r\n                            ))\r\n                        )}\r\n                    </TableBody>\r\n                </Table>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\content\\reviews\\review-actions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\content\\stories\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":36,"column":33,"nodeType":"JSXOpeningElement","endLine":40,"endColumn":35,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\content\\stories\\story-actions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\insights\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[371,374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[371,374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from \"@/lib/db\"\r\nimport {\r\n    Card,\r\n    CardContent,\r\n    CardHeader,\r\n    CardTitle,\r\n    CardDescription\r\n} from \"@/components/ui/card\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { MapPin, Smartphone, Camera, Globe } from \"lucide-react\"\r\n\r\nasync function getInsights() {\r\n    // RAW SQL to bypass stale Prisma Client types\r\n    const users: any[] = await db.$queryRaw`\r\n        SELECT name, address, role, latitude, longitude, cameraAccess, locationAccess, lastActive \r\n        FROM User \r\n        WHERE role = 'USER' \r\n        ORDER BY lastActive DESC \r\n        LIMIT 20\r\n    `\r\n\r\n    // Convert booleans from SQLite (0/1) to JS boolean if needed (Prisma raw might return 1/0)\r\n    const formattedUsers = users.map(u => ({\r\n        ...u,\r\n        cameraAccess: Boolean(u.cameraAccess),\r\n        locationAccess: Boolean(u.locationAccess)\r\n    }))\r\n\r\n    const [kabadiwalas, activeIps] = await Promise.all([\r\n        db.kabadiwalaProfile.findMany({\r\n            select: { businessName: true, serviceArea: true, isVerified: true }\r\n        }),\r\n        db.rateLimit.findMany({\r\n            orderBy: { windowStart: 'desc' },\r\n            take: 10,\r\n            distinct: ['ip']\r\n        })\r\n    ])\r\n\r\n    return { users: formattedUsers, kabadiwalas, activeIps }\r\n}\r\n\r\nexport default async function InsightsPage() {\r\n    const { users, kabadiwalas, activeIps } = await getInsights()\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div>\r\n                <h2 className=\"text-3xl font-bold tracking-tight\">User Insights</h2>\r\n                <p className=\"text-muted-foreground\">Location intelligence and device telemetry.</p>\r\n            </div>\r\n\r\n            <div className=\"grid gap-6 md:grid-cols-2\">\r\n                {/* Location Intelligence */}\r\n                <Card>\r\n                    <CardHeader>\r\n                        <CardTitle className=\"flex items-center gap-2\">\r\n                            <MapPin className=\"h-5 w-5 text-primary\" />\r\n                            User Locations\r\n                        </CardTitle>\r\n                        <CardDescription>Based on registered profiles</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent className=\"space-y-4\">\r\n                        <div className=\"space-y-2\">\r\n                            {users.map((user, i) => (\r\n                                <div key={i} className=\"flex items-center justify-between text-sm border-b pb-2 last:border-0\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <div className=\"h-2 w-2 rounded-full bg-blue-500\" />\r\n                                        <span>{user.name}</span>\r\n                                        <Badge variant=\"outline\" className=\"text-[10px] h-5\">{user.role}</Badge>\r\n                                    </div>\r\n                                    <span className=\"text-muted-foreground truncate max-w-[150px]\">{user.address}</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                {/* Service Areas */}\r\n                <Card>\r\n                    <CardHeader>\r\n                        <CardTitle className=\"flex items-center gap-2\">\r\n                            <Globe className=\"h-5 w-5 text-green-500\" />\r\n                            Kabadiwala Coverage\r\n                        </CardTitle>\r\n                        <CardDescription>Operational zones</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent className=\"space-y-4\">\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            {kabadiwalas.map((k, i) => (\r\n                                <Badge key={i} variant=\"secondary\" className=\"flex items-center gap-1\">\r\n                                    {k.serviceArea || \"Unknown\"}\r\n                                    {k.isVerified && <span className=\"text-green-500 ml-1\"></span>}\r\n                                </Badge>\r\n                            ))}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                {/* Device Telemetry */}\r\n                <Card>\r\n                    <CardHeader>\r\n                        <CardTitle className=\"flex items-center gap-2\">\r\n                            <Smartphone className=\"h-5 w-5 text-purple-500\" />\r\n                            Active Devices (IPs)\r\n                        </CardTitle>\r\n                        <CardDescription>Recent network activity</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"space-y-2\">\r\n                            {activeIps.map((ip, i) => (\r\n                                <div key={i} className=\"flex items-center justify-between text-sm p-2 bg-muted/50 rounded\">\r\n                                    <span className=\"font-mono\">{ip.ip}</span>\r\n                                    <span className=\"text-xs text-muted-foreground\">Active recently</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                {/* Security Permissions (Mocked for Demo) */}\r\n                <Card>\r\n                    <CardHeader>\r\n                        <CardTitle className=\"flex items-center gap-2\">\r\n                            <Camera className=\"h-5 w-5 text-red-500\" />\r\n                            Permission Telemetry\r\n                        </CardTitle>\r\n                        <CardDescription>Camera & Location Access Status</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <span className=\"text-sm font-medium\">Camera Access Rate</span>\r\n                                <Badge className=\"bg-green-600\">85% Granted</Badge>\r\n                            </div>\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <span className=\"text-sm font-medium\">Location Services</span>\r\n                                <Badge className=\"bg-yellow-600\">60% Precise</Badge>\r\n                            </div>\r\n                            <div className=\"text-xs text-muted-foreground mt-4\">\r\n                                * Aggregate data based on verification flow telemetry.\r\n                            </div>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\kabadiwalas\\kabadiwala-actions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\kabadiwalas\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\login\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1234,1237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1234,1237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { Shield, Lock, ArrowRight, Loader2 } from \"lucide-react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\"\r\nimport { toast } from \"sonner\"\r\n\r\nexport default function AdminLoginPage() {\r\n    const router = useRouter()\r\n    const [password, setPassword] = useState(\"\")\r\n    const [loading, setLoading] = useState(false)\r\n\r\n    async function handleLogin(e: React.FormEvent) {\r\n        e.preventDefault()\r\n        setLoading(true)\r\n\r\n        try {\r\n            const res = await fetch(\"/api/admin/security\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ action: \"LOGIN\", password })\r\n            })\r\n\r\n            const data = await res.json()\r\n\r\n            if (!res.ok) {\r\n                throw new Error(data.error || \"Login failed\")\r\n            }\r\n\r\n            toast.success(\"Admin Access Granted\")\r\n            router.push(\"/admin\")\r\n            router.refresh()\r\n        } catch (error: any) {\r\n            toast.error(error.message)\r\n            setPassword(\"\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4\">\r\n            <div className=\"mb-8 text-center animate-fade-in\">\r\n                <div className=\"bg-primary/20 p-4 rounded-full inline-block mb-4\">\r\n                    <Shield className=\"h-12 w-12 text-primary\" />\r\n                </div>\r\n                <h1 className=\"text-3xl font-bold text-white tracking-tight\">Kabadiwala Admin</h1>\r\n                <p className=\"text-slate-400 mt-2\">Secure Restricted Access</p>\r\n            </div>\r\n\r\n            <Card className=\"w-full max-w-md bg-white/5 border-white/10 text-white backdrop-blur\">\r\n                <CardHeader>\r\n                    <CardTitle>Authenticate</CardTitle>\r\n                    <CardDescription className=\"text-slate-400\">\r\n                        Enter your secure admin password to continue.\r\n                    </CardDescription>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    <form onSubmit={handleLogin} className=\"space-y-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <div className=\"relative\">\r\n                                <Lock className=\"absolute left-3 top-3 h-4 w-4 text-slate-400\" />\r\n                                <Input\r\n                                    type=\"password\"\r\n                                    placeholder=\"Admin Password\"\r\n                                    className=\"pl-10 bg-black/20 border-white/10 text-white placeholder:text-slate-500\"\r\n                                    value={password}\r\n                                    onChange={(e) => setPassword(e.target.value)}\r\n                                    autoFocus\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        <Button\r\n                            type=\"submit\"\r\n                            className=\"w-full font-semibold\"\r\n                            disabled={loading || !password}\r\n                        >\r\n                            {loading ? (\r\n                                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                            ) : (\r\n                                <>\r\n                                    Unlock Panel <ArrowRight className=\"ml-2 h-4 w-4\" />\r\n                                </>\r\n                            )}\r\n                        </Button>\r\n                    </form>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <p className=\"mt-8 text-xs text-slate-600\">\r\n                Unauthorized access is monitored and logged to system audits.\r\n            </p>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\orders\\order-admin-actions.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentStatus' is defined but never used.","line":17,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":59}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport {\r\n    DropdownMenu,\r\n    DropdownMenuContent,\r\n    DropdownMenuItem,\r\n    DropdownMenuTrigger,\r\n    DropdownMenuLabel,\r\n    DropdownMenuSeparator\r\n} from \"@/components/ui/dropdown-menu\"\r\nimport { MoreHorizontal, ShieldAlert, Loader2 } from \"lucide-react\"\r\nimport { toast } from \"sonner\"\r\n\r\nexport function OrderAdminActions({ orderId, currentStatus }: { orderId: string, currentStatus: string }) {\r\n    const router = useRouter()\r\n    const [loading, setLoading] = useState(false)\r\n\r\n    async function forceStatus(status: string) {\r\n        if (!confirm(`Force status to ${status}? This bypasses normal checks.`)) return\r\n\r\n        setLoading(true)\r\n        try {\r\n            const res = await fetch(`/api/admin/orders/${orderId}/force-update`, {\r\n                method: \"PATCH\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ status })\r\n            })\r\n            if (!res.ok) throw new Error(\"Failed\")\r\n            toast.success(`Order forced to ${status}`)\r\n            router.refresh()\r\n        } catch {\r\n            toast.error(\"Error updating order\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <DropdownMenu>\r\n            <DropdownMenuTrigger asChild>\r\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" disabled={loading}>\r\n                    {loading ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <MoreHorizontal className=\"h-4 w-4\" />}\r\n                </Button>\r\n            </DropdownMenuTrigger>\r\n            <DropdownMenuContent align=\"end\">\r\n                <DropdownMenuLabel>Admin Override</DropdownMenuLabel>\r\n                <DropdownMenuSeparator />\r\n                <DropdownMenuItem onClick={() => forceStatus(\"REQUESTED\")}>\r\n                    Force Requested\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem onClick={() => forceStatus(\"ACCEPTED\")}>\r\n                    Force Accepted\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem onClick={() => forceStatus(\"COMPLETED\")} className=\"text-green-600\">\r\n                    <ShieldAlert className=\"mr-2 h-4 w-4\" /> Force Completed\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem onClick={() => forceStatus(\"CANCELLED\")} className=\"text-red-600\">\r\n                    <ShieldAlert className=\"mr-2 h-4 w-4\" /> Force Cancelled\r\n                </DropdownMenuItem>\r\n            </DropdownMenuContent>\r\n        </DropdownMenu>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\orders\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Coins' is defined but never used.","line":3,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from \"@/lib/db\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Users, ShoppingBag, Flag, Coins, Recycle } from \"lucide-react\"\r\n\r\nasync function getStats() {\r\n    try {\r\n        const [\r\n            totalUsers,\r\n            totalKabadiwalas,\r\n            totalOrders,\r\n            pendingOrders,\r\n            totalReports\r\n        ] = await Promise.all([\r\n            db.user.count(),\r\n            db.kabadiwalaProfile.count(),\r\n            db.order.count(),\r\n            db.order.count({ where: { status: \"REQUESTED\" } }),\r\n            db.messageReport.count({ where: { isResolved: false } })\r\n        ])\r\n\r\n        return {\r\n            totalUsers,\r\n            totalKabadiwalas,\r\n            totalOrders,\r\n            pendingOrders,\r\n            totalReports\r\n        }\r\n    } catch {\r\n        return {\r\n            totalUsers: 0,\r\n            totalKabadiwalas: 0,\r\n            totalOrders: 0,\r\n            pendingOrders: 0,\r\n            totalReports: 0\r\n        }\r\n    }\r\n}\r\n\r\nexport default async function AdminDashboard() {\r\n    const stats = await getStats()\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            <h2 className=\"text-3xl font-bold tracking-tight\">Dashboard Overview</h2>\r\n\r\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium\">Total Users</CardTitle>\r\n                        <Users className=\"h-4 w-4 text-muted-foreground\" />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold\">{stats.totalUsers}</div>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium\">Kabadiwalas</CardTitle>\r\n                        <Recycle className=\"h-4 w-4 text-muted-foreground\" />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold\">{stats.totalKabadiwalas}</div>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium\">Active Reports</CardTitle>\r\n                        <Flag className=\"h-4 w-4 text-muted-foreground\" />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold text-red-500\">{stats.totalReports}</div>\r\n                        <p className=\"text-xs text-muted-foreground\">Unresolved content reports</p>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium\">Pending Orders</CardTitle>\r\n                        <ShoppingBag className=\"h-4 w-4 text-muted-foreground\" />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold\">{stats.pendingOrders}</div>\r\n                        <p className=\"text-xs text-muted-foreground\">of {stats.totalOrders} total orders</p>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\recover\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardFooter' is defined but never used.","line":8,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":56}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Loader2, ShieldAlert } from \"lucide-react\"\r\nimport { toast } from \"sonner\"\r\n\r\nexport default function AdminRecoveryPage() {\r\n    const router = useRouter()\r\n    const [email, setEmail] = useState(\"\")\r\n    const [recoveryCode, setRecoveryCode] = useState(\"\")\r\n    const [newPassword, setNewPassword] = useState(\"\")\r\n    const [loading, setLoading] = useState(false)\r\n\r\n    async function handleRecover(e: React.FormEvent) {\r\n        e.preventDefault()\r\n        setLoading(true)\r\n\r\n        try {\r\n            const res = await fetch(\"/api/admin/recover\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ email, recoveryCode, newPassword }),\r\n            })\r\n            const data = await res.json()\r\n\r\n            if (res.ok) {\r\n                toast.success(\"Admin Password Reset Successfully!\")\r\n                router.push(\"/login\")\r\n            } else {\r\n                toast.error(data.error || \"Recovery failed\")\r\n            }\r\n        } catch {\r\n            toast.error(\"Something went wrong\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-black/95 text-white px-4\">\r\n            <Card className=\"w-full max-w-md border-red-900 bg-red-950/10 text-red-50\">\r\n                <CardHeader className=\"text-center\">\r\n                    <div className=\"mx-auto bg-red-900/20 p-3 rounded-full w-fit mb-4\">\r\n                        <ShieldAlert className=\"h-8 w-8 text-red-500\" />\r\n                    </div>\r\n                    <CardTitle className=\"text-2xl text-red-500\">Admin Recovery</CardTitle>\r\n                    <CardDescription className=\"text-red-300\">\r\n                        Secure Developer Access Only\r\n                    </CardDescription>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    <form onSubmit={handleRecover} className=\"space-y-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"email\">Admin Email</Label>\r\n                            <Input\r\n                                id=\"email\"\r\n                                type=\"email\"\r\n                                placeholder=\"admin@kabadiwala.com\"\r\n                                className=\"bg-black/50 border-red-900 focus:border-red-500\"\r\n                                required\r\n                                value={email}\r\n                                onChange={(e) => setEmail(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"code\">Recovery Master Key</Label>\r\n                            <Input\r\n                                id=\"code\"\r\n                                type=\"password\"\r\n                                placeholder=\"SECRET_ENV_CODE\"\r\n                                className=\"bg-black/50 border-red-900 focus:border-red-500 font-mono\"\r\n                                required\r\n                                value={recoveryCode}\r\n                                onChange={(e) => setRecoveryCode(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"newPassword\">New Password</Label>\r\n                            <Input\r\n                                id=\"newPassword\"\r\n                                type=\"password\"\r\n                                placeholder=\"New Strong Password\"\r\n                                className=\"bg-black/50 border-red-900 focus:border-red-500\"\r\n                                required\r\n                                minLength={6}\r\n                                value={newPassword}\r\n                                onChange={(e) => setNewPassword(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <Button type=\"submit\" variant=\"destructive\" className=\"w-full mt-6\" disabled={loading}>\r\n                            {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                            Reset via Master Key\r\n                        </Button>\r\n                    </form>\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\reports\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":74,"column":41,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[3199,3242],"text":"\r\n                                        &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[3199,3242],"text":"\r\n                                        &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[3199,3242],"text":"\r\n                                        &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[3199,3242],"text":"\r\n                                        &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":74,"column":66,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[3266,3305],"text":"&quot;\r\n                                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[3266,3305],"text":"&ldquo;\r\n                                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[3266,3305],"text":"&#34;\r\n                                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[3266,3305],"text":"&rdquo;\r\n                                    "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from \"@/lib/db\"\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow,\r\n} from \"@/components/ui/table\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { ReportActions } from \"./report-actions\" // Client component\r\n\r\nasync function getReports() {\r\n    return await db.messageReport.findMany({\r\n        where: { isResolved: false }, // Only show unresolved\r\n        include: {\r\n            reporter: {\r\n                select: { name: true, email: true }\r\n            },\r\n            message: {\r\n                include: {\r\n                    sender: { select: { name: true, email: true } }\r\n                }\r\n            }\r\n        },\r\n        orderBy: { createdAt: 'desc' }\r\n    })\r\n}\r\n\r\nexport default async function ReportsPage() {\r\n    const reports = await getReports()\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <h2 className=\"text-3xl font-bold tracking-tight\">Content Reports</h2>\r\n\r\n            <div className=\"rounded-md border bg-card\">\r\n                <Table>\r\n                    <TableHeader>\r\n                        <TableRow>\r\n                            <TableHead>Reason</TableHead>\r\n                            <TableHead>Reporter</TableHead>\r\n                            <TableHead>Offender</TableHead>\r\n                            <TableHead>Message Content</TableHead>\r\n                            <TableHead className=\"text-right\">Actions</TableHead>\r\n                        </TableRow>\r\n                    </TableHeader>\r\n                    <TableBody>\r\n                        {reports.length === 0 ? (\r\n                            <TableRow>\r\n                                <TableCell colSpan={5} className=\"text-center py-8 text-muted-foreground\">\r\n                                    No active reports\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        ) : (\r\n                            reports.map((report) => (\r\n                                <TableRow key={report.id}>\r\n                                    <TableCell className=\"font-medium\">\r\n                                        <Badge variant=\"destructive\">{report.reason}</Badge>\r\n                                    </TableCell>\r\n                                    <TableCell>\r\n                                        <div className=\"text-sm\">\r\n                                            <div>{report.reporter.name}</div>\r\n                                            <div className=\"text-xs text-muted-foreground\">{report.reporter.email}</div>\r\n                                        </div>\r\n                                    </TableCell>\r\n                                    <TableCell>\r\n                                        <div className=\"text-sm\">\r\n                                            <div>{report.message.sender.name}</div>\r\n                                            <div className=\"text-xs text-muted-foreground\">{report.message.sender.email}</div>\r\n                                        </div>\r\n                                    </TableCell>\r\n                                    <TableCell className=\"max-w-md truncate\">\r\n                                        \"{report.message.content}\"\r\n                                    </TableCell>\r\n                                    <TableCell className=\"text-right\">\r\n                                        <ReportActions reportId={report.id} />\r\n                                    </TableCell>\r\n                                </TableRow>\r\n                            ))\r\n                        )}\r\n                    </TableBody>\r\n                </Table>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\reports\\report-actions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\system\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\users\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\users\\user-actions.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[807,810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[807,810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { Eye, MoreHorizontal, Trash, Shield, ShieldAlert, User as UserIcon } from \"lucide-react\"\r\nimport { UserDetailSheet } from \"./user-detail-sheet\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport {\r\n    DropdownMenu,\r\n    DropdownMenuContent,\r\n    DropdownMenuItem,\r\n    DropdownMenuLabel,\r\n    DropdownMenuSeparator,\r\n    DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\"\r\nimport { toast } from \"sonner\"\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\"\r\n\r\ninterface UserActionsProps {\r\n    user: any\r\n}\r\n\r\nexport function UserActions({ user }: UserActionsProps) {\r\n    const router = useRouter()\r\n    const [loading, setLoading] = useState(false)\r\n    const [showDeleteDialog, setShowDeleteDialog] = useState(false)\r\n    const [showDetailSheet, setShowDetailSheet] = useState(false)\r\n\r\n    async function deleteUser() {\r\n        setLoading(true)\r\n        try {\r\n            const res = await fetch(`/api/admin/users/${user.id}`, {\r\n                method: \"DELETE\",\r\n                credentials: \"include\"\r\n            })\r\n\r\n            if (!res.ok) throw new Error(\"Failed to delete\")\r\n\r\n            toast.success(\"User deleted successfully\")\r\n            setShowDeleteDialog(false)\r\n            router.refresh()\r\n        } catch {\r\n            toast.error(\"Something went wrong\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    async function updateUserRole(role: string) {\r\n        setLoading(true)\r\n        try {\r\n            const res = await fetch(`/api/admin/users/${user.id}`, {\r\n                method: \"PATCH\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ role }),\r\n                credentials: \"include\"\r\n            })\r\n\r\n            if (!res.ok) throw new Error(\"Failed to update role\")\r\n\r\n            toast.success(`User role updated to ${role}`)\r\n            router.refresh()\r\n        } catch {\r\n            toast.error(\"Something went wrong\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <UserDetailSheet\r\n                user={user}\r\n                open={showDetailSheet}\r\n                onOpenChange={setShowDetailSheet}\r\n            />\r\n\r\n            <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\r\n                {/* ... (Existing Alert Dialog Content same as before) ... */}\r\n                <AlertDialogContent>\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>\r\n                        <AlertDialogDescription>\r\n                            This action cannot be undone. This will permanently delete the user\r\n                            account and remove their data from our servers.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n                        <AlertDialogAction onClick={deleteUser} className=\"bg-red-600 hover:bg-red-700\">\r\n                            Delete Account\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            <DropdownMenu>\r\n                <DropdownMenuTrigger asChild>\r\n                    <Button variant=\"ghost\" className=\"h-8 w-8 p-0\" disabled={loading}>\r\n                        <span className=\"sr-only\">Open menu</span>\r\n                        <MoreHorizontal className=\"h-4 w-4\" />\r\n                    </Button>\r\n                </DropdownMenuTrigger>\r\n                <DropdownMenuContent align=\"end\">\r\n                    <DropdownMenuLabel>Actions</DropdownMenuLabel>\r\n                    <DropdownMenuItem onClick={() => setShowDetailSheet(true)}>\r\n                        <Eye className=\"mr-2 h-4 w-4\" /> View Details\r\n                    </DropdownMenuItem>\r\n                    <DropdownMenuItem onClick={() => navigator.clipboard.writeText(user.id)}>\r\n                        Copy User ID\r\n                    </DropdownMenuItem>\r\n                    <DropdownMenuSeparator />\r\n                    <DropdownMenuLabel>Change Role</DropdownMenuLabel>\r\n                    <DropdownMenuItem onClick={() => updateUserRole(\"USER\")}>\r\n                        <UserIcon className=\"mr-2 h-4 w-4\" /> Make User\r\n                    </DropdownMenuItem>\r\n                    <DropdownMenuItem onClick={() => updateUserRole(\"KABADIWALA\")}>\r\n                        <Shield className=\"mr-2 h-4 w-4\" /> Make Kabadiwala\r\n                    </DropdownMenuItem>\r\n                    <DropdownMenuItem onClick={() => updateUserRole(\"ADMIN\")} className=\"text-red-600\">\r\n                        <ShieldAlert className=\"mr-2 h-4 w-4\" /> Make Admin\r\n                    </DropdownMenuItem>\r\n                    <DropdownMenuSeparator />\r\n                    <DropdownMenuItem\r\n                        onClick={() => setShowDeleteDialog(true)}\r\n                        className=\"text-red-600 focus:text-red-600\"\r\n                    >\r\n                        <Trash className=\"mr-2 h-4 w-4\" /> Delete User\r\n                    </DropdownMenuItem>\r\n                </DropdownMenuContent>\r\n            </DropdownMenu>\r\n        </>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\admin\\users\\user-detail-sheet.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[450,453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[450,453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport {\r\n    Sheet,\r\n    SheetContent,\r\n    SheetDescription,\r\n    SheetHeader,\r\n    SheetTitle,\r\n} from \"@/components/ui/sheet\"\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { MapPin, Calendar, Clock, Mail, Phone, ExternalLink } from \"lucide-react\"\r\n\r\ninterface UserDetailSheetProps {\r\n    user: any // Ideally typed with your User type\r\n    open: boolean\r\n    onOpenChange: (open: boolean) => void\r\n}\r\n\r\nexport function UserDetailSheet({ user, open, onOpenChange }: UserDetailSheetProps) {\r\n    if (!user) return null\r\n\r\n    const googleMapsUrl = user.latitude && user.longitude\r\n        ? `https://www.google.com/maps?q=${user.latitude},${user.longitude}`\r\n        : null\r\n\r\n    return (\r\n        <Sheet open={open} onOpenChange={onOpenChange}>\r\n            <SheetContent className=\"w-[400px] sm:w-[540px] overflow-y-auto\">\r\n                <SheetHeader className=\"mb-6\">\r\n                    <SheetTitle>User Details</SheetTitle>\r\n                    <SheetDescription>\r\n                        Complete profile information and location.\r\n                    </SheetDescription>\r\n                </SheetHeader>\r\n\r\n                <div className=\"space-y-6\">\r\n                    {/* Header Profile */}\r\n                    <div className=\"flex flex-col items-center text-center space-y-3 pb-6 border-b\">\r\n                        <Avatar className=\"h-24 w-24\">\r\n                            <AvatarImage src={user.image || \"\"} />\r\n                            <AvatarFallback className=\"text-2xl\">{user.name?.[0] || \"U\"}</AvatarFallback>\r\n                        </Avatar>\r\n                        <div>\r\n                            <h3 className=\"text-xl font-bold\">{user.name || \"Unknown User\"}</h3>\r\n                            <p className=\"text-muted-foreground\">{user.role}</p>\r\n                        </div>\r\n                        <div className=\"flex gap-2\">\r\n                            <Badge variant={user.phoneVerified ? \"default\" : \"secondary\"}>\r\n                                {user.phoneVerified ? \"Verified\" : \"Unverified\"}\r\n                            </Badge>\r\n                            <Badge variant={user.email ? \"outline\" : \"secondary\"}>\r\n                                {user.email ? \"Email Added\" : \"No Email\"}\r\n                            </Badge>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Contact Info */}\r\n                    <div className=\"space-y-4\">\r\n                        <h4 className=\"font-semibold text-sm text-muted-foreground uppercase tracking-wider\">Contact Info</h4>\r\n                        <div className=\"grid gap-3\">\r\n                            <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/50\">\r\n                                <Phone className=\"h-4 w-4 text-muted-foreground\" />\r\n                                <div>\r\n                                    <p className=\"text-sm font-medium\">Phone</p>\r\n                                    <p className=\"text-sm text-muted-foreground\">{user.phone}</p>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/50\">\r\n                                <Mail className=\"h-4 w-4 text-muted-foreground\" />\r\n                                <div>\r\n                                    <p className=\"text-sm font-medium\">Email</p>\r\n                                    <p className=\"text-sm text-muted-foreground\">{user.email || \"Not provided\"}</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Location Info */}\r\n                    <div className=\"space-y-4\">\r\n                        <h4 className=\"font-semibold text-sm text-muted-foreground uppercase tracking-wider\">Location & Address</h4>\r\n                        <div className=\"p-4 rounded-lg bg-muted/50 space-y-3\">\r\n                            <div className=\"flex items-start gap-3\">\r\n                                <MapPin className=\"h-4 w-4 text-primary mt-1\" />\r\n                                <div>\r\n                                    <p className=\"text-sm font-medium\">Recorded Address</p>\r\n                                    <p className=\"text-sm text-muted-foreground mt-1\">\r\n                                        {user.address || \"No address provided\"}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Lat/Long Map Link */}\r\n                            {(user.latitude || user.longitude) && (\r\n                                <div className=\"pt-3 border-t border-border/50\">\r\n                                    <div className=\"flex justify-between items-center mb-2\">\r\n                                        <p className=\"text-xs font-medium text-muted-foreground\">GPS Coordinates</p>\r\n                                        <span className=\"text-xs font-mono bg-background px-2 py-1 rounded border\">\r\n                                            {user.latitude?.toFixed(6)}, {user.longitude?.toFixed(6)}\r\n                                        </span>\r\n                                    </div>\r\n                                    <Button variant=\"outline\" size=\"sm\" className=\"w-full gap-2\" asChild>\r\n                                        <a href={googleMapsUrl!} target=\"_blank\" rel=\"noopener noreferrer\">\r\n                                            <ExternalLink className=\"h-3 w-3\" />\r\n                                            View on Google Maps\r\n                                        </a>\r\n                                    </Button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Meta Info */}\r\n                    <div className=\"space-y-4\">\r\n                        <h4 className=\"font-semibold text-sm text-muted-foreground uppercase tracking-wider\">Metadata</h4>\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <Calendar className=\"h-4 w-4 text-muted-foreground\" />\r\n                                <div>\r\n                                    <p className=\"text-xs text-muted-foreground\">Joined</p>\r\n                                    <p className=\"text-sm font-medium\">\r\n                                        {new Date(user.createdAt).toLocaleDateString()}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <Clock className=\"h-4 w-4 text-muted-foreground\" />\r\n                                <div>\r\n                                    <p className=\"text-xs text-muted-foreground\">Last Active</p>\r\n                                    <p className=\"text-sm font-medium\">\r\n                                        {new Date(user.lastActive).toLocaleDateString()}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </SheetContent>\r\n        </Sheet>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\admin\\analytics\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\admin\\content\\reviews\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":22,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { auth } from \"@/auth\"\r\nimport { db } from \"@/lib/db\"\r\n\r\nexport async function DELETE(\r\n    req: Request,\r\n    context: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const session = await auth()\r\n        if (session?.user?.role !== \"ADMIN\") {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const { id } = await context.params\r\n\r\n        await db.review.delete({\r\n            where: { id }\r\n        })\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to delete review\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\admin\\content\\stories\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":22,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { auth } from \"@/auth\"\r\nimport { db } from \"@/lib/db\"\r\n\r\nexport async function DELETE(\r\n    req: Request,\r\n    context: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const session = await auth()\r\n        if (session?.user?.role !== \"ADMIN\") {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const { id } = await context.params\r\n\r\n        await db.story.delete({\r\n            where: { id }\r\n        })\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to delete story\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\admin\\kabadiwalas\\[id]\\verify\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":35,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\nimport { db } from \"@/lib/db\"\r\n\r\nasync function checkAdminAuth() {\r\n    const cookieStore = await cookies()\r\n    const adminToken = cookieStore.get(\"admin_session\")\r\n    return adminToken && adminToken.value === \"active\"\r\n}\r\n\r\nexport async function PATCH(\r\n    req: Request,\r\n    context: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const isAdmin = await checkAdminAuth()\r\n        if (!isAdmin) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const { id } = await context.params\r\n        const body = await req.json()\r\n        const { isVerified } = body\r\n\r\n        if (typeof isVerified !== \"boolean\") {\r\n            return NextResponse.json({ error: \"Invalid status\" }, { status: 400 })\r\n        }\r\n\r\n        await db.kabadiwalaProfile.update({\r\n            where: { id },\r\n            data: { isVerified }\r\n        })\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to update status\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\admin\\orders\\[id]\\force-update\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":32,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { auth } from \"@/auth\"\r\nimport { db } from \"@/lib/db\"\r\n\r\nexport async function PATCH(\r\n    req: Request,\r\n    context: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const session = await auth()\r\n        if (session?.user?.role !== \"ADMIN\") {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const { id } = await context.params\r\n        const body = await req.json()\r\n        const { status } = body\r\n\r\n        if (!status) {\r\n            return NextResponse.json({ error: \"Status required\" }, { status: 400 })\r\n        }\r\n\r\n        await db.order.update({\r\n            where: { id },\r\n            data: {\r\n                status,\r\n                updatedAt: new Date()\r\n            }\r\n        })\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to force update order\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\admin\\recover\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\admin\\reports\\[id]\\resolve\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":65,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\nimport { db } from \"@/lib/db\"\r\n\r\nasync function checkAdminAuth() {\r\n    const cookieStore = await cookies()\r\n    const adminToken = cookieStore.get(\"admin_session\")\r\n    return adminToken && adminToken.value === \"active\"\r\n}\r\n\r\n// POST: Resolve a report (dismiss or delete message)\r\nexport async function POST(\r\n    req: Request,\r\n    context: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const isAdmin = await checkAdminAuth()\r\n        if (!isAdmin) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const { id } = await context.params // Report ID\r\n        const body = await req.json()\r\n        const { action } = body // \"dismiss\" | \"delete_message\"\r\n\r\n        if (![\"dismiss\", \"delete_message\"].includes(action)) {\r\n            return NextResponse.json({ error: \"Invalid action\" }, { status: 400 })\r\n        }\r\n\r\n        const report = await db.messageReport.findUnique({\r\n            where: { id },\r\n            include: { message: true }\r\n        })\r\n\r\n        if (!report) {\r\n            return NextResponse.json({ error: \"Report not found\" }, { status: 404 })\r\n        }\r\n\r\n        if (action === \"delete_message\") {\r\n            // Soft delete the message\r\n            await db.message.update({\r\n                where: { id: report.messageId },\r\n                data: {\r\n                    isDeleted: true,\r\n                    deletedAt: new Date(),\r\n                    content: \"\", // Clear content\r\n                    isReported: false // Clear reported flag as it's dealt with\r\n                }\r\n            })\r\n        } else {\r\n            // Just unflag the message\r\n            await db.message.update({\r\n                where: { id: report.messageId },\r\n                data: { isReported: false }\r\n            })\r\n        }\r\n\r\n        // Mark report as resolved\r\n        await db.messageReport.update({\r\n            where: { id },\r\n            data: { isResolved: true }\r\n        })\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to resolve report\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\admin\\security\\route.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'updateData' is never reassigned. Use 'const' instead.","line":67,"column":21,"nodeType":"Identifier","messageId":"useConst","endLine":67,"endColumn":36,"fix":{"range":[2344,2394],"text":"const updateData: any = { failedAttempts: attempts }"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2360,2363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2360,2363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\nimport { db } from \"@/lib/db\"\r\nimport { compare } from \"bcryptjs\"\r\nimport { auth } from \"@/auth\"\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const body = await req.json()\r\n        const { action, password } = body\r\n\r\n        // 1. CHECK SESSION\r\n        if (action === \"CHECK\") {\r\n            const cookieStore = await cookies()\r\n            const adminToken = cookieStore.get(\"admin_session\")\r\n\r\n            if (!adminToken || adminToken.value !== \"active\") {\r\n                return NextResponse.json({ valid: false })\r\n            }\r\n            return NextResponse.json({ valid: true })\r\n        }\r\n\r\n        // 2. LOGOUT\r\n        if (action === \"LOGOUT\") {\r\n            const cookieStore = await cookies()\r\n            cookieStore.delete(\"admin_session\")\r\n\r\n            // Log logout\r\n            const session = await auth()\r\n            await db.adminAccessLog.create({\r\n                data: {\r\n                    ipAddress: \"unknown\", // In real app, get from headers\r\n                    action: \"LOGOUT\",\r\n                    userId: session?.user?.id,\r\n                    details: \"Manual logout\"\r\n                }\r\n            })\r\n\r\n            return NextResponse.json({ success: true })\r\n        }\r\n\r\n        // 3. LOGIN\r\n        if (action === \"LOGIN\") {\r\n            if (!password) {\r\n                return NextResponse.json({ error: \"Password required\" }, { status: 400 })\r\n            }\r\n\r\n            const config = await db.adminConfig.findFirst()\r\n\r\n            if (!config || !config.isSetup) {\r\n                return NextResponse.json({ error: \"Admin password not set. Please run setup.\" }, { status: 400 })\r\n            }\r\n\r\n            // Check lock\r\n            if (config.lockedUntil && config.lockedUntil > new Date()) {\r\n                return NextResponse.json({ error: \"Account locked. Try again later.\" }, { status: 403 })\r\n            }\r\n\r\n            const isValid = await compare(password, config.adminPassword)\r\n\r\n            const session = await auth()\r\n            const ip = \"unknown\" // In Next.js middleware or headers we'd get real IP\r\n\r\n            if (!isValid) {\r\n                // Increment failed attempts\r\n                const attempts = config.failedAttempts + 1\r\n                let updateData: any = { failedAttempts: attempts }\r\n\r\n                if (attempts >= 10) {\r\n                    updateData.lockedUntil = new Date(Date.now() + 1 * 60 * 1000) // 1 min lock\r\n                }\r\n\r\n                await db.adminConfig.update({\r\n                    where: { id: config.id },\r\n                    data: updateData\r\n                })\r\n\r\n                await db.adminAccessLog.create({\r\n                    data: {\r\n                        ipAddress: ip,\r\n                        action: \"LOGIN_FAILED\",\r\n                        userId: session?.user?.id,\r\n                        details: `Attempt ${attempts}`\r\n                    }\r\n                })\r\n\r\n                return NextResponse.json({ error: \"Invalid password\" }, { status: 401 })\r\n            }\r\n\r\n            // Success\r\n            await db.adminConfig.update({\r\n                where: { id: config.id },\r\n                data: {\r\n                    failedAttempts: 0,\r\n                    lastAccess: new Date(),\r\n                    lockedUntil: null\r\n                }\r\n            })\r\n\r\n            await db.adminAccessLog.create({\r\n                data: {\r\n                    ipAddress: ip,\r\n                    action: \"LOGIN_SUCCESS\",\r\n                    userId: session?.user?.id,\r\n                    details: \"Admin panel access granted\"\r\n                }\r\n            })\r\n\r\n            const cookieStore = await cookies()\r\n            // Set session cookie (expires in 1 hour)\r\n            cookieStore.set(\"admin_session\", \"active\", {\r\n                httpOnly: true,\r\n                secure: process.env.NODE_ENV === \"production\",\r\n                maxAge: 3600, // 1 hour\r\n                path: \"/\"\r\n            })\r\n\r\n            return NextResponse.json({ success: true })\r\n        }\r\n\r\n        return NextResponse.json({ error: \"Invalid action\" }, { status: 400 })\r\n\r\n    } catch (error) {\r\n        console.error(\"Admin Security Error:\", error)\r\n        return NextResponse.json({ error: \"Server error\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\admin\\users\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":29,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":59,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\nimport { db } from \"@/lib/db\"\r\n\r\nasync function checkAdminAuth() {\r\n    const cookieStore = await cookies()\r\n    const adminToken = cookieStore.get(\"admin_session\")\r\n    return adminToken && adminToken.value === \"active\"\r\n}\r\n\r\n// DELETE: Remove a user\r\nexport async function DELETE(\r\n    req: Request,\r\n    context: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const isAdmin = await checkAdminAuth()\r\n        if (!isAdmin) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const { id } = await context.params\r\n\r\n        await db.user.delete({\r\n            where: { id }\r\n        })\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to delete user\" }, { status: 500 })\r\n    }\r\n}\r\n\r\n// PATCH: Update user role\r\nexport async function PATCH(\r\n    req: Request,\r\n    context: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const isAdmin = await checkAdminAuth()\r\n        if (!isAdmin) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const { id } = await context.params\r\n        const body = await req.json()\r\n        const { role } = body\r\n\r\n        if (!role || ![\"USER\", \"AGENT\", \"KABADIWALA\", \"ADMIN\"].includes(role)) {\r\n            return NextResponse.json({ error: \"Invalid role\" }, { status: 400 })\r\n        }\r\n\r\n        await db.user.update({\r\n            where: { id },\r\n            data: { role }\r\n        })\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to update user\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\auth\\[...nextauth]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\auth\\change-password\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\auth\\login\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\auth\\logout\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\auth\\otp-login\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\auth\\register\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\auth\\reset-password\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\auth\\verify\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'db' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { db } from \"@/lib/db\"\r\nimport { generateVerificationToken, sendVerificationToken, verifyToken } from \"@/lib/verification\"\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const body = await req.json()\r\n        const { action, identifier, type, token } = body\r\n\r\n        if (!identifier || !type) {\r\n            return NextResponse.json({ error: \"Missing fields\" }, { status: 400 })\r\n        }\r\n\r\n        if (action === \"SEND\") {\r\n            const code = await generateVerificationToken(identifier, type)\r\n            await sendVerificationToken(identifier, code, type)\r\n            return NextResponse.json({ success: true, message: \"Code sent\" })\r\n        }\r\n\r\n        if (action === \"VERIFY\") {\r\n            if (!token) return NextResponse.json({ error: \"Token required\" }, { status: 400 })\r\n\r\n            const result = await verifyToken(identifier, token, type)\r\n\r\n            if (!result.success) {\r\n                return NextResponse.json({ error: result.error }, { status: 400 })\r\n            }\r\n\r\n            return NextResponse.json({ success: true, message: \"Verified successfully\" })\r\n        }\r\n\r\n        return NextResponse.json({ error: \"Invalid action\" }, { status: 400 })\r\n    } catch (error) {\r\n        console.error(\"Verification error:\", error)\r\n        return NextResponse.json({ error: \"Internal error\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\chat\\[id]\\read\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\chat\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\chat\\message\\[messageId]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":41,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":90,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":90,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\nimport { db } from \"@/lib/db\"\r\n\r\nexport async function DELETE(\r\n    req: Request,\r\n    context: { params: Promise<{ messageId: string }> }\r\n) {\r\n    try {\r\n        const cookieStore = await cookies()\r\n        const userId = cookieStore.get(\"userId\")?.value\r\n        if (!userId) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const { messageId } = await context.params\r\n\r\n        const message = await db.message.findUnique({\r\n            where: { id: messageId }\r\n        })\r\n\r\n        if (!message) {\r\n            return NextResponse.json({ error: \"Message not found\" }, { status: 404 })\r\n        }\r\n\r\n        if (message.senderId !== userId) {\r\n            return NextResponse.json({ error: \"Not allowed\" }, { status: 403 })\r\n        }\r\n\r\n        // Soft delete\r\n        const updated = await db.message.update({\r\n            where: { id: messageId },\r\n            data: {\r\n                isDeleted: true,\r\n                deletedAt: new Date(),\r\n                content: \"\" // Clear content for privacy\r\n            }\r\n        })\r\n\r\n        return NextResponse.json({ success: true, message: updated })\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to delete\" }, { status: 500 })\r\n    }\r\n}\r\n\r\nexport async function PATCH(\r\n    req: Request,\r\n    context: { params: Promise<{ messageId: string }> }\r\n) {\r\n    try {\r\n        const cookieStore = await cookies()\r\n        const userId = cookieStore.get(\"userId\")?.value\r\n        if (!userId) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const { messageId } = await context.params\r\n        const body = await req.json()\r\n        const { content } = body\r\n\r\n        if (!content) {\r\n            return NextResponse.json({ error: \"Content required\" }, { status: 400 })\r\n        }\r\n\r\n        const message = await db.message.findUnique({\r\n            where: { id: messageId }\r\n        })\r\n\r\n        if (!message) {\r\n            return NextResponse.json({ error: \"Message not found\" }, { status: 404 })\r\n        }\r\n\r\n        if (message.senderId !== userId) {\r\n            return NextResponse.json({ error: \"Not allowed\" }, { status: 403 })\r\n        }\r\n\r\n        if (message.isDeleted) {\r\n            return NextResponse.json({ error: \"Cannot edit deleted message\" }, { status: 400 })\r\n        }\r\n\r\n        const updated = await db.message.update({\r\n            where: { id: messageId },\r\n            data: {\r\n                content,\r\n                editedAt: new Date()\r\n            }\r\n        })\r\n\r\n        return NextResponse.json({ success: true, message: updated })\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to edit\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\chat\\report\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\debug\\session\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\favorites\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\kabadiwala\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cookies' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":40,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\nimport { db } from \"@/lib/db\"\r\n\r\n// GET: Get kabadiwala details\r\nexport async function GET(\r\n    req: Request,\r\n    context: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const { id } = await context.params\r\n\r\n        const kabadiwala = await db.user.findUnique({\r\n            where: { id },\r\n            select: {\r\n                id: true,\r\n                name: true,\r\n                phone: true,\r\n                kabadiwalaProfile: {\r\n                    select: {\r\n                        businessName: true,\r\n                        bio: true,\r\n                        serviceArea: true,\r\n                        rating: true,\r\n                        totalReviews: true,\r\n                        totalPickups: true,\r\n                        isVerified: true,\r\n                        rates: true,\r\n                        serviceHours: true\r\n                    }\r\n                }\r\n            }\r\n        })\r\n\r\n        if (!kabadiwala) {\r\n            return NextResponse.json({ error: \"Not found\" }, { status: 404 })\r\n        }\r\n\r\n        return NextResponse.json(kabadiwala)\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\kabadiwala\\inventory\\route.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":29,"column":17,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":29,"endColumn":30,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[905,918],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from \"@/lib/db\"\r\nimport { cookies } from \"next/headers\"\r\nimport { NextResponse } from \"next/server\"\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const cookieStore = await cookies()\r\n        const userId = cookieStore.get(\"userId\")?.value\r\n\r\n        if (!userId) {\r\n            return new NextResponse(\"Unauthorized\", { status: 401 })\r\n        }\r\n\r\n        const user = await db.user.findUnique({\r\n            where: { id: userId },\r\n            include: { kabadiwalaProfile: true }\r\n        })\r\n\r\n        if (!user || user.role !== \"KABADIWALA\" || !user.kabadiwalaProfile) {\r\n            return new NextResponse(\"Forbidden\", { status: 403 })\r\n        }\r\n\r\n        const body = await req.json()\r\n        const { inventory } = body\r\n\r\n        await db.kabadiwalaProfile.update({\r\n            where: { id: user.kabadiwalaProfile.id },\r\n            data: {\r\n                // @ts-ignore\r\n                inventory: JSON.stringify(inventory)\r\n            }\r\n        })\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error) {\r\n        console.error(\"[INVENTORY_POST]\", error)\r\n        return new NextResponse(\"Internal Error\", { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\kabadiwala\\profile\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\kabadiwala\\rates\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\kabadiwala\\status\\route.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":28,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":28,"endColumn":26,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[882,895],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from \"@/lib/db\"\r\nimport { cookies } from \"next/headers\"\r\nimport { NextResponse } from \"next/server\"\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const cookieStore = await cookies()\r\n        const userId = cookieStore.get(\"userId\")?.value\r\n\r\n        if (!userId) {\r\n            return new NextResponse(\"Unauthorized\", { status: 401 })\r\n        }\r\n\r\n        const user = await db.user.findUnique({\r\n            where: { id: userId },\r\n            include: { kabadiwalaProfile: true }\r\n        })\r\n\r\n        if (!user || user.role !== \"KABADIWALA\" || !user.kabadiwalaProfile) {\r\n            return new NextResponse(\"Forbidden\", { status: 403 })\r\n        }\r\n\r\n        const body = await req.json()\r\n        const { isAvailable } = body\r\n\r\n        await db.kabadiwalaProfile.update({\r\n            where: { id: user.kabadiwalaProfile.id },\r\n            // @ts-ignore\r\n            data: { isAvailable }\r\n        })\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error) {\r\n        console.error(\"[STATUS_POST]\", error)\r\n        return new NextResponse(\"Internal Error\", { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\notifications\\subscribe\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\notifications\\vapid-key\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\orders\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cancelReason' is assigned a value but never used.","line":69,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":50}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\r\nimport { db } from \"@/lib/db\"\r\nimport { cookies } from \"next/headers\"\r\n\r\nasync function getCurrentUser() {\r\n    const cookieStore = await cookies()\r\n    const userId = cookieStore.get(\"userId\")?.value\r\n    if (!userId) return null\r\n    return db.user.findUnique({ where: { id: userId } })\r\n}\r\n\r\n// GET: Get single order\r\nexport async function GET(\r\n    request: NextRequest,\r\n    { params }: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const user = await getCurrentUser()\r\n        if (!user) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const { id } = await params\r\n        const order = await db.order.findUnique({\r\n            where: { id },\r\n            include: {\r\n                seller: { select: { id: true, name: true, phone: true } },\r\n                buyer: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                        phone: true,\r\n                        kabadiwalaProfile: { select: { businessName: true, rating: true, isVerified: true } }\r\n                    }\r\n                },\r\n                review: true\r\n            }\r\n        })\r\n\r\n        if (!order) {\r\n            return NextResponse.json({ error: \"Order not found\" }, { status: 404 })\r\n        }\r\n\r\n        // Check authorization\r\n        if (order.sellerId !== user.id && order.buyerId !== user.id) {\r\n            return NextResponse.json({ error: \"Not authorized\" }, { status: 403 })\r\n        }\r\n\r\n        return NextResponse.json(order)\r\n    } catch (error) {\r\n        console.error(\"Order fetch error:\", error)\r\n        return NextResponse.json({ error: \"Failed to fetch order\" }, { status: 500 })\r\n    }\r\n}\r\n\r\n// PATCH: Update order status\r\nexport async function PATCH(\r\n    request: NextRequest,\r\n    { params }: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const user = await getCurrentUser()\r\n        if (!user) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const { id } = await params\r\n        const body = await request.json()\r\n        const { status, totalAmount, cancelReason } = body\r\n\r\n        const order = await db.order.findUnique({\r\n            where: { id },\r\n            select: { sellerId: true, buyerId: true, status: true }\r\n        })\r\n\r\n        if (!order) {\r\n            return NextResponse.json({ error: \"Order not found\" }, { status: 404 })\r\n        }\r\n\r\n        // Validate permissions\r\n        const isSeller = order.sellerId === user.id\r\n        const isBuyer = order.buyerId === user.id\r\n\r\n        if (!isSeller && !isBuyer) {\r\n            return NextResponse.json({ error: \"Not authorized\" }, { status: 403 })\r\n        }\r\n\r\n        // Validate status transitions\r\n        const validTransitions: Record<string, string[]> = {\r\n            \"REQUESTED\": [\"ACCEPTED\", \"CANCELLED\"],\r\n            \"ACCEPTED\": [\"COMPLETED\", \"CANCELLED\"],\r\n            \"COMPLETED\": [],\r\n            \"CANCELLED\": []\r\n        }\r\n\r\n        if (!validTransitions[order.status]?.includes(status)) {\r\n            return NextResponse.json({\r\n                error: `Cannot transition from ${order.status} to ${status}`\r\n            }, { status: 400 })\r\n        }\r\n\r\n        // Only buyer (Kabadiwala) can accept/complete\r\n        if ((status === \"ACCEPTED\" || status === \"COMPLETED\") && !isBuyer) {\r\n            return NextResponse.json({ error: \"Only Kabadiwala can accept/complete orders\" }, { status: 403 })\r\n        }\r\n\r\n        // Update order\r\n        const updateData: Record<string, unknown> = { status }\r\n\r\n        if (status === \"COMPLETED\" && totalAmount) {\r\n            updateData.totalAmount = totalAmount\r\n\r\n            // Update kabadiwala stats\r\n            await db.kabadiwalaProfile.updateMany({\r\n                where: { userId: order.buyerId },\r\n                data: { totalPickups: { increment: 1 } }\r\n            })\r\n        }\r\n\r\n        const updated = await db.order.update({\r\n            where: { id },\r\n            data: updateData,\r\n            include: {\r\n                seller: { select: { id: true, name: true, phone: true } },\r\n                buyer: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                        phone: true,\r\n                        kabadiwalaProfile: { select: { businessName: true } }\r\n                    }\r\n                }\r\n            }\r\n        })\r\n\r\n        // Notify User\r\n        const { sendNotification } = await import(\"@/lib/notifications\")\r\n        const { awardPoints } = await import(\"@/actions/gamification\")\r\n\r\n        if (status === \"ACCEPTED\") {\r\n            await sendNotification(\r\n                updated.sellerId,\r\n                \"Order Accepted! \",\r\n                `${updated.buyer.kabadiwalaProfile?.businessName || updated.buyer.name} is coming to pick up your scrap.`,\r\n                \"/orders\"\r\n            )\r\n        } else if (status === \"COMPLETED\") {\r\n            // Award Points to Seller\r\n            await awardPoints(order.sellerId, \"ORDER_COMPLETED\")\r\n\r\n            await sendNotification(\r\n                order.sellerId,\r\n                \"Pickup Completed \",\r\n                `Your order #${id.slice(-6)} has been completed. You earned 100 Green Points!`,\r\n                `/orders/${id}`\r\n            )\r\n        } else if (status === \"CANCELLED\") {\r\n            // Notify the other party\r\n            const targetId = isSeller ? updated.buyerId : updated.sellerId\r\n            if (targetId) {\r\n                await sendNotification(\r\n                    targetId,\r\n                    \"Order Cancelled \",\r\n                    `Order has been cancelled by ${isSeller ? 'User' : 'Kabadiwala'}.`,\r\n                    \"/orders\"\r\n                )\r\n            }\r\n        }\r\n\r\n        return NextResponse.json(updated)\r\n    } catch (error) {\r\n        console.error(\"Order update error:\", error)\r\n        return NextResponse.json({ error: \"Failed to update order\" }, { status: 500 })\r\n    }\r\n}\r\n\r\n// DELETE: Cancel order\r\nexport async function DELETE(\r\n    request: NextRequest,\r\n    { params }: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const user = await getCurrentUser()\r\n        if (!user) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const { id } = await params\r\n        const order = await db.order.findUnique({\r\n            where: { id },\r\n            select: { sellerId: true, buyerId: true, status: true }\r\n        })\r\n\r\n        if (!order) {\r\n            return NextResponse.json({ error: \"Order not found\" }, { status: 404 })\r\n        }\r\n\r\n        if (order.sellerId !== user.id && order.buyerId !== user.id) {\r\n            return NextResponse.json({ error: \"Not authorized\" }, { status: 403 })\r\n        }\r\n\r\n        // Can only cancel if not completed\r\n        if (order.status === \"COMPLETED\") {\r\n            return NextResponse.json({ error: \"Cannot cancel completed orders\" }, { status: 400 })\r\n        }\r\n\r\n        await db.order.update({\r\n            where: { id },\r\n            data: { status: \"CANCELLED\" }\r\n        })\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error) {\r\n        console.error(\"Order delete error:\", error)\r\n        return NextResponse.json({ error: \"Failed to cancel order\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\orders\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":54,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":86,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":86,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\nimport { db } from \"@/lib/db\"\r\n\r\n// POST: Create new order\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const cookieStore = await cookies()\r\n        const userId = cookieStore.get(\"userId\")?.value\r\n\r\n        if (!userId) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const { kabadiwalaId, address, items, pickupDate } = await req.json()\r\n\r\n        if (!kabadiwalaId || !address || !pickupDate) {\r\n            return NextResponse.json({ error: \"Missing fields\" }, { status: 400 })\r\n        }\r\n\r\n        const order = await db.order.create({\r\n            data: {\r\n                sellerId: userId,\r\n                buyerId: kabadiwalaId,\r\n                address,\r\n                items: items || \"\",\r\n                pickupDate: new Date(pickupDate),\r\n                status: \"REQUESTED\"\r\n            },\r\n            include: {\r\n                seller: { select: { name: true } }\r\n            }\r\n        })\r\n\r\n        // Notify Kabadiwala\r\n        if (order.buyerId) {\r\n            const { sendNotification } = await import(\"@/lib/notifications\")\r\n            await sendNotification(\r\n                order.buyerId,\r\n                \"New Pickup Request \",\r\n                `${order.seller.name || 'A user'} requested a pickup at ${address}`,\r\n                \"/orders\"\r\n            )\r\n        }\r\n\r\n        return NextResponse.json({ success: true, order })\r\n    } catch (error) {\r\n        console.error(\"Order creation error:\", error)\r\n        return NextResponse.json({ error: \"Failed\" }, { status: 500 })\r\n    }\r\n}\r\n\r\n// GET: Get orders for current user\r\nexport async function GET(req: Request) {\r\n    try {\r\n        const cookieStore = await cookies()\r\n        const userId = cookieStore.get(\"userId\")?.value\r\n\r\n        if (!userId) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const orders = await db.order.findMany({\r\n            where: {\r\n                OR: [\r\n                    { sellerId: userId },\r\n                    { buyerId: userId }\r\n                ]\r\n            },\r\n            include: {\r\n                seller: { select: { id: true, name: true, phone: true } },\r\n                buyer: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                        phone: true,\r\n                        kabadiwalaProfile: { select: { businessName: true, rating: true, isVerified: true } }\r\n                    }\r\n                },\r\n                review: true\r\n            },\r\n            orderBy: { createdAt: \"desc\" }\r\n        })\r\n\r\n        return NextResponse.json(orders)\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\otp\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\profile\\addresses\\[id]\\default\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":32,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\nimport { db } from \"@/lib/db\"\r\n\r\n// PUT: Set address as default\r\nexport async function PUT(\r\n    req: Request,\r\n    context: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const cookieStore = await cookies()\r\n        const userId = cookieStore.get(\"userId\")?.value\r\n        const { id } = await context.params\r\n\r\n        if (!userId) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        // First, unset all defaults\r\n        await db.address.updateMany({\r\n            where: { userId },\r\n            data: { isDefault: false }\r\n        })\r\n\r\n        // Set the new default\r\n        await db.address.update({\r\n            where: { id },\r\n            data: { isDefault: true }\r\n        })\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to update\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\profile\\addresses\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":30,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\nimport { db } from \"@/lib/db\"\r\n\r\n// DELETE: Remove address\r\nexport async function DELETE(\r\n    req: Request,\r\n    context: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const cookieStore = await cookies()\r\n        const userId = cookieStore.get(\"userId\")?.value\r\n        const { id } = await context.params\r\n\r\n        if (!userId) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const address = await db.address.findFirst({\r\n            where: { id, userId }\r\n        })\r\n\r\n        if (!address) {\r\n            return NextResponse.json({ error: \"Address not found\" }, { status: 404 })\r\n        }\r\n\r\n        await db.address.delete({ where: { id } })\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to delete\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\profile\\addresses\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":56,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":56,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\nimport { db } from \"@/lib/db\"\r\n\r\n// POST: Add new address\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const cookieStore = await cookies()\r\n        const userId = cookieStore.get(\"userId\")?.value\r\n\r\n        if (!userId) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const { label, address } = await req.json()\r\n\r\n        if (!label || !address) {\r\n            return NextResponse.json({ error: \"Missing fields\" }, { status: 400 })\r\n        }\r\n\r\n        // Check if this is the first address (make it default)\r\n        const existingCount = await db.address.count({ where: { userId } })\r\n\r\n        const newAddress = await db.address.create({\r\n            data: {\r\n                userId,\r\n                label,\r\n                address,\r\n                isDefault: existingCount === 0\r\n            }\r\n        })\r\n\r\n        return NextResponse.json({ address: newAddress })\r\n    } catch (error) {\r\n        console.error(\"Address create error:\", error)\r\n        return NextResponse.json({ error: \"Failed to add address\" }, { status: 500 })\r\n    }\r\n}\r\n\r\n// GET: List all addresses\r\nexport async function GET() {\r\n    try {\r\n        const cookieStore = await cookies()\r\n        const userId = cookieStore.get(\"userId\")?.value\r\n\r\n        if (!userId) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const addresses = await db.address.findMany({\r\n            where: { userId },\r\n            orderBy: { isDefault: \"desc\" }\r\n        })\r\n\r\n        return NextResponse.json({ addresses })\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to fetch addresses\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\profile\\favorites\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":22,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\nimport { db } from \"@/lib/db\"\r\n\r\n// DELETE: Remove from favorites\r\nexport async function DELETE(\r\n    req: Request,\r\n    context: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const cookieStore = await cookies()\r\n        const userId = cookieStore.get(\"userId\")?.value\r\n        const { id } = await context.params\r\n\r\n        if (!userId) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        await db.favorite.delete({ where: { id } })\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to remove\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\profile\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'password' is assigned a value but never used.","line":37,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'notificationsEnabled' is assigned a value but never used.","line":54,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'emailNotifications' is assigned a value but never used.","line":54,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":79},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'smsNotifications' is assigned a value but never used.","line":54,"column":81,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":97},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2667,2670],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2667,2670],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Profile API Route\r\n * -----------------\r\n * GET:    Fetch current user's profile data\r\n * PUT:    Update profile (name, address, image, cover for kabadiwalas)\r\n * DELETE: Delete user account (requires password confirmation)\r\n * \r\n * Uses legacy cookies for authentication consistency.\r\n */\r\nimport { NextRequest, NextResponse } from \"next/server\"\r\nimport { db } from \"@/lib/db\"\r\nimport { cookies } from \"next/headers\"\r\nimport bcrypt from \"bcryptjs\"\r\n\r\nasync function getCurrentUser() {\r\n    const cookieStore = await cookies()\r\n    const userId = cookieStore.get(\"userId\")?.value\r\n    if (!userId) return null\r\n    return db.user.findUnique({\r\n        where: { id: userId },\r\n        include: {\r\n            sellerProfile: true,\r\n            kabadiwalaProfile: true\r\n        }\r\n    })\r\n}\r\n\r\n// GET: Get current user profile\r\nexport async function GET() {\r\n    try {\r\n        const user = await getCurrentUser()\r\n        if (!user) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        // Don't send password\r\n        const { password, ...safeUser } = user\r\n        return NextResponse.json(safeUser)\r\n    } catch (error) {\r\n        console.error(\"Profile fetch error:\", error)\r\n        return NextResponse.json({ error: \"Failed to fetch profile\" }, { status: 500 })\r\n    }\r\n}\r\n\r\n// PUT: Update profile\r\nexport async function PUT(request: NextRequest) {\r\n    try {\r\n        const user = await getCurrentUser()\r\n        if (!user) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const body = await request.json()\r\n        const { name, address, image, notificationsEnabled, emailNotifications, smsNotifications,\r\n            // Kabadiwala fields\r\n            coverImage, businessName, serviceArea\r\n        } = body\r\n\r\n        const updateData: Record<string, unknown> = {}\r\n\r\n        if (name !== undefined) updateData.name = name\r\n        if (address !== undefined) updateData.address = address\r\n        if (image !== undefined) updateData.image = image\r\n\r\n        // Transaction to update both User and KabadiwalaProfile if needed\r\n        const updated = await db.$transaction(async (prisma) => {\r\n            const updatedUser = await prisma.user.update({\r\n                where: { id: user.id },\r\n                data: updateData,\r\n                include: { kabadiwalaProfile: true }\r\n            })\r\n\r\n            // If user is a Kabadiwala, update their profile too\r\n            if (user.role === 'KABADIWALA' && (coverImage !== undefined || businessName !== undefined || serviceArea !== undefined)) {\r\n                const kabadiwalaUpdate: any = {}\r\n                if (coverImage !== undefined) kabadiwalaUpdate.coverImage = coverImage\r\n                if (businessName !== undefined) kabadiwalaUpdate.businessName = businessName\r\n                if (serviceArea !== undefined) kabadiwalaUpdate.serviceArea = serviceArea\r\n\r\n                await prisma.kabadiwalaProfile.upsert({\r\n                    where: { userId: user.id },\r\n                    create: {\r\n                        userId: user.id,\r\n                        businessName: businessName || user.name || \"My Business\",\r\n                        ...kabadiwalaUpdate\r\n                    },\r\n                    update: kabadiwalaUpdate\r\n                })\r\n            }\r\n\r\n            return updatedUser\r\n        })\r\n\r\n        return NextResponse.json(updated)\r\n    } catch (error) {\r\n        console.error(\"Profile update error:\", error)\r\n        return NextResponse.json({ error: \"Failed to update profile\" }, { status: 500 })\r\n    }\r\n}\r\n\r\n// DELETE: Delete account\r\nexport async function DELETE(request: NextRequest) {\r\n    try {\r\n        const user = await getCurrentUser()\r\n        if (!user) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const body = await request.json()\r\n        const { password, confirmDelete } = body\r\n\r\n        if (confirmDelete !== \"DELETE MY ACCOUNT\") {\r\n            return NextResponse.json({ error: \"Please type 'DELETE MY ACCOUNT' to confirm\" }, { status: 400 })\r\n        }\r\n\r\n        // Verify password\r\n        const isValid = await bcrypt.compare(password, user.password)\r\n        if (!isValid) {\r\n            return NextResponse.json({ error: \"Incorrect password\" }, { status: 401 })\r\n        }\r\n\r\n        // Delete user and all related data (cascades)\r\n        await db.user.delete({\r\n            where: { id: user.id }\r\n        })\r\n\r\n        // Clear cookies\r\n        const cookieStore = await cookies()\r\n        cookieStore.delete(\"userId\")\r\n\r\n        return NextResponse.json({ success: true, message: \"Account deleted successfully\" })\r\n    } catch (error) {\r\n        console.error(\"Account delete error:\", error)\r\n        return NextResponse.json({ error: \"Failed to delete account\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\reviews\\[orderId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\setup\\admin-password\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":42,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { db } from \"@/lib/db\"\r\nimport { hash } from \"bcryptjs\"\r\n\r\n// GET /api/setup/admin-password?password=YOUR_SECURE_PASSWORD\r\nexport async function GET(req: Request) {\r\n    const { searchParams } = new URL(req.url)\r\n    const password = searchParams.get(\"password\")\r\n\r\n    if (!password || password.length < 6) {\r\n        return NextResponse.json({ error: \"Password must be at least 6 characters\" }, { status: 400 })\r\n    }\r\n\r\n    try {\r\n        const hashedPassword = await hash(password, 10)\r\n\r\n        const existing = await db.adminConfig.findFirst()\r\n\r\n        if (existing) {\r\n            await db.adminConfig.update({\r\n                where: { id: existing.id },\r\n                data: {\r\n                    adminPassword: hashedPassword,\r\n                    isSetup: true,\r\n                    failedAttempts: 0,\r\n                    lockedUntil: null\r\n                }\r\n            })\r\n        } else {\r\n            await db.adminConfig.create({\r\n                data: {\r\n                    adminPassword: hashedPassword,\r\n                    isSetup: true\r\n                }\r\n            })\r\n        }\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            message: \"Admin password updated successfully. You can now login to the panel.\"\r\n        })\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to setup admin config\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\setup\\admin\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":23,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\r\nimport { db } from \"@/lib/db\"\r\n\r\n// GET /api/setup/admin?phone=1234567890\r\nexport async function GET(req: Request) {\r\n    const { searchParams } = new URL(req.url)\r\n    const phone = searchParams.get(\"phone\")\r\n\r\n    if (!phone) {\r\n        return NextResponse.json({ error: \"Phone number required\" }, { status: 400 })\r\n    }\r\n\r\n    try {\r\n        const user = await db.user.update({\r\n            where: { phone },\r\n            data: { role: \"ADMIN\" }\r\n        })\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            message: `User ${user.name} (${user.phone}) is now an ADMIN.`\r\n        })\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"User not found or failed to update\" }, { status: 404 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\stories\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\stories\\[id]\\view\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\stories\\cleanup\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\stories\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2340,2343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2340,2343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Stories API Route\r\n * -----------------\r\n * GET:  Fetch all active stories grouped by user\r\n * POST: Create a new story (text or image)\r\n * \r\n * Uses legacy cookie auth for compatibility with current login system.\r\n */\r\nimport { NextRequest, NextResponse } from \"next/server\"\r\nimport { db } from \"@/lib/db\"\r\nimport { cookies } from \"next/headers\"\r\n\r\n// Get current user from cookies (legacy auth)\r\nasync function getCurrentUser() {\r\n    const cookieStore = await cookies()\r\n    const userId = cookieStore.get(\"userId\")?.value\r\n    if (!userId) return null\r\n    return db.user.findUnique({ where: { id: userId } })\r\n}\r\n\r\n// GET: Fetch all active stories grouped by user\r\nexport async function GET() {\r\n    try {\r\n        const currentUser = await getCurrentUser()\r\n\r\n        const stories = await db.story.findMany({\r\n            where: {\r\n                isActive: true,\r\n                expiresAt: { gt: new Date() }\r\n            },\r\n            include: {\r\n                user: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                        image: true,\r\n                        kabadiwalaProfile: {\r\n                            select: { businessName: true }\r\n                        }\r\n                    }\r\n                },\r\n                views: currentUser ? {\r\n                    where: { viewerId: currentUser.id },\r\n                    select: { id: true }\r\n                } : false\r\n            },\r\n            orderBy: { createdAt: \"desc\" }\r\n        })\r\n\r\n        // Group stories by user\r\n        const groupedMap = new Map<string, {\r\n            user: typeof stories[0][\"user\"]\r\n            stories: typeof stories\r\n            hasUnviewed: boolean\r\n        }>()\r\n\r\n        for (const story of stories) {\r\n            const userId = story.user.id\r\n            if (!groupedMap.has(userId)) {\r\n                groupedMap.set(userId, {\r\n                    user: story.user,\r\n                    stories: [],\r\n                    hasUnviewed: false\r\n                })\r\n            }\r\n            const group = groupedMap.get(userId)!\r\n            const hasViewed = currentUser && Array.isArray(story.views) ? story.views.length > 0 : false\r\n            group.stories.push({\r\n                ...story,\r\n                hasViewed\r\n            } as any)\r\n            if (!hasViewed) {\r\n                group.hasUnviewed = true\r\n            }\r\n        }\r\n\r\n        // Convert to array and sort (unviewed first, then by latest story)\r\n        const groups = Array.from(groupedMap.values())\r\n        groups.sort((a, b) => {\r\n            if (a.hasUnviewed && !b.hasUnviewed) return -1\r\n            if (!a.hasUnviewed && b.hasUnviewed) return 1\r\n            return new Date(b.stories[0].createdAt).getTime() -\r\n                new Date(a.stories[0].createdAt).getTime()\r\n        })\r\n\r\n        return NextResponse.json(groups)\r\n    } catch (error) {\r\n        console.error(\"Stories fetch error:\", error)\r\n        return NextResponse.json({ error: \"Failed to fetch stories\" }, { status: 500 })\r\n    }\r\n}\r\n\r\n// POST: Create a new story\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const user = await getCurrentUser()\r\n        if (!user) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const body = await request.json()\r\n        const { mediaType, mediaUrl, text, bgColor, caption } = body\r\n\r\n        // Validate\r\n        if (!mediaType || ![\"TEXT\", \"IMAGE\", \"VIDEO\"].includes(mediaType)) {\r\n            return NextResponse.json({ error: \"Invalid media type\" }, { status: 400 })\r\n        }\r\n\r\n        if (mediaType === \"TEXT\" && !text) {\r\n            return NextResponse.json({ error: \"Text is required for text stories\" }, { status: 400 })\r\n        }\r\n\r\n        if ((mediaType === \"IMAGE\" || mediaType === \"VIDEO\") && !mediaUrl) {\r\n            return NextResponse.json({ error: \"Media URL is required\" }, { status: 400 })\r\n        }\r\n\r\n        // Create story (expires in 24 hours)\r\n        const expiresAt = new Date()\r\n        expiresAt.setHours(expiresAt.getHours() + 24)\r\n\r\n        const story = await db.story.create({\r\n            data: {\r\n                userId: user.id,\r\n                mediaType,\r\n                mediaUrl: mediaUrl || null,\r\n                text: text || null,\r\n                bgColor: bgColor || null,\r\n                caption: caption || null,\r\n                expiresAt\r\n            },\r\n            include: {\r\n                user: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                        image: true\r\n                    }\r\n                }\r\n            }\r\n        })\r\n\r\n        return NextResponse.json(story, { status: 201 })\r\n    } catch (error) {\r\n        console.error(\"Story creation error:\", error)\r\n        return NextResponse.json({ error: \"Failed to create story\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\upload\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'db' is defined but never used.","line":16,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * File Upload API\r\n * ---------------\r\n * POST: Upload images for stories, profiles, and covers.\r\n * \r\n * Supported types: JPEG, PNG, GIF, WebP\r\n * Max size: 5MB per file\r\n * Storage: /public/uploads/{type}/\r\n * \r\n * Uses legacy cookie auth for compatibility with current login system.\r\n */\r\nimport { NextRequest, NextResponse } from \"next/server\"\r\nimport { writeFile, mkdir } from \"fs/promises\"\r\nimport path from \"path\"\r\nimport { cookies } from \"next/headers\"\r\nimport { db } from \"@/lib/db\"\r\n\r\n// Get current user from cookies (legacy auth)\r\nasync function getCurrentUser() {\r\n    const cookieStore = await cookies()\r\n    const userId = cookieStore.get(\"userId\")?.value\r\n    if (!userId) return null\r\n    return { id: userId }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const user = await getCurrentUser()\r\n        if (!user) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n        }\r\n\r\n        const formData = await request.formData()\r\n        const file = formData.get(\"file\") as File\r\n        const type = formData.get(\"type\") as string || \"story\" // story, profile, cover\r\n\r\n        if (!file) {\r\n            return NextResponse.json({ error: \"No file provided\" }, { status: 400 })\r\n        }\r\n\r\n        // Validate file type\r\n        const allowedTypes = [\"image/jpeg\", \"image/png\", \"image/gif\", \"image/webp\"]\r\n        if (!allowedTypes.includes(file.type)) {\r\n            return NextResponse.json({ error: \"Invalid file type. Only JPEG, PNG, GIF, WebP allowed.\" }, { status: 400 })\r\n        }\r\n\r\n        // Validate file size (5MB max)\r\n        if (file.size > 5 * 1024 * 1024) {\r\n            return NextResponse.json({ error: \"File too large. Max 5MB allowed.\" }, { status: 400 })\r\n        }\r\n\r\n        // Create upload directory if it doesn't exist\r\n        const uploadDir = path.join(process.cwd(), \"public\", \"uploads\", type)\r\n        await mkdir(uploadDir, { recursive: true })\r\n\r\n        // Generate unique filename\r\n        const ext = file.name.split(\".\").pop() || \"jpg\"\r\n        const filename = `${user.id}-${Date.now()}.${ext}`\r\n\r\n        // Save file\r\n        const bytes = await file.arrayBuffer()\r\n        const buffer = Buffer.from(bytes)\r\n        const filepath = path.join(uploadDir, filename)\r\n        await writeFile(filepath, buffer)\r\n\r\n        // Return public URL\r\n        const url = `/uploads/${type}/${filename}`\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            url,\r\n            filename,\r\n            size: file.size,\r\n            type: file.type\r\n        })\r\n    } catch (error) {\r\n        console.error(\"Upload error:\", error)\r\n        return NextResponse.json({ error: \"Failed to upload file\" }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\api\\user\\telemetry\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\book\\[kabadiwalaId]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":65,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":68,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":156,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":156,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect, use } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Loader2, Calendar, MapPin, Package, Plus, Trash2, Calculator, IndianRupee, Clock } from \"lucide-react\"\r\nimport { toast } from \"sonner\"\r\nimport { SCRAP_CATEGORIES } from \"@/lib/scrap-categories\"\r\n\r\ninterface Kabadiwala {\r\n    id: string\r\n    name: string\r\n    kabadiwalaProfile?: {\r\n        businessName: string\r\n        rating: number\r\n        serviceArea: string\r\n        rates: string // JSON string\r\n    }\r\n}\r\n\r\ninterface ScrapItem {\r\n    id: string\r\n    type: string\r\n    weight: number\r\n    rate: number\r\n    amount: number\r\n}\r\n\r\nexport default function BookPickupPage({ params }: { params: Promise<{ kabadiwalaId: string }> }) {\r\n    const router = useRouter()\r\n    const resolvedParams = use(params)\r\n    const kabadiwalaId = resolvedParams.kabadiwalaId\r\n\r\n    const [kabadiwala, setKabadiwala] = useState<Kabadiwala | null>(null)\r\n    const [loading, setLoading] = useState(true)\r\n    const [submitting, setSubmitting] = useState(false)\r\n\r\n    // Form State\r\n    const [address, setAddress] = useState(\"\")\r\n    const [date, setDate] = useState(\"\")\r\n    const [timeSlot, setTimeSlot] = useState(\"Morning\")\r\n\r\n    // Calculator State\r\n    const [scrapItems, setScrapItems] = useState<ScrapItem[]>([])\r\n    const [selectedMaterial, setSelectedMaterial] = useState(\"\")\r\n    const [weight, setWeight] = useState(\"\")\r\n    const [parsedRates, setParsedRates] = useState<Record<string, number>>({})\r\n\r\n    useEffect(() => {\r\n        async function fetchKabadiwala() {\r\n            try {\r\n                const res = await fetch(`/api/kabadiwala/${kabadiwalaId}`)\r\n                if (res.ok) {\r\n                    const data = await res.json()\r\n                    setKabadiwala(data)\r\n                    if (data.kabadiwalaProfile?.rates) {\r\n                        try {\r\n                            setParsedRates(JSON.parse(data.kabadiwalaProfile.rates))\r\n                        } catch (e) { }\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch kabadiwala\")\r\n                toast.error(\"Could not load Kabadiwala details\")\r\n            } finally {\r\n                setLoading(false)\r\n            }\r\n        }\r\n        fetchKabadiwala()\r\n    }, [kabadiwalaId])\r\n\r\n    const handleAddItem = () => {\r\n        if (!selectedMaterial || !weight) return\r\n\r\n        const weightNum = parseFloat(weight)\r\n        if (isNaN(weightNum) || weightNum <= 0) {\r\n            toast.error(\"Please enter a valid weight\")\r\n            return\r\n        }\r\n\r\n        // Check if rate exists in kabadiwala profile, else use default\r\n        const selectedCat = SCRAP_CATEGORIES.find(c => c.id === selectedMaterial)\r\n        const rate = (parsedRates && parsedRates[selectedMaterial])\r\n            ? parsedRates[selectedMaterial]\r\n            : (selectedCat?.defaultRate || 0)\r\n\r\n        const amount = rate * weightNum\r\n\r\n        const newItem: ScrapItem = {\r\n            id: Date.now().toString(),\r\n            type: selectedCat?.label || selectedMaterial,\r\n            weight: weightNum,\r\n            rate,\r\n            amount\r\n        }\r\n\r\n        setScrapItems([...scrapItems, newItem])\r\n        setSelectedMaterial(\"\")\r\n        setWeight(\"\")\r\n    }\r\n\r\n    const removeItem = (id: string) => {\r\n        setScrapItems(scrapItems.filter(item => item.id !== id))\r\n    }\r\n\r\n    const totalEstimatedValue = scrapItems.reduce((sum, item) => sum + item.amount, 0)\r\n\r\n    async function handleSubmit(e: React.FormEvent) {\r\n        e.preventDefault()\r\n        if (!address || !date) {\r\n            toast.error(\"Please fill in address and date\")\r\n            return\r\n        }\r\n\r\n        if (scrapItems.length === 0) {\r\n            if (selectedMaterial && weight) {\r\n                toast.error(\"Please click 'Add' to include your item first!\", {\r\n                    description: \"You entered details but didn't add the item to the list.\"\r\n                })\r\n            } else {\r\n                toast.error(\"Please add at least one item to pickup\")\r\n            }\r\n            return\r\n        }\r\n\r\n        setSubmitting(true)\r\n        try {\r\n            // Convert structured items to string for backend compatibility\r\n            // but keeps strict structure for potential future parsing\r\n            const itemsString = JSON.stringify(scrapItems)\r\n\r\n            const res = await fetch(\"/api/orders\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({\r\n                    kabadiwalaId,\r\n                    address,\r\n                    items: itemsString,\r\n                    pickupDate: date\r\n                }),\r\n                credentials: 'include'\r\n            })\r\n\r\n            if (res.ok) {\r\n                toast.success(\"Pickup booked successfully!\")\r\n                router.push(\"/orders\") // Assume /orders exists, if not redirect to dashboard\r\n            } else {\r\n                toast.error(\"Failed to book pickup\")\r\n            }\r\n        } catch (error) {\r\n            toast.error(\"Network error\")\r\n        } finally {\r\n            setSubmitting(false)\r\n        }\r\n    }\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-[60vh]\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"container mx-auto py-8 px-4 max-w-2xl\">\r\n            <Card className=\"border-t-4 border-t-primary shadow-lg\">\r\n                <CardHeader className=\"bg-muted/30\">\r\n                    <CardTitle className=\"flex items-center gap-2 text-2xl\">\r\n                        <Package className=\"h-6 w-6 text-primary\" />\r\n                        Book Pickup\r\n                    </CardTitle>\r\n                    <CardDescription className=\"text-base\">\r\n                        Schedule a pickup with <span className=\"font-semibold text-foreground\">{kabadiwala?.kabadiwalaProfile?.businessName || kabadiwala?.name}</span>\r\n                    </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"pt-6\">\r\n                    <form onSubmit={handleSubmit} className=\"space-y-8\">\r\n\r\n                        {/* 1. Scrap Calculator Section */}\r\n                        <div className=\"space-y-4 rounded-lg border p-4 bg-card shadow-sm\">\r\n                            <div className=\"flex items-center gap-2 pb-2 border-b\">\r\n                                <Calculator className=\"h-4 w-4 text-primary\" />\r\n                                <h3 className=\"font-semibold\">Scrap Calculator</h3>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-12 gap-4\">\r\n                                <div className=\"md:col-span-5\">\r\n                                    <Label>Material Type</Label>\r\n                                    <Select value={selectedMaterial} onValueChange={setSelectedMaterial}>\r\n                                        <SelectTrigger className=\"h-12\">\r\n                                            <SelectValue placeholder=\"Search & Select Item...\" />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent className=\"max-h-[300px]\">\r\n                                            {/* Group by Category */}\r\n                                            {Array.from(new Set(SCRAP_CATEGORIES.map(c => c.category))).map(category => (\r\n                                                <div key={category}>\r\n                                                    <div className=\"px-2 py-1.5 text-xs font-semibold text-muted-foreground bg-muted/30 sticky top-0 z-10\">\r\n                                                        {category}\r\n                                                    </div>\r\n                                                    {SCRAP_CATEGORIES.filter(c => c.category === category).map(item => {\r\n                                                        const rate = parsedRates && parsedRates[item.id] ? parsedRates[item.id] : item.defaultRate\r\n                                                        return (\r\n                                                            <SelectItem key={item.id} value={item.id}>\r\n                                                                <span className=\"font-medium\">{item.label}</span>\r\n                                                                <span className=\"text-muted-foreground ml-2 text-xs\">(~{rate}/kg)</span>\r\n                                                            </SelectItem>\r\n                                                        )\r\n                                                    })}\r\n                                                </div>\r\n                                            ))}\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                                <div className=\"md:col-span-4\">\r\n                                    <Label>Est. Weight (kg)</Label>\r\n                                    <Input\r\n                                        type=\"number\"\r\n                                        placeholder=\"0\"\r\n                                        value={weight}\r\n                                        onChange={(e) => setWeight(e.target.value)}\r\n                                        className=\"h-12\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"md:col-span-3 flex items-end\">\r\n                                    <Button type=\"button\" onClick={handleAddItem} className=\"w-full h-12\" disabled={!selectedMaterial}>\r\n                                        <Plus className=\"h-4 w-4 mr-1\" /> Add\r\n                                    </Button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Item List */}\r\n                            {scrapItems.length > 0 && (\r\n                                <div className=\"space-y-2 mt-4\">\r\n                                    {scrapItems.map((item) => (\r\n                                        <div key={item.id} className=\"flex justify-between items-center bg-muted/50 p-2 rounded-md text-sm\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <Badge variant=\"outline\" className=\"capitalize\">{item.type}</Badge>\r\n                                                <span className=\"text-muted-foreground\">{item.weight} kg</span>\r\n                                            </div>\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <span className=\"font-medium\">{item.amount.toFixed(0)}</span>\r\n                                                <button type=\"button\" onClick={() => removeItem(item.id)} className=\"text-red-500 hover:text-red-700\">\r\n                                                    <Trash2 className=\"h-4 w-4\" />\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                    <div className=\"flex justify-between items-center pt-2 border-t font-bold\">\r\n                                        <span>Total Estimated Value:</span>\r\n                                        <span className=\"text-green-600 text-lg flex items-center\">\r\n                                            <IndianRupee className=\"h-4 w-4\" />\r\n                                            {totalEstimatedValue.toFixed(0)}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* 2. Pickup Details */}\r\n                        <div className=\"grid gap-6 md:grid-cols-2\">\r\n                            <div className=\"space-y-4\">\r\n                                <Label htmlFor=\"date\" className=\"flex items-center gap-2\">\r\n                                    <Calendar className=\"h-4 w-4\" /> Recommended Pickup Date\r\n                                </Label>\r\n                                <Input\r\n                                    type=\"date\"\r\n                                    id=\"date\"\r\n                                    value={date}\r\n                                    onChange={(e) => setDate(e.target.value)}\r\n                                    required\r\n                                    min={new Date().toISOString().split('T')[0]}\r\n                                    className=\"cursor-pointer\"\r\n                                />\r\n\r\n                                <Label className=\"flex items-center gap-2 pt-2\">\r\n                                    <Clock className=\"h-4 w-4\" /> Preferred Time Slot\r\n                                </Label>\r\n                                <div className=\"grid grid-cols-3 gap-2\">\r\n                                    {['Morning', 'Afternoon', 'Evening'].map((slot) => (\r\n                                        <div\r\n                                            key={slot}\r\n                                            onClick={() => setTimeSlot(slot)}\r\n                                            className={`cursor-pointer border rounded-lg p-2 text-center transition-all ${timeSlot === slot\r\n                                                ? 'bg-primary text-primary-foreground border-primary ring-2 ring-primary/20'\r\n                                                : 'bg-background hover:bg-muted'\r\n                                                }`}\r\n                                        >\r\n                                            <span className=\"text-sm font-medium\">{slot}</span>\r\n                                            <span className=\"block text-[10px] opacity-80\">\r\n                                                {slot === 'Morning' ? '9am - 12pm' : slot === 'Afternoon' ? '12pm - 4pm' : '4pm - 8pm'}\r\n                                            </span>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"space-y-2 md:col-span-2\">\r\n                                <Label htmlFor=\"address\" className=\"flex items-center gap-2\">\r\n                                    <MapPin className=\"h-4 w-4\" /> Exact Pickup Address\r\n                                </Label>\r\n                                <Textarea\r\n                                    id=\"address\"\r\n                                    value={address}\r\n                                    onChange={(e) => setAddress(e.target.value)}\r\n                                    placeholder=\"House No, Street, Landmark...\"\r\n                                    required\r\n                                    rows={3}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Submit */}\r\n                        <Button type=\"submit\" className=\"w-full text-lg h-12\" disabled={submitting}>\r\n                            {submitting ? (\r\n                                <><Loader2 className=\"h-5 w-5 animate-spin mr-2\" /> Processing Request...</>\r\n                            ) : (\r\n                                \"Confirm Booking Request\"\r\n                            )}\r\n                        </Button>\r\n                    </form>\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\chat\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'editContent' is assigned a value but never used.","line":72,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":72,"endColumn":23}],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":366,"column":65,"nodeType":"JSXOpeningElement","endLine":370,"endColumn":67,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect, useRef, useCallback, use } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport Link from \"next/link\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport {\r\n    Send, ArrowLeft, MoreVertical, CheckCheck, Check,\r\n    Flag, Loader2, Trash2, Edit2, X, Zap\r\n} from \"lucide-react\"\r\nimport {\r\n    DropdownMenu, DropdownMenuContent, DropdownMenuItem,\r\n    DropdownMenuTrigger\r\n} from \"@/components/ui/dropdown-menu\"\r\nimport { motion, AnimatePresence } from \"framer-motion\"\r\nimport { toast } from \"sonner\"\r\n\r\ninterface Message {\r\n    id: string\r\n    senderId: string\r\n    content: string\r\n    messageType: string\r\n    imageUrl: string | null\r\n    createdAt: string\r\n    isRead: boolean\r\n    readAt: string | null\r\n    isReported: boolean\r\n    isDeleted: boolean\r\n    deletedAt: string | null\r\n    editedAt: string | null\r\n}\r\n\r\ninterface OtherUser {\r\n    id: string\r\n    name: string\r\n    image: string | null\r\n    kabadiwalaProfile?: {\r\n        businessName: string\r\n        isVerified: boolean\r\n    }\r\n}\r\n\r\nconst quickReplies = [\r\n    \"Yes, I'm interested\",\r\n    \"What are your rates?\",\r\n    \"When can you come?\",\r\n    \"Can you come today?\",\r\n    \"Thank you!\"\r\n]\r\n\r\nexport default function ChatPage({ params }: { params: Promise<{ id: string }> }) {\r\n    const router = useRouter()\r\n    const resolvedParams = use(params)\r\n    const otherUserId = resolvedParams.id\r\n    const messagesEndRef = useRef<HTMLDivElement>(null)\r\n    const inputRef = useRef<HTMLInputElement>(null)\r\n    const [userId, setUserId] = useState<string | null>(null)\r\n\r\n    const [messages, setMessages] = useState<Message[]>([])\r\n    const [otherUser, setOtherUser] = useState<OtherUser | null>(null)\r\n    const [newMessage, setNewMessage] = useState(\"\")\r\n    const [sending, setSending] = useState(false)\r\n    const [isTyping] = useState(false)\r\n    const [showQuickReplies, setShowQuickReplies] = useState(false)\r\n    const [loading, setLoading] = useState(true)\r\n\r\n    // Edit state\r\n    const [editingMessageId, setEditingMessageId] = useState<string | null>(null)\r\n    const [editContent, setEditContent] = useState(\"\")\r\n\r\n    // Fetch messages\r\n    const fetchMessages = useCallback(async () => {\r\n        try {\r\n            const res = await fetch(`/api/chat/${otherUserId}`)\r\n            if (res.ok) {\r\n                const data = await res.json()\r\n                setMessages(data.messages || [])\r\n                setOtherUser(data.otherUser)\r\n                setUserId(data.userId)\r\n            } else if (res.status === 401) {\r\n                router.push(\"/login\")\r\n            }\r\n        } catch {\r\n            console.error(\"Failed to fetch messages\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }, [otherUserId, router])\r\n\r\n    useEffect(() => {\r\n        fetchMessages()\r\n        // Poll for new messages every 2 seconds\r\n        const interval = setInterval(fetchMessages, 2000)\r\n        return () => clearInterval(interval)\r\n    }, [fetchMessages])\r\n\r\n    // Auto scroll to bottom\r\n    useEffect(() => {\r\n        if (!editingMessageId) {\r\n            messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" })\r\n        }\r\n    }, [messages, editingMessageId])\r\n\r\n    // Mark messages as read\r\n    useEffect(() => {\r\n        async function markRead() {\r\n            const unreadMessages = messages.filter(m => m.senderId !== userId && !m.isRead)\r\n            if (unreadMessages.length > 0) {\r\n                await fetch(`/api/chat/${otherUserId}/read`, { method: \"POST\" })\r\n            }\r\n        }\r\n        if (userId) markRead()\r\n    }, [messages, userId, otherUserId])\r\n\r\n    async function handleSend(content?: string) {\r\n        const msg = content || newMessage\r\n        if (!msg.trim()) return\r\n\r\n        // Handle Edit submission\r\n        if (editingMessageId) {\r\n            await handleEditSubmit()\r\n            return\r\n        }\r\n\r\n        setSending(true)\r\n        const messageToSend = msg\r\n        setNewMessage(\"\")\r\n        setShowQuickReplies(false)\r\n\r\n        // Optimistic update\r\n        const optimisticMessage: Message = {\r\n            id: `temp-${Date.now()}`,\r\n            senderId: userId || \"\",\r\n            content: messageToSend,\r\n            messageType: \"TEXT\",\r\n            imageUrl: null,\r\n            createdAt: new Date().toISOString(),\r\n            isRead: false,\r\n            readAt: null,\r\n            isReported: false,\r\n            isDeleted: false,\r\n            deletedAt: null,\r\n            editedAt: null\r\n        }\r\n        setMessages(prev => [...prev, optimisticMessage])\r\n\r\n        try {\r\n            const res = await fetch(`/api/chat/${otherUserId}`, {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ content: messageToSend })\r\n            })\r\n\r\n            if (res.ok) {\r\n                await fetchMessages()\r\n            } else {\r\n                setMessages(prev => prev.filter(m => m.id !== optimisticMessage.id))\r\n                toast.error(\"Failed to send message\")\r\n            }\r\n        } catch {\r\n            setMessages(prev => prev.filter(m => m.id !== optimisticMessage.id))\r\n            toast.error(\"Failed to send message\")\r\n        } finally {\r\n            setSending(false)\r\n            inputRef.current?.focus()\r\n        }\r\n    }\r\n\r\n    async function handleReport(messageId: string) {\r\n        try {\r\n            await fetch(`/api/chat/report`, {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ messageId, reason: \"inappropriate\" })\r\n            })\r\n            await fetchMessages()\r\n            toast.success(\"Reported message\")\r\n        } catch {\r\n            toast.error(\"Failed to report\")\r\n        }\r\n    }\r\n\r\n    async function handleDelete(messageId: string) {\r\n        try {\r\n            const res = await fetch(`/api/chat/message/${messageId}`, {\r\n                method: \"DELETE\"\r\n            })\r\n            if (res.ok) {\r\n                await fetchMessages()\r\n                toast.success(\"Message deleted\")\r\n            } else {\r\n                toast.error(\"Failed to delete\")\r\n            }\r\n        } catch {\r\n            toast.error(\"Failed to delete\")\r\n        }\r\n    }\r\n\r\n    function startEdit(message: Message) {\r\n        setEditingMessageId(message.id)\r\n        setEditContent(message.content)\r\n        setNewMessage(message.content)\r\n        inputRef.current?.focus()\r\n    }\r\n\r\n    function cancelEdit() {\r\n        setEditingMessageId(null)\r\n        setEditContent(\"\")\r\n        setNewMessage(\"\")\r\n    }\r\n\r\n    async function handleEditSubmit() {\r\n        if (!editingMessageId || !newMessage.trim()) return\r\n\r\n        setSending(true)\r\n        try {\r\n            const res = await fetch(`/api/chat/message/${editingMessageId}`, {\r\n                method: \"PATCH\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ content: newMessage })\r\n            })\r\n\r\n            if (res.ok) {\r\n                setEditingMessageId(null)\r\n                setEditContent(\"\")\r\n                setNewMessage(\"\")\r\n                await fetchMessages()\r\n                toast.success(\"Message edited\")\r\n            } else {\r\n                toast.error(\"Failed to edit\")\r\n            }\r\n        } catch {\r\n            toast.error(\"Failed to edit\")\r\n        } finally {\r\n            setSending(false)\r\n        }\r\n    }\r\n\r\n    function formatTime(dateStr: string) {\r\n        const date = new Date(dateStr)\r\n        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\r\n    }\r\n\r\n    function formatDate(dateStr: string) {\r\n        const date = new Date(dateStr)\r\n        const today = new Date()\r\n        const yesterday = new Date(today)\r\n        yesterday.setDate(yesterday.getDate() - 1)\r\n\r\n        if (date.toDateString() === today.toDateString()) return \"Today\"\r\n        if (date.toDateString() === yesterday.toDateString()) return \"Yesterday\"\r\n        return date.toLocaleDateString()\r\n    }\r\n\r\n    function groupMessagesByDate(msgs: Message[]) {\r\n        const groups: { date: string; messages: Message[] }[] = []\r\n        msgs.forEach(msg => {\r\n            const date = formatDate(msg.createdAt)\r\n            const existing = groups.find(g => g.date === date)\r\n            if (existing) {\r\n                existing.messages.push(msg)\r\n            } else {\r\n                groups.push({ date, messages: [msg] })\r\n            }\r\n        })\r\n        return groups\r\n    }\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-[60vh]\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    const messageGroups = groupMessagesByDate(messages)\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-[calc(100vh-57px)]\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-4 p-4 border-b bg-background\">\r\n                <Link href=\"/chat\">\r\n                    <Button variant=\"ghost\" size=\"icon\">\r\n                        <ArrowLeft className=\"h-5 w-5\" />\r\n                    </Button>\r\n                </Link>\r\n                <Avatar>\r\n                    <AvatarFallback>\r\n                        {otherUser?.kabadiwalaProfile?.businessName?.[0] || otherUser?.name?.[0] || 'U'}\r\n                    </AvatarFallback>\r\n                </Avatar>\r\n                <div className=\"flex-1\">\r\n                    <p className=\"font-semibold flex items-center gap-2\">\r\n                        {otherUser?.kabadiwalaProfile?.businessName || otherUser?.name}\r\n                        {otherUser?.kabadiwalaProfile?.isVerified && (\r\n                            <Badge className=\"text-xs bg-blue-500\">Verified</Badge>\r\n                        )}\r\n                    </p>\r\n                    {isTyping && (\r\n                        <p className=\"text-xs text-muted-foreground animate-pulse\">typing...</p>\r\n                    )}\r\n                </div>\r\n                <DropdownMenu>\r\n                    <DropdownMenuTrigger asChild>\r\n                        <Button variant=\"ghost\" size=\"icon\">\r\n                            <MoreVertical className=\"h-5 w-5\" />\r\n                        </Button>\r\n                    </DropdownMenuTrigger>\r\n                    <DropdownMenuContent align=\"end\">\r\n                        <DropdownMenuItem asChild>\r\n                            <Link href={`/book/${otherUserId}`}>Book Pickup</Link>\r\n                        </DropdownMenuItem>\r\n                    </DropdownMenuContent>\r\n                </DropdownMenu>\r\n            </div>\r\n\r\n            {/* Messages */}\r\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-4 bg-muted/20\">\r\n                {messageGroups.length === 0 ? (\r\n                    <div className=\"text-center text-muted-foreground py-20\">\r\n                        <p>No messages yet</p>\r\n                        <p className=\"text-sm\">Start the conversation!</p>\r\n                    </div>\r\n                ) : (\r\n                    messageGroups.map((group) => (\r\n                        <div key={group.date}>\r\n                            <div className=\"flex justify-center my-4\">\r\n                                <span className=\"text-xs bg-muted px-3 py-1 rounded-full text-muted-foreground\">\r\n                                    {group.date}\r\n                                </span>\r\n                            </div>\r\n\r\n                            <AnimatePresence>\r\n                                {group.messages.map((msg) => {\r\n                                    const isMe = msg.senderId === userId\r\n                                    const isTemp = msg.id.startsWith(\"temp-\")\r\n                                    return (\r\n                                        <motion.div\r\n                                            key={msg.id}\r\n                                            initial={{ opacity: 0, y: 10 }}\r\n                                            animate={{ opacity: isTemp ? 0.7 : 1, y: 0 }}\r\n                                            className={`flex ${isMe ? 'justify-end' : 'justify-start'} mb-2 group`}\r\n                                        >\r\n                                            <div className={`max-w-[75%] relative ${isMe ? 'order-1' : 'order-2'}`}>\r\n                                                <div\r\n                                                    className={`p-3 rounded-2xl ${msg.isDeleted\r\n                                                        ? 'bg-muted border border-muted-foreground/20 italic text-muted-foreground'\r\n                                                        : isMe\r\n                                                            ? 'bg-primary text-primary-foreground rounded-br-md'\r\n                                                            : 'bg-background border rounded-bl-md'\r\n                                                        } ${msg.isReported ? 'opacity-50' : ''}`}\r\n                                                >\r\n                                                    {msg.isDeleted ? (\r\n                                                        <p className=\"text-sm flex items-center gap-2\">\r\n                                                            <X className=\"h-3 w-3\" />\r\n                                                            This message was deleted\r\n                                                        </p>\r\n                                                    ) : (\r\n                                                        <>\r\n                                                            {msg.imageUrl && (\r\n                                                                /* eslint-disable-next-line @next/next/no-img-element */\r\n                                                                <img\r\n                                                                    src={msg.imageUrl}\r\n                                                                    alt=\"Shared\"\r\n                                                                    className=\"rounded-lg mb-2 max-w-full\"\r\n                                                                />\r\n                                                            )}\r\n                                                            <p className=\"break-words\">\r\n                                                                {msg.content}\r\n                                                                {msg.editedAt && <span className=\"text-[10px] opacity-70 ml-2\">(edited)</span>}\r\n                                                            </p>\r\n                                                        </>\r\n                                                    )}\r\n\r\n                                                    <div className={`flex items-center gap-1 justify-end mt-1 ${msg.isDeleted\r\n                                                        ? 'hidden'\r\n                                                        : isMe ? 'text-primary-foreground/70' : 'text-muted-foreground'\r\n                                                        }`}>\r\n                                                        <span className=\"text-[10px]\">{formatTime(msg.createdAt)}</span>\r\n                                                        {isMe && (\r\n                                                            isTemp\r\n                                                                ? <Loader2 className=\"h-3 w-3 animate-spin\" />\r\n                                                                : msg.isRead\r\n                                                                    ? <CheckCheck className=\"h-3 w-3 text-blue-400\" />\r\n                                                                    : <Check className=\"h-3 w-3\" />\r\n                                                        )}\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                {/* Actions */}\r\n                                                {!msg.isDeleted && !isTemp && (\r\n                                                    <div className={`absolute top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity ${isMe ? '-left-8' : '-right-8'\r\n                                                        }`}>\r\n                                                        {isMe ? (\r\n                                                            <DropdownMenu>\r\n                                                                <DropdownMenuTrigger asChild>\r\n                                                                    <button className=\"p-1 hover:bg-muted rounded-full\">\r\n                                                                        <MoreVertical className=\"h-4 w-4 text-muted-foreground\" />\r\n                                                                    </button>\r\n                                                                </DropdownMenuTrigger>\r\n                                                                <DropdownMenuContent align={isMe ? \"end\" : \"start\"}>\r\n                                                                    <DropdownMenuItem onClick={() => startEdit(msg)}>\r\n                                                                        <Edit2 className=\"h-4 w-4 mr-2\" /> Edit\r\n                                                                    </DropdownMenuItem>\r\n                                                                    <DropdownMenuItem onClick={() => handleDelete(msg.id)} className=\"text-destructive\">\r\n                                                                        <Trash2 className=\"h-4 w-4 mr-2\" /> Delete\r\n                                                                    </DropdownMenuItem>\r\n                                                                </DropdownMenuContent>\r\n                                                            </DropdownMenu>\r\n                                                        ) : (\r\n                                                            !msg.isReported && (\r\n                                                                <button\r\n                                                                    onClick={() => handleReport(msg.id)}\r\n                                                                >\r\n                                                                    <Flag className=\"h-4 w-4 text-muted-foreground hover:text-destructive\" />\r\n                                                                </button>\r\n                                                            )\r\n                                                        )}\r\n                                                    </div>\r\n                                                )}\r\n\r\n                                                {msg.isReported && !msg.isDeleted && (\r\n                                                    <span className=\"text-[10px] text-destructive ml-2\">Reported</span>\r\n                                                )}\r\n                                            </div>\r\n                                        </motion.div>\r\n                                    )\r\n                                })}\r\n                            </AnimatePresence>\r\n                        </div>\r\n                    ))\r\n                )}\r\n                <div ref={messagesEndRef} />\r\n            </div>\r\n\r\n            {/* Quick Replies */}\r\n            {showQuickReplies && !editingMessageId && (\r\n                <div className=\"px-4 py-2 border-t bg-background overflow-x-auto flex gap-2 animate-in slide-in-from-bottom-2\">\r\n                    {quickReplies.map((reply) => (\r\n                        <Button\r\n                            key={reply}\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            className=\"whitespace-nowrap\"\r\n                            onClick={() => handleSend(reply)}\r\n                        >\r\n                            {reply}\r\n                        </Button>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Input */}\r\n            <div className=\"p-4 border-t bg-background\">\r\n                {editingMessageId && (\r\n                    <div className=\"flex items-center justify-between bg-muted/50 p-2 rounded-t-md text-sm\">\r\n                        <span className=\"font-semibold flex items-center gap-2\">\r\n                            <Edit2 className=\"h-3 w-3\" /> Editing message\r\n                        </span>\r\n                        <button onClick={cancelEdit} className=\"text-muted-foreground hover:text-foreground\">\r\n                            <X className=\"h-4 w-4\" />\r\n                        </button>\r\n                    </div>\r\n                )}\r\n                <form\r\n                    onSubmit={(e) => { e.preventDefault(); handleSend(); }}\r\n                    className=\"flex items-center gap-2\"\r\n                >\r\n                    <Button\r\n                        type=\"button\"\r\n                        variant=\"ghost\"\r\n                        size=\"icon\"\r\n                        onClick={() => setShowQuickReplies(!showQuickReplies)}\r\n                        className={showQuickReplies ? \"text-yellow-500 bg-yellow-50\" : \"text-muted-foreground\"}\r\n                    >\r\n                        <Zap className=\"h-5 w-5 fill-current\" />\r\n                    </Button>\r\n                    <Input\r\n                        ref={inputRef}\r\n                        value={newMessage}\r\n                        onChange={(e) => setNewMessage(e.target.value)}\r\n                        placeholder=\"Type a message...\"\r\n                        className={`flex-1 ${editingMessageId ? 'rounded-t-none' : ''}`}\r\n                        disabled={sending}\r\n                        autoComplete=\"off\"\r\n                    />\r\n                    <Button type=\"submit\" size=\"icon\" disabled={sending || !newMessage.trim()}>\r\n                        {sending ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <Send className=\"h-4 w-4\" />}\r\n                    </Button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\chat\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\dashboard\\DashboardClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardDescription' is defined but never used.","line":5,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Leaf' is defined but never used.","line":10,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":61}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport Link from \"next/link\"\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\"\r\nimport {\r\n    MessageCircle, Package, Star, TrendingUp,\r\n    ArrowRight, Heart, Clock, Loader2, RefreshCw, Plus, Leaf\r\n} from \"lucide-react\"\r\nimport { OrderCard } from \"@/components/orders\"\r\nimport { StoriesBar } from \"@/components/stories\"\r\nimport { ScrapRatesTicker } from \"@/components/dashboard/ScrapRatesTicker\"\r\nimport { EcoTipsWidget } from \"@/components/dashboard/EcoTipsWidget\"\r\nimport { ReferralWidget } from \"@/components/dashboard/ReferralWidget\"\r\nimport dynamic from \"next/dynamic\"\r\n\r\nconst EarningsChart = dynamic(() => import(\"@/components/dashboard/EarningsChart\").then(mod => mod.EarningsChart), {\r\n    loading: () => <div className=\"h-[250px] w-full bg-muted/20 animate-pulse rounded-xl\" />,\r\n    ssr: false\r\n})\r\n\r\ninterface User {\r\n    id: string\r\n    name: string | null\r\n    role: string\r\n    favorites: { kabadiwalaId: string }[]\r\n}\r\n\r\ninterface Order {\r\n    id: string\r\n    status: string\r\n    address: string\r\n    pickupDate: string | null\r\n    totalAmount: number | null\r\n    items: string | null\r\n    createdAt: string\r\n    buyer: {\r\n        id: string\r\n        name: string | null\r\n        phone: string\r\n        kabadiwalaProfile?: {\r\n            businessName: string\r\n            rating: number\r\n            isVerified: boolean\r\n        } | null\r\n    }\r\n    review?: {\r\n        rating: number\r\n        comment: string | null\r\n    } | null\r\n}\r\n\r\ninterface FavoriteKabadiwala {\r\n    id: string\r\n    name: string | null\r\n    kabadiwalaProfile?: {\r\n        businessName: string | null\r\n        rating: number\r\n    } | null\r\n}\r\n\r\n\r\n\r\nexport function DashboardClient({ initialUser }: { initialUser: User }) {\r\n    const [user] = useState(initialUser)\r\n    const [orders, setOrders] = useState<Order[]>([])\r\n    const [favorites, setFavorites] = useState<FavoriteKabadiwala[]>([])\r\n    const [loading, setLoading] = useState(true)\r\n\r\n    const fetchData = async () => {\r\n        try {\r\n            const [ordersRes, favoritesRes] = await Promise.all([\r\n                fetch(\"/api/orders\"),\r\n                fetch(\"/api/favorites\")\r\n            ])\r\n\r\n            if (ordersRes.ok) {\r\n                const ordersData = await ordersRes.json()\r\n                setOrders(Array.isArray(ordersData) ? ordersData : [])\r\n            }\r\n\r\n            if (favoritesRes.ok) {\r\n                const favData = await favoritesRes.json()\r\n                if (Array.isArray(favData)) {\r\n                    setFavorites(\r\n                        favData\r\n                            .map((f: { kabadiwala: FavoriteKabadiwala | null }) => f.kabadiwala)\r\n                            .filter((k: FavoriteKabadiwala | null): k is FavoriteKabadiwala => k !== null && k !== undefined)\r\n                    )\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch data:\", error)\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        fetchData()\r\n    }, [])\r\n\r\n    const totalOrders = orders.length\r\n    const completedOrders = orders.filter(o => o.status === \"COMPLETED\").length\r\n    const pendingOrders = orders.filter(o => o.status === \"REQUESTED\" || o.status === \"ACCEPTED\").length\r\n    const pendingReviews = orders.filter(o => o.status === \"COMPLETED\" && !o.review).length\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gradient-to-br from-green-50/50 to-blue-50/30 dark:from-background dark:to-background pb-12\">\r\n            <div className=\"container mx-auto py-8 px-4\">\r\n                {/* Welcome Header - Glassmorphic */}\r\n                <div className=\"flex flex-col md:flex-row justify-between items-center gap-6 mb-10 bg-white/70 dark:bg-card/50 backdrop-blur-lg p-6 rounded-3xl border shadow-sm\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <Avatar className=\"h-16 w-16 border-2 border-primary/20 shadow-md\">\r\n                            <AvatarFallback className=\"bg-primary/10 text-primary text-xl font-bold\">\r\n                                {user.name?.[0] || \"U\"}\r\n                            </AvatarFallback>\r\n                        </Avatar>\r\n                        <div>\r\n                            <h1 className=\"text-3xl font-extrabold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent\">Hello, {user.name}!</h1>\r\n                            <p className=\"text-muted-foreground font-medium\">Ready to recycle and earn today?</p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex gap-3\">\r\n                        <Button variant=\"outline\" onClick={fetchData} disabled={loading} className=\"rounded-full shadow-sm hover:bg-primary/5 border-primary/20\">\r\n                            <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\r\n                            Refresh\r\n                        </Button>\r\n                        <Link href=\"/market\">\r\n                            <Button className=\"rounded-full shadow-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 border-0 text-white gap-2 px-6\">\r\n                                Book Pickup <ArrowRight className=\"h-4 w-4\" />\r\n                            </Button>\r\n                        </Link>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Daily Rates Ticker */}\r\n                <div className=\"mb-8\">\r\n                    <ScrapRatesTicker />\r\n                </div>\r\n\r\n                {/* Stories Section - Floating & Modern */}\r\n                <div className=\"mb-10\">\r\n                    <div className=\"flex items-center gap-2 mb-4 px-2\">\r\n                        <div className=\"p-1.5 bg-pink-100 dark:bg-pink-900/30 rounded-lg\">\r\n                            <Star className=\"h-4 w-4 text-pink-600 dark:text-pink-400\" />\r\n                        </div>\r\n                        <h2 className=\"text-lg font-bold\">Stories & Updates</h2>\r\n                    </div>\r\n                    <div className=\"bg-white/60 dark:bg-card/40 backdrop-blur-md rounded-2xl p-4 border shadow-sm overflow-hidden\">\r\n                        <StoriesBar currentUserId={user.id} />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Stats Grid - 3D Cards with Hover Effects */}\r\n                <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-6 mb-10\">\r\n                    <Link href=\"/orders\">\r\n                        <Card className=\"h-full border-none shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 bg-gradient-to-br from-blue-50 to-white dark:from-blue-950/20 dark:to-card overflow-hidden group\">\r\n                            <CardContent className=\"p-6 relative\">\r\n                                <div className=\"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity\">\r\n                                    <Package className=\"h-24 w-24 -rotate-12 text-blue-600\" />\r\n                                </div>\r\n                                <div className=\"p-3 bg-blue-100 dark:bg-blue-900/40 rounded-2xl w-fit mb-4 text-blue-600 dark:text-blue-400\">\r\n                                    <Package className=\"h-6 w-6\" />\r\n                                </div>\r\n                                <p className=\"text-4xl font-black text-blue-700 dark:text-blue-400 mb-1\">{totalOrders}</p>\r\n                                <p className=\"text-sm font-semibold text-muted-foreground uppercase tracking-wide\">Total Orders</p>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </Link>\r\n\r\n                    <Card className=\"h-full border-none shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 bg-gradient-to-br from-orange-50 to-white dark:from-orange-950/20 dark:to-card overflow-hidden group\">\r\n                        <CardContent className=\"p-6 relative\">\r\n                            <div className=\"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity\">\r\n                                <Clock className=\"h-24 w-24 rotate-12 text-orange-600\" />\r\n                            </div>\r\n                            <div className=\"p-3 bg-orange-100 dark:bg-orange-900/40 rounded-2xl w-fit mb-4 text-orange-600 dark:text-orange-400\">\r\n                                <Clock className=\"h-6 w-6\" />\r\n                            </div>\r\n                            <p className=\"text-4xl font-black text-orange-600 dark:text-orange-400 mb-1\">{pendingOrders}</p>\r\n                            <p className=\"text-sm font-semibold text-muted-foreground uppercase tracking-wide\">Pending</p>\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card className=\"h-full border-none shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-card overflow-hidden group\">\r\n                        <CardContent className=\"p-6 relative\">\r\n                            <div className=\"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity\">\r\n                                <TrendingUp className=\"h-24 w-24 -rotate-6 text-green-600\" />\r\n                            </div>\r\n                            <div className=\"p-3 bg-green-100 dark:bg-green-900/40 rounded-2xl w-fit mb-4 text-green-600 dark:text-green-400\">\r\n                                <TrendingUp className=\"h-6 w-6\" />\r\n                            </div>\r\n                            <p className=\"text-4xl font-black text-green-600 dark:text-green-400 mb-1\">{completedOrders}</p>\r\n                            <p className=\"text-sm font-semibold text-muted-foreground uppercase tracking-wide\">Completed</p>\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Link href=\"/favorites\">\r\n                        <Card className=\"h-full border-none shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 bg-gradient-to-br from-pink-50 to-white dark:from-pink-950/20 dark:to-card overflow-hidden group\">\r\n                            <CardContent className=\"p-6 relative\">\r\n                                <div className=\"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity\">\r\n                                    <Heart className=\"h-24 w-24 rotate-6 text-pink-600\" />\r\n                                </div>\r\n                                <div className=\"p-3 bg-pink-100 dark:bg-pink-900/40 rounded-2xl w-fit mb-4 text-pink-600 dark:text-pink-400\">\r\n                                    <Heart className=\"h-6 w-6\" />\r\n                                </div>\r\n                                <p className=\"text-4xl font-black text-pink-600 dark:text-pink-400 mb-1\">{favorites.length}</p>\r\n                                <p className=\"text-sm font-semibold text-muted-foreground uppercase tracking-wide\">Favorites</p>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </Link>\r\n                </div>\r\n\r\n                {/* Main Content Area */}\r\n                <div className=\"grid lg:grid-cols-3 gap-8\">\r\n                    <div className=\"lg:col-span-2 space-y-8\">\r\n\r\n                        {/* Recharts Graph - High Level */}\r\n                        {/* Recharts Graph - High Level */}\r\n                        <EarningsChart />\r\n\r\n                        {/* Recent Orders List */}\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"flex justify-between items-center px-1\">\r\n                                <h2 className=\"text-xl font-bold flex items-center gap-2\">\r\n                                    <Package className=\"h-5 w-5 text-primary\" />\r\n                                    Recent Activity\r\n                                </h2>\r\n                                <Link href=\"/orders\">\r\n                                    <Button variant=\"ghost\" size=\"sm\" className=\"hover:text-primary hover:bg-primary/10 transition-colors\">View All Orders</Button>\r\n                                </Link>\r\n                            </div>\r\n\r\n                            {loading ? (\r\n                                <Card className=\"border-none shadow-md\">\r\n                                    <CardContent className=\"py-12 flex items-center justify-center\">\r\n                                        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n                                    </CardContent>\r\n                                </Card>\r\n                            ) : orders.length === 0 ? (\r\n                                <Card className=\"border-none shadow-md bg-white/50 backdrop-blur\">\r\n                                    <CardContent className=\"py-12 text-center\">\r\n                                        <Package className=\"h-16 w-16 mx-auto text-muted-foreground/30 mb-4\" />\r\n                                        <p className=\"text-lg font-medium text-muted-foreground mb-4\">No recent orders found</p>\r\n                                        <Link href=\"/market\">\r\n                                            <Button className=\"rounded-full shadow-lg bg-primary text-white\">Book Your First Pickup</Button>\r\n                                        </Link>\r\n                                    </CardContent>\r\n                                </Card>\r\n                            ) : (\r\n                                <div className=\"space-y-4\">\r\n                                    {orders.slice(0, 5).map((order) => (\r\n                                        <OrderCard\r\n                                            key={order.id}\r\n                                            order={order}\r\n                                            userRole=\"SELLER\"\r\n                                            onStatusUpdate={fetchData}\r\n                                        />\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Sidebar */}\r\n                    <div className=\"space-y-6\">\r\n                        {/* Quick Actions Panel */}\r\n                        <Card className=\"border-none shadow-lg overflow-hidden bg-gradient-to-b from-white to-gray-50 dark:from-card dark:to-background\">\r\n                            <CardHeader className=\"border-b border-dashed\">\r\n                                <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                                     Quick Actions\r\n                                </CardTitle>\r\n                            </CardHeader>\r\n                            <CardContent className=\"p-4 space-y-3\">\r\n                                <Link href=\"/market\" className=\"block\">\r\n                                    <Button variant=\"outline\" className=\"w-full justify-start h-12 text-base font-normal hover:border-green-500 hover:text-green-600 transition-colors bg-white dark:bg-card shadow-sm\">\r\n                                        <Package className=\"h-5 w-5 mr-3 text-green-500\" /> Book Pickup\r\n                                    </Button>\r\n                                </Link>\r\n                                <Link href=\"/orders\" className=\"block\">\r\n                                    <Button variant=\"outline\" className=\"w-full justify-start h-12 text-base font-normal hover:border-blue-500 hover:text-blue-600 transition-colors bg-white dark:bg-card shadow-sm\">\r\n                                        <Clock className=\"h-5 w-5 mr-3 text-blue-500\" /> View Orders\r\n                                    </Button>\r\n                                </Link>\r\n                                <Link href=\"/chat\" className=\"block\">\r\n                                    <Button variant=\"outline\" className=\"w-full justify-start h-12 text-base font-normal hover:border-purple-500 hover:text-purple-600 transition-colors bg-white dark:bg-card shadow-sm\">\r\n                                        <MessageCircle className=\"h-5 w-5 mr-3 text-purple-500\" /> My Chats\r\n                                    </Button>\r\n                                </Link>\r\n                                <Link href=\"/favorites\" className=\"block\">\r\n                                    <Button variant=\"outline\" className=\"w-full justify-start h-12 text-base font-normal hover:border-pink-500 hover:text-pink-600 transition-colors bg-white dark:bg-card shadow-sm\">\r\n                                        <Heart className=\"h-5 w-5 mr-3 text-pink-500\" /> My Favorites\r\n                                    </Button>\r\n                                </Link>\r\n                            </CardContent>\r\n                        </Card>\r\n\r\n                        {/* Favorites Widget */}\r\n                        <Card className=\"border-none shadow-lg\">\r\n                            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                                <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                                    <Heart className=\"h-5 w-5 text-pink-500 fill-pink-500\" /> Favorites\r\n                                </CardTitle>\r\n                                <Link href=\"/favorites\">\r\n                                    <Button variant=\"link\" size=\"sm\" className=\"text-pink-500\">View All</Button>\r\n                                </Link>\r\n                            </CardHeader>\r\n                            <CardContent className=\"p-4 pt-0\">\r\n                                {favorites.length === 0 ? (\r\n                                    <div className=\"text-center py-6 border-2 border-dashed rounded-xl mt-2\">\r\n                                        <p className=\"text-sm text-muted-foreground mb-3\">Save favorite Kabadiwalas <br /> for quick access</p>\r\n                                        <Link href=\"/market\">\r\n                                            <Button size=\"sm\" variant=\"secondary\" className=\"rounded-full\">\r\n                                                <Plus className=\"h-4 w-4 mr-1\" /> Add Now\r\n                                            </Button>\r\n                                        </Link>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"space-y-3 mt-2\">\r\n                                        {favorites.slice(0, 3).map((k) => (\r\n                                            <div key={k.id} className=\"flex items-center gap-3 p-3 bg-muted/30 rounded-xl hover:bg-muted/60 transition-colors cursor-pointer group\">\r\n                                                <Avatar className=\"h-10 w-10 border shadow-sm group-hover:scale-105 transition-transform\">\r\n                                                    <AvatarFallback className=\"bg-gradient-to-br from-green-400 to-green-600 text-white font-bold\">\r\n                                                        {k.kabadiwalaProfile?.businessName?.[0] || 'K'}\r\n                                                    </AvatarFallback>\r\n                                                </Avatar>\r\n                                                <div className=\"flex-1 min-w-0\">\r\n                                                    <p className=\"font-semibold truncate\">{k.kabadiwalaProfile?.businessName || k.name}</p>\r\n                                                    <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\r\n                                                        <Star className=\"h-3 w-3 fill-yellow-400 text-yellow-400\" />\r\n                                                        <span className=\"font-medium text-foreground\">{k.kabadiwalaProfile?.rating?.toFixed(1) || \"4.5\"}</span>\r\n                                                    </div>\r\n                                                </div>\r\n                                                <Link href={`/book/${k.id}`}>\r\n                                                    <Button size=\"sm\" className=\"rounded-full h-8 px-4 bg-white hover:bg-gray-100 text-black border shadow-sm\">\r\n                                                        Book\r\n                                                    </Button>\r\n                                                </Link>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n                            </CardContent>\r\n                        </Card>\r\n\r\n                        {/* Pending Reviews Alert */}\r\n                        {pendingReviews > 0 && (\r\n                            <div className=\"p-4 rounded-2xl bg-gradient-to-r from-yellow-500 to-orange-500 text-white shadow-lg flex items-center gap-4\">\r\n                                <div className=\"p-2 bg-white/20 rounded-full animate-pulse\">\r\n                                    <Star className=\"h-6 w-6 text-white fill-white\" />\r\n                                </div>\r\n                                <div>\r\n                                    <p className=\"font-bold text-lg\">{pendingReviews} Pickup{pendingReviews > 1 ? 's' : ''} to Rate!</p>\r\n                                    <p className=\"text-yellow-100 text-sm\">Review your experience</p>\r\n                                </div>\r\n                                <ArrowRight className=\"h-5 w-5 ml-auto text-white/80\" />\r\n                            </div>\r\n                        )}\r\n                        {/* Eco Tips Widget */}\r\n                        <EcoTipsWidget />\r\n\r\n                        {/* Referral Widget */}\r\n                        <ReferralWidget />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\dashboard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\favorites\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":4,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":4,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":50}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Heart, Loader2, Package } from \"lucide-react\"\r\nimport { FavoriteCard } from \"@/components/favorites\"\r\nimport Link from \"next/link\"\r\n\r\ninterface FavoriteKabadiwala {\r\n    favoriteId: string\r\n    createdAt: string\r\n    kabadiwala: {\r\n        id: string\r\n        name: string | null\r\n        phone: string\r\n        image: string | null\r\n        kabadiwalaProfile?: {\r\n            businessName: string\r\n            serviceArea: string | null\r\n            rating: number\r\n            totalReviews: number\r\n            totalPickups: number\r\n            isVerified: boolean\r\n            rates: string | null\r\n        } | null\r\n    }\r\n}\r\n\r\nexport default function FavoritesPage() {\r\n    const [favorites, setFavorites] = useState<FavoriteKabadiwala[]>([])\r\n    const [loading, setLoading] = useState(true)\r\n\r\n    const fetchFavorites = async () => {\r\n        try {\r\n            const res = await fetch(\"/api/favorites\")\r\n            if (res.ok) {\r\n                const data = await res.json()\r\n                setFavorites(data)\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch favorites:\", error)\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        fetchFavorites()\r\n    }, [])\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"container mx-auto py-12 flex items-center justify-center\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"container mx-auto py-8 px-4\">\r\n            <div className=\"flex items-center justify-between mb-8\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold flex items-center gap-3\">\r\n                        <Heart className=\"h-8 w-8 text-pink-500 fill-pink-500\" />\r\n                        My Favorites\r\n                    </h1>\r\n                    <p className=\"text-muted-foreground\">Your saved Kabadiwalas for quick booking</p>\r\n                </div>\r\n                <Link href=\"/market\">\r\n                    <Button>Find More</Button>\r\n                </Link>\r\n            </div>\r\n\r\n            {favorites.length === 0 ? (\r\n                <Card>\r\n                    <CardContent className=\"py-12 text-center\">\r\n                        <Heart className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\r\n                        <p className=\"text-muted-foreground mb-4\">No favorites yet</p>\r\n                        <p className=\"text-sm text-muted-foreground mb-6\">\r\n                            Browse the marketplace and add Kabadiwalas to your favorites for quick access\r\n                        </p>\r\n                        <Link href=\"/market\">\r\n                            <Button>\r\n                                <Package className=\"h-4 w-4 mr-2\" />\r\n                                Browse Marketplace\r\n                            </Button>\r\n                        </Link>\r\n                    </CardContent>\r\n                </Card>\r\n            ) : (\r\n                <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                    {favorites.map((fav) => (\r\n                        <FavoriteCard\r\n                            key={fav.favoriteId}\r\n                            favorite={fav}\r\n                            onRemove={fetchFavorites}\r\n                        />\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\food-rescue\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Utensils' is defined but never used.","line":10,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'truck' is defined but never used.","line":10,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":32},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":38,"column":28,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[1750,1793],"text":"\r\n                        Don&apos;t Waste Food,"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[1750,1793],"text":"\r\n                        Don&lsquo;t Waste Food,"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[1750,1793],"text":"\r\n                        Don&#39;t Waste Food,"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[1750,1793],"text":"\r\n                        Don&rsquo;t Waste Food,"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":56,"column":68,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2742,2786],"text":"Fill this form, and we&apos;ll arrange a vehicle."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2742,2786],"text":"Fill this form, and we&lsquo;ll arrange a vehicle."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2742,2786],"text":"Fill this form, and we&#39;ll arrange a vehicle."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2742,2786],"text":"Fill this form, and we&rsquo;ll arrange a vehicle."},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { toast } from \"sonner\"\r\nimport { Heart, Utensils, truck, Phone } from \"lucide-react\"\r\n\r\nexport default function FoodRescuePage() {\r\n    const [loading, setLoading] = useState(false)\r\n\r\n    const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\r\n        e.preventDefault()\r\n        setLoading(true)\r\n\r\n        // Simulate API call\r\n        await new Promise(resolve => setTimeout(resolve, 1500))\r\n\r\n        toast.success(\"Thank you! Our team will contact you shortly.\")\r\n        setLoading(false)\r\n            ; (e.target as HTMLFormElement).reset()\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-orange-50 dark:bg-orange-950/20\">\r\n            {/* Hero Section */}\r\n            <section className=\"relative py-20 px-4 text-center overflow-hidden bg-gradient-to-b from-orange-100 to-transparent dark:from-orange-900/30\">\r\n                <div className=\"container mx-auto max-w-4xl relative z-10\">\r\n                    <div className=\"inline-flex items-center gap-2 bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-100 px-4 py-1.5 rounded-full mb-6 font-medium text-sm\">\r\n                        <Heart className=\"h-4 w-4 fill-current\" />\r\n                        <span>Annadaan: Share Food, Share Love</span>\r\n                    </div>\r\n\r\n                    <h1 className=\"text-4xl md:text-6xl font-black mb-6 text-orange-900 dark:text-orange-100\">\r\n                        Don't Waste Food,<br />\r\n                        <span className=\"text-orange-600\">Feed the Needy</span>\r\n                    </h1>\r\n\r\n                    <p className=\"text-xl text-muted-foreground mb-10 max-w-2xl mx-auto\">\r\n                        Leftover food from your wedding, party, or event can save lives.\r\n                        Request a pickup, and we will distribute it to the poor.\r\n                    </p>\r\n                </div>\r\n            </section>\r\n\r\n            <div className=\"container mx-auto px-4 pb-20 max-w-5xl\">\r\n                <div className=\"grid md:grid-cols-2 gap-12 items-start\">\r\n\r\n                    {/* Request Form */}\r\n                    <Card className=\"border-orange-200 shadow-xl dark:border-orange-800\">\r\n                        <CardHeader>\r\n                            <CardTitle className=\"text-2xl text-orange-700 dark:text-orange-400\">Request Food Pickup</CardTitle>\r\n                            <CardDescription>Fill this form, and we'll arrange a vehicle.</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                                <div className=\"space-y-2\">\r\n                                    <Label htmlFor=\"name\">Your Name / Event Name</Label>\r\n                                    <Input id=\"name\" required placeholder=\"Ex: Sharma Wedding\" />\r\n                                </div>\r\n\r\n                                <div className=\"grid grid-cols-2 gap-4\">\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label htmlFor=\"phone\">Phone Number</Label>\r\n                                        <Input id=\"phone\" required type=\"tel\" placeholder=\"9876543210\" />\r\n                                    </div>\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label htmlFor=\"quantity\">Quantity (Approx people)</Label>\r\n                                        <Input id=\"quantity\" required placeholder=\"Ex: For 50 people\" />\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <Label htmlFor=\"address\">Pickup Address</Label>\r\n                                    <Textarea id=\"address\" required placeholder=\"Complete address with landmark\" />\r\n                                </div>\r\n\r\n                                <Button type=\"submit\" className=\"w-full bg-orange-600 hover:bg-orange-700 text-white text-lg h-12\" disabled={loading}>\r\n                                    {loading ? \"Sending...\" : \"Request Pickup Now\"}\r\n                                </Button>\r\n                            </form>\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    {/* Info Section */}\r\n                    <div className=\"space-y-8\">\r\n                        <div>\r\n                            <h3 className=\"text-2xl font-bold mb-4\">How it Works?</h3>\r\n                            <div className=\"space-y-6\">\r\n                                <Step\r\n                                    icon={<Phone className=\"h-6 w-6 text-orange-600\" />}\r\n                                    title=\"1. You Request\"\r\n                                    desc=\"Fill the form or call our helpline when you have excess food.\"\r\n                                />\r\n                                <Step\r\n                                    icon={<div className=\"h-6 w-6 text-orange-600\"></div>}\r\n                                    title=\"2. We Pickup\"\r\n                                    desc=\"Our volunteers will reach your location with containers.\"\r\n                                />\r\n                                <Step\r\n                                    icon={<div className=\"h-6 w-6 text-orange-600\"></div>}\r\n                                    title=\"3. We Distribute\"\r\n                                    desc=\"Food is checked for hygiene and distributed to slums/shelters immediately.\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <Card className=\"bg-orange-600 text-white border-none\">\r\n                            <CardContent className=\"p-6\">\r\n                                <h3 className=\"text-xl font-bold mb-2\">Urgent Pickup?</h3>\r\n                                <p className=\"mb-4 text-orange-100\">Call our 24/7 Food Rescue Helpline</p>\r\n                                <a href=\"tel:9876543210\" className=\"inline-flex items-center gap-2 bg-white text-orange-600 px-6 py-3 rounded-lg font-bold hover:bg-orange-50 transition-colors\">\r\n                                    <Phone className=\"h-5 w-5\" />\r\n                                    Call 98765-43210\r\n                                </a>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction Step({ icon, title, desc }: { icon: React.ReactNode, title: string, desc: string }) {\r\n    return (\r\n        <div className=\"flex gap-4\">\r\n            <div className=\"h-12 w-12 shrink-0 rounded-full bg-orange-100 dark:bg-orange-900/50 flex items-center justify-center\">\r\n                {icon}\r\n            </div>\r\n            <div>\r\n                <h4 className=\"font-semibold text-lg\">{title}</h4>\r\n                <p className=\"text-muted-foreground\">{desc}</p>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\kabadiwala\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardDescription' is defined but never used.","line":5,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XCircle' is defined but never used.","line":10,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used.","line":11,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":12,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Shield' is defined but never used.","line":12,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cancelledOrders' is assigned a value but never used.","line":77,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":77,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { cookies } from \"next/headers\"\r\nimport { db } from \"@/lib/db\"\r\nimport { redirect } from \"next/navigation\"\r\nimport Link from \"next/link\"\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\"\r\nimport {\r\n    MessageCircle, Package, Star, CheckCircle, XCircle,\r\n    TrendingUp, Users, Clock, ArrowRight, Calendar, IndianRupee,\r\n    Settings, Shield\r\n} from \"lucide-react\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { RateManager } from \"@/components/dashboard/RateManager\"\r\nimport { DealerEarningsChart } from \"@/components/dashboard/DealerEarningsChart\"\r\nimport { InventoryManager } from \"@/components/dashboard/InventoryManager\"\r\nimport { BusinessStatus } from \"@/components/dashboard/BusinessStatus\"\r\n\r\nasync function getUser() {\r\n    const cookieStore = await cookies()\r\n    const userId = cookieStore.get(\"userId\")?.value\r\n    if (!userId) return null\r\n    return db.user.findUnique({\r\n        where: { id: userId },\r\n        include: { kabadiwalaProfile: true }\r\n    })\r\n}\r\n\r\nasync function updateOrderStatus(formData: FormData) {\r\n    \"use server\"\r\n    const orderId = formData.get(\"orderId\") as string\r\n    const status = formData.get(\"status\") as string\r\n\r\n    await db.order.update({\r\n        where: { id: orderId },\r\n        data: { status }\r\n    })\r\n\r\n    revalidatePath(\"/kabadiwala/dashboard\")\r\n}\r\n\r\nexport default async function KabadiwalaDashboard() {\r\n    const user = await getUser()\r\n    if (!user) redirect(\"/login\")\r\n    if (user.role !== \"KABADIWALA\") redirect(\"/dashboard\")\r\n\r\n    interface ExtendedProfile {\r\n        id: string\r\n        businessName: string\r\n        rating: number\r\n        totalReviews: number\r\n        totalPickups: number\r\n        isVerified: boolean\r\n        isAvailable: boolean\r\n        inventory: string | null\r\n        rates: string | null\r\n        avgResponseTime: number\r\n        serviceArea: string\r\n        coverImage?: string | null\r\n        // Add other properties that match your prisma schema\r\n        userId: string\r\n    }\r\n\r\n    const profile = user.kabadiwalaProfile as unknown as ExtendedProfile\r\n\r\n    // Get all orders\r\n    const orders = await db.order.findMany({\r\n        where: { buyerId: user.id },\r\n        include: { seller: true, review: true },\r\n        orderBy: { createdAt: \"desc\" }\r\n    })\r\n\r\n    const pendingOrders = orders.filter(o => o.status === \"REQUESTED\")\r\n    const acceptedOrders = orders.filter(o => o.status === \"ACCEPTED\")\r\n    const completedOrders = orders.filter(o => o.status === \"COMPLETED\")\r\n    const cancelledOrders = orders.filter(o => o.status === \"CANCELLED\")\r\n\r\n    // Calculate earnings (from completed orders)\r\n    const totalEarnings = completedOrders.reduce((sum, o) => sum + (o.totalAmount || 0), 0)\r\n\r\n    // Get recent reviews\r\n    const recentReviews = await db.review.findMany({\r\n        where: {\r\n            order: { buyerId: user.id }\r\n        },\r\n        include: { reviewer: true, order: true },\r\n        orderBy: { createdAt: \"desc\" },\r\n        take: 5\r\n    })\r\n\r\n    // Get unread messages count\r\n    const chats = await db.chat.findMany({\r\n        where: { buyerId: user.id },\r\n        include: {\r\n            messages: { where: { isRead: false, senderId: { not: user.id } } }\r\n        }\r\n    })\r\n    const unreadCount = chats.reduce((sum, c) => sum + c.messages.length, 0)\r\n\r\n    return (\r\n        <div className=\"container mx-auto py-8 px-4\">\r\n            {/* Header */}\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-start mb-8 gap-4\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold flex items-center gap-3\">\r\n                        {profile?.businessName || user.name}\r\n                        {profile?.isVerified && (\r\n                            <Badge className=\"bg-blue-500/10 text-blue-600 hover:bg-blue-500/20 border-blue-200\">\r\n                                <CheckCircle className=\"h-3 w-3 mr-1\" /> Verified\r\n                            </Badge>\r\n                        )}\r\n                    </h1>\r\n                    <div className=\"flex flex-wrap items-center gap-4 mt-2 text-muted-foreground\">\r\n                        <span className=\"flex items-center px-2 py-1 bg-muted rounded-md text-xs\">\r\n                            <Star className=\"h-3 w-3 text-yellow-500 fill-yellow-500 mr-1\" />\r\n                            {profile?.rating?.toFixed(1) || \"0.0\"} ({profile?.totalReviews || 0} reviews)\r\n                        </span>\r\n                        <span className=\"flex items-center px-2 py-1 bg-muted rounded-md text-xs\">\r\n                            <Package className=\"h-3 w-3 mr-1\" />\r\n                            {profile?.totalPickups || 0} pickups\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex w-full md:w-auto items-center gap-3\">\r\n                    <div className=\"flex-1 md:flex-none\">\r\n                        <BusinessStatus isAvailable={profile?.isAvailable ?? true} />\r\n                    </div>\r\n                    <Link href=\"/kabadiwala/profile\" className=\"flex-1 md:flex-none\">\r\n                        <Button variant=\"outline\" className=\"w-full\">Edit Profile</Button>\r\n                    </Link>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Stats Grid */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-5 gap-3 mb-8\">\r\n                <Card className=\"bg-gradient-to-br from-orange-500/10 to-orange-500/5 hover:scale-105 transition-transform duration-200 border-none shadow-sm\">\r\n                    <CardContent className=\"p-4 pt-6\">\r\n                        <div className=\"flex flex-col items-center text-center gap-2\">\r\n                            <div className=\"p-2 bg-white dark:bg-black/20 rounded-full shadow-sm\">\r\n                                <Package className=\"h-5 w-5 text-orange-500\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-2xl font-bold text-orange-700 dark:text-orange-400\">{pendingOrders.length}</p>\r\n                                <p className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider\">Pending</p>\r\n                            </div>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card className=\"bg-gradient-to-br from-blue-500/10 to-blue-500/5 hover:scale-105 transition-transform duration-200 border-none shadow-sm\">\r\n                    <CardContent className=\"p-4 pt-6\">\r\n                        <div className=\"flex flex-col items-center text-center gap-2\">\r\n                            <div className=\"p-2 bg-white dark:bg-black/20 rounded-full shadow-sm\">\r\n                                <Clock className=\"h-5 w-5 text-blue-500\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-2xl font-bold text-blue-700 dark:text-blue-400\">{acceptedOrders.length}</p>\r\n                                <p className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider\">Scheduled</p>\r\n                            </div>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card className=\"bg-gradient-to-br from-green-500/10 to-green-500/5 hover:scale-105 transition-transform duration-200 border-none shadow-sm\">\r\n                    <CardContent className=\"p-4 pt-6\">\r\n                        <div className=\"flex flex-col items-center text-center gap-2\">\r\n                            <div className=\"p-2 bg-white dark:bg-black/20 rounded-full shadow-sm\">\r\n                                <CheckCircle className=\"h-5 w-5 text-green-500\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-2xl font-bold text-green-700 dark:text-green-400\">{completedOrders.length}</p>\r\n                                <p className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider\">Done</p>\r\n                            </div>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card className=\"bg-gradient-to-br from-purple-500/10 to-purple-500/5 hover:scale-105 transition-transform duration-200 border-none shadow-sm\">\r\n                    <CardContent className=\"p-4 pt-6\">\r\n                        <div className=\"flex flex-col items-center text-center gap-2\">\r\n                            <div className=\"p-2 bg-white dark:bg-black/20 rounded-full shadow-sm\">\r\n                                <IndianRupee className=\"h-5 w-5 text-purple-500\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-lg font-bold text-purple-700 dark:text-purple-400 truncate w-full\">{totalEarnings.toLocaleString()}</p>\r\n                                <p className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider\">Earned</p>\r\n                            </div>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card className=\"bg-gradient-to-br from-pink-500/10 to-pink-500/5 hover:scale-105 transition-transform duration-200 border-none shadow-sm col-span-2 md:col-span-1\">\r\n                    <CardContent className=\"p-4\">\r\n                        <Link href=\"/chat\" className=\"flex md:flex-col items-center justify-center gap-3 h-full\">\r\n                            <div className=\"p-2 bg-white dark:bg-black/20 rounded-full shadow-sm relative\">\r\n                                <MessageCircle className=\"h-5 w-5 text-pink-500\" />\r\n                                {unreadCount > 0 && (\r\n                                    <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-[10px] px-1.5 rounded-full min-w-[16px] h-4 flex items-center justify-center\">\r\n                                        {unreadCount}\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n                            <div className=\"text-left md:text-center\">\r\n                                <p className=\"text-2xl font-bold text-pink-700 dark:text-pink-400\">{chats.length}</p>\r\n                                <p className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider\">Chats</p>\r\n                            </div>\r\n                            <ArrowRight className=\"h-4 w-4 ml-auto md:hidden text-pink-400\" />\r\n                        </Link>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Business Tools Section */}\r\n            <div className=\"grid md:grid-cols-4 gap-6 mb-8\">\r\n                <div className=\"md:col-span-2\">\r\n                    <DealerEarningsChart />\r\n                </div>\r\n                <div>\r\n                    <RateManager\r\n                        kabadiwalaId={profile?.id || \"\"}\r\n                        initialRates={profile?.rates ? JSON.parse(profile.rates) : undefined}\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <InventoryManager\r\n                        kabadiwalaId={profile?.id || \"\"}\r\n                        initialInventory={profile?.inventory ? JSON.parse(profile.inventory) : undefined}\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid lg:grid-cols-3 gap-8\">\r\n                {/* Main Column */}\r\n                <div className=\"lg:col-span-2 space-y-6\">\r\n                    {/* Pending Orders */}\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle className=\"flex items-center gap-2\">\r\n                                <Package className=\"h-5 w-5 text-orange-500\" />\r\n                                New Pickup Requests\r\n                                {pendingOrders.length > 0 && (\r\n                                    <Badge variant=\"secondary\">{pendingOrders.length}</Badge>\r\n                                )}\r\n                            </CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            {pendingOrders.length === 0 ? (\r\n                                <p className=\"text-center text-muted-foreground py-8\">No pending requests</p>\r\n                            ) : (\r\n                                <div className=\"space-y-4\">\r\n                                    {pendingOrders.slice(0, 5).map((order) => (\r\n                                        <div key={order.id} className=\"flex items-start justify-between p-4 border rounded-lg\">\r\n                                            <div className=\"flex gap-4\">\r\n                                                <Avatar>\r\n                                                    <AvatarFallback>{order.seller.name?.[0] || 'U'}</AvatarFallback>\r\n                                                </Avatar>\r\n                                                <div>\r\n                                                    <p className=\"font-semibold\">{order.seller.name}</p>\r\n                                                    <p className=\"text-sm text-muted-foreground\">{order.address}</p>\r\n                                                    <p className=\"text-sm text-muted-foreground flex items-center gap-1 mt-1\">\r\n                                                        <Calendar className=\"h-3 w-3\" />\r\n                                                        {order.pickupDate\r\n                                                            ? new Date(order.pickupDate).toLocaleDateString()\r\n                                                            : \"Date TBD\"}\r\n                                                    </p>\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"flex flex-col gap-2\">\r\n                                                <form action={updateOrderStatus}>\r\n                                                    <input type=\"hidden\" name=\"orderId\" value={order.id} />\r\n                                                    <input type=\"hidden\" name=\"status\" value=\"ACCEPTED\" />\r\n                                                    <Button type=\"submit\" size=\"sm\" className=\"w-full\">Accept</Button>\r\n                                                </form>\r\n                                                <form action={updateOrderStatus}>\r\n                                                    <input type=\"hidden\" name=\"orderId\" value={order.id} />\r\n                                                    <input type=\"hidden\" name=\"status\" value=\"CANCELLED\" />\r\n                                                    <Button type=\"submit\" size=\"sm\" variant=\"destructive\" className=\"w-full\">\r\n                                                        Decline\r\n                                                    </Button>\r\n                                                </form>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    {/* Upcoming Pickups */}\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle className=\"flex items-center gap-2\">\r\n                                <Clock className=\"h-5 w-5 text-blue-500\" />\r\n                                Upcoming Pickups\r\n                            </CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            {acceptedOrders.length === 0 ? (\r\n                                <p className=\"text-center text-muted-foreground py-8\">No upcoming pickups</p>\r\n                            ) : (\r\n                                <div className=\"space-y-3\">\r\n                                    {acceptedOrders.map((order) => (\r\n                                        <div key={order.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\r\n                                            <div className=\"flex items-center gap-4\">\r\n                                                <Avatar>\r\n                                                    <AvatarFallback>{order.seller.name?.[0] || 'U'}</AvatarFallback>\r\n                                                </Avatar>\r\n                                                <div>\r\n                                                    <p className=\"font-medium\">{order.seller.name}</p>\r\n                                                    <p className=\"text-sm text-muted-foreground\">{order.address.substring(0, 40)}...</p>\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"flex items-center gap-4\">\r\n                                                <p className=\"text-sm text-muted-foreground\">\r\n                                                    {order.pickupDate && new Date(order.pickupDate).toLocaleDateString()}\r\n                                                </p>\r\n                                                <form action={updateOrderStatus}>\r\n                                                    <input type=\"hidden\" name=\"orderId\" value={order.id} />\r\n                                                    <input type=\"hidden\" name=\"status\" value=\"COMPLETED\" />\r\n                                                    <Button type=\"submit\" size=\"sm\" variant=\"outline\">\r\n                                                        Complete\r\n                                                    </Button>\r\n                                                </form>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </CardContent>\r\n                    </Card>\r\n                </div>\r\n\r\n                {/* Sidebar */}\r\n                <div className=\"space-y-6\">\r\n                    {/* Recent Reviews */}\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                                <Star className=\"h-4 w-4 text-yellow-500\" />\r\n                                Recent Reviews\r\n                            </CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            {recentReviews.length === 0 ? (\r\n                                <p className=\"text-sm text-muted-foreground text-center py-4\">No reviews yet</p>\r\n                            ) : (\r\n                                <div className=\"space-y-4\">\r\n                                    {recentReviews.map((review) => (\r\n                                        <div key={review.id} className=\"border-b pb-4 last:border-0\">\r\n                                            <div className=\"flex items-center gap-2 mb-1\">\r\n                                                <Avatar className=\"h-6 w-6\">\r\n                                                    <AvatarFallback className=\"text-xs\">{review.reviewer.name?.[0]}</AvatarFallback>\r\n                                                </Avatar>\r\n                                                <span className=\"text-sm font-medium\">{review.reviewer.name}</span>\r\n                                            </div>\r\n                                            <div className=\"flex items-center gap-1 mb-1\">\r\n                                                {[...Array(5)].map((_, i) => (\r\n                                                    <Star\r\n                                                        key={i}\r\n                                                        className={`h-3 w-3 ${i < review.rating\r\n                                                            ? \"fill-yellow-500 text-yellow-500\"\r\n                                                            : \"text-gray-300\"\r\n                                                            }`}\r\n                                                    />\r\n                                                ))}\r\n                                            </div>\r\n                                            {review.comment && (\r\n                                                <p className=\"text-sm text-muted-foreground\">{review.comment}</p>\r\n                                            )}\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    {/* Quick Stats */}\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                                <TrendingUp className=\"h-4 w-4 text-green-500\" />\r\n                                Performance\r\n                            </CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"space-y-4\">\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <span className=\"text-muted-foreground\">Acceptance Rate</span>\r\n                                <span className=\"font-semibold\">\r\n                                    {orders.length > 0\r\n                                        ? Math.round(((acceptedOrders.length + completedOrders.length) / orders.length) * 100)\r\n                                        : 0}%\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <span className=\"text-muted-foreground\">Completion Rate</span>\r\n                                <span className=\"font-semibold\">\r\n                                    {(acceptedOrders.length + completedOrders.length) > 0\r\n                                        ? Math.round((completedOrders.length / (acceptedOrders.length + completedOrders.length)) * 100)\r\n                                        : 0}%\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <span className=\"text-muted-foreground\">Avg Response</span>\r\n                                <span className=\"font-semibold\">{profile?.avgResponseTime || 0} min</span>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\kabadiwala\\profile\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MapPin' is defined but never used.","line":15,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":16,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProfile'. Either include it or remove the dependency array.","line":82,"column":8,"nodeType":"ArrayExpression","endLine":82,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchProfile]","fix":{"range":[2423,2425],"text":"[fetchProfile]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":211,"column":29,"nodeType":"JSXOpeningElement","endLine":211,"endColumn":107}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport Link from \"next/link\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\"\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport {\r\n    Camera, Star, Clock, MapPin, Package, CheckCircle,\r\n    TrendingUp, Users, Loader2, Save, ImagePlus\r\n} from \"lucide-react\"\r\nimport { motion } from \"framer-motion\"\r\nimport { toast } from \"sonner\"\r\n\r\ninterface KabadiwalaProfile {\r\n    id: string\r\n    name: string\r\n    phone: string\r\n    image: string | null\r\n    kabadiwalaProfile: {\r\n        id: string\r\n        businessName: string\r\n        coverImage: string | null\r\n        bio: string | null\r\n        serviceArea: string | null\r\n        rating: number\r\n        totalReviews: number\r\n        totalPickups: number\r\n        isVerified: boolean\r\n        serviceHours: string | null\r\n        rates: string | null\r\n        avgResponseTime: number\r\n    } | null\r\n}\r\n\r\ninterface ProfileUpdateBody {\r\n    section: string\r\n    businessName?: FormDataEntryValue | null\r\n    bio?: FormDataEntryValue | null\r\n    serviceArea?: FormDataEntryValue | null\r\n    rates?: string\r\n    serviceHours?: string\r\n}\r\n\r\nconst defaultRates = {\r\n    iron: 30,\r\n    plastic: 15,\r\n    paper: 10,\r\n    copper: 450,\r\n    brass: 320,\r\n    aluminium: 100,\r\n    newspaper: 12,\r\n    bottles: 2\r\n}\r\n\r\nconst defaultHours = {\r\n    mon: \"9:00 AM - 6:00 PM\",\r\n    tue: \"9:00 AM - 6:00 PM\",\r\n    wed: \"9:00 AM - 6:00 PM\",\r\n    thu: \"9:00 AM - 6:00 PM\",\r\n    fri: \"9:00 AM - 6:00 PM\",\r\n    sat: \"9:00 AM - 2:00 PM\",\r\n    sun: \"Closed\"\r\n}\r\n\r\nexport default function KabadiwalaProfilePage() {\r\n    const router = useRouter()\r\n    const [loading, setLoading] = useState(true)\r\n    const [saving, setSaving] = useState(false)\r\n    const [profile, setProfile] = useState<KabadiwalaProfile | null>(null)\r\n    const [rates, setRates] = useState(defaultRates)\r\n    const [hours, setHours] = useState(defaultHours)\r\n\r\n    useEffect(() => {\r\n        fetchProfile()\r\n    }, [])\r\n\r\n    async function fetchProfile() {\r\n        try {\r\n            const res = await fetch(\"/api/kabadiwala/profile\")\r\n            if (res.ok) {\r\n                const data = await res.json()\r\n                setProfile(data)\r\n                if (data.kabadiwalaProfile?.rates) {\r\n                    try { setRates(JSON.parse(data.kabadiwalaProfile.rates)) } catch { }\r\n                }\r\n                if (data.kabadiwalaProfile?.serviceHours) {\r\n                    try { setHours(JSON.parse(data.kabadiwalaProfile.serviceHours)) } catch { }\r\n                }\r\n            } else {\r\n                router.push(\"/login\")\r\n            }\r\n        } catch {\r\n            router.push(\"/login\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    async function handleSave(section: string) {\r\n        setSaving(true)\r\n        try {\r\n            const body: ProfileUpdateBody = { section }\r\n\r\n            if (section === \"basic\") {\r\n                const form = document.getElementById(\"basic-form\") as HTMLFormElement\r\n                const formData = new FormData(form)\r\n                body.businessName = formData.get(\"businessName\")\r\n                body.bio = formData.get(\"bio\")\r\n                body.serviceArea = formData.get(\"serviceArea\")\r\n            } else if (section === \"rates\") {\r\n                body.rates = JSON.stringify(rates)\r\n            } else if (section === \"hours\") {\r\n                body.serviceHours = JSON.stringify(hours)\r\n            }\r\n\r\n            await fetch(\"/api/kabadiwala/profile\", {\r\n                method: \"PUT\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify(body)\r\n            })\r\n\r\n            await fetchProfile()\r\n            toast.success(\"Profile saved successfully\")\r\n        } catch {\r\n            toast.error(\"Failed to save profile\")\r\n        } finally {\r\n            setSaving(false)\r\n        }\r\n    }\r\n\r\n    async function handleImageUpload(e: React.ChangeEvent<HTMLInputElement>, type: 'profile' | 'cover') {\r\n        const file = e.target.files?.[0]\r\n        if (!file) return\r\n\r\n        if (file.size > 5 * 1024 * 1024) {\r\n            toast.error(\"File too large (Max 5MB)\")\r\n            return\r\n        }\r\n\r\n        const formData = new FormData()\r\n        formData.append(\"file\", file)\r\n        formData.append(\"type\", type)\r\n\r\n        const loadingToast = toast.loading(\"Uploading image...\")\r\n\r\n        try {\r\n            // Upload to storage\r\n            const uploadRes = await fetch(\"/api/upload\", {\r\n                method: \"POST\",\r\n                body: formData,\r\n                credentials: 'include'\r\n            })\r\n\r\n            if (!uploadRes.ok) throw new Error(\"Upload failed\")\r\n\r\n            const uploadData = await uploadRes.json()\r\n            const imageUrl = uploadData.url\r\n\r\n            // Update profile with new image URL\r\n            const updateRes = await fetch(\"/api/kabadiwala/profile\", {\r\n                method: \"PUT\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({\r\n                    section: \"images\",\r\n                    [type === 'profile' ? 'image' : 'coverImage']: imageUrl\r\n                })\r\n            })\r\n\r\n            if (!updateRes.ok) throw new Error(\"Failed to update profile\")\r\n\r\n            await fetchProfile()\r\n            toast.dismiss(loadingToast)\r\n            toast.success(\"Image updated successfully\")\r\n        } catch (error) {\r\n            console.error(error)\r\n            toast.dismiss(loadingToast)\r\n            toast.error(\"Failed to upload image\")\r\n        }\r\n    }\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-[60vh]\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    if (!profile) return null\r\n\r\n    const kp = profile.kabadiwalaProfile\r\n\r\n    return (\r\n        <div className=\"container mx-auto py-8 px-4 max-w-4xl\">\r\n            <motion.div\r\n                initial={{ opacity: 0, y: 20 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                transition={{ duration: 0.5 }}\r\n            >\r\n                {/* Header with Cover Image */}\r\n                <div className=\"relative mb-8\">\r\n                    <div className=\"h-40 bg-gradient-to-r from-primary/20 to-primary/5 rounded-xl overflow-hidden\">\r\n                        {kp?.coverImage && (\r\n                            <img src={kp.coverImage} alt=\"Cover\" className=\"w-full h-full object-cover\" />\r\n                        )}\r\n                        <label className=\"absolute bottom-4 right-4 p-2 bg-background/80 rounded-lg cursor-pointer hover:bg-background transition-colors flex items-center gap-2\">\r\n                            <ImagePlus className=\"h-4 w-4\" />\r\n                            <span className=\"text-sm\">Change Cover</span>\r\n                            <input\r\n                                type=\"file\"\r\n                                accept=\"image/*\"\r\n                                className=\"hidden\"\r\n                                onChange={(e) => handleImageUpload(e, 'cover')}\r\n                            />\r\n                        </label>\r\n                    </div>\r\n\r\n                    <div className=\"absolute -bottom-12 left-6 flex items-end gap-4\">\r\n                        <div className=\"relative\">\r\n                            <Avatar className=\"h-24 w-24 border-4 border-background\">\r\n                                <AvatarImage src={profile.image || undefined} />\r\n                                <AvatarFallback className=\"text-2xl bg-primary text-primary-foreground\">\r\n                                    {kp?.businessName?.[0] || 'K'}\r\n                                </AvatarFallback>\r\n                            </Avatar>\r\n                            <label className=\"absolute bottom-0 right-0 p-1.5 bg-primary rounded-full cursor-pointer\">\r\n                                <Camera className=\"h-4 w-4 text-white\" />\r\n                                <input\r\n                                    type=\"file\"\r\n                                    accept=\"image/*\"\r\n                                    className=\"hidden\"\r\n                                    onChange={(e) => handleImageUpload(e, 'profile')}\r\n                                />\r\n                            </label>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"mt-16 mb-8 flex justify-between items-start\">\r\n                    <div>\r\n                        <h1 className=\"text-2xl font-bold flex items-center gap-2\">\r\n                            {kp?.businessName || \"Your Business\"}\r\n                            {kp?.isVerified && (\r\n                                <Badge className=\"bg-blue-500\">\r\n                                    <CheckCircle className=\"h-3 w-3 mr-1\" /> Verified\r\n                                </Badge>\r\n                            )}\r\n                        </h1>\r\n                        <div className=\"flex items-center gap-4 mt-2 text-muted-foreground\">\r\n                            <span className=\"flex items-center\">\r\n                                <Star className=\"h-4 w-4 text-yellow-500 fill-yellow-500 mr-1\" />\r\n                                {kp?.rating?.toFixed(1) || \"0.0\"} ({kp?.totalReviews || 0} reviews)\r\n                            </span>\r\n                            <span className=\"flex items-center\">\r\n                                <Package className=\"h-4 w-4 mr-1\" />\r\n                                {kp?.totalPickups || 0} pickups\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                    <Link href=\"/kabadiwala/dashboard\">\r\n                        <Button variant=\"outline\">Go to Dashboard</Button>\r\n                    </Link>\r\n                </div>\r\n\r\n                {/* Stats Cards */}\r\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8\">\r\n                    <Card>\r\n                        <CardContent className=\"pt-6\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <Star className=\"h-5 w-5 text-yellow-500\" />\r\n                                <div>\r\n                                    <p className=\"text-2xl font-bold\">{kp?.rating?.toFixed(1) || \"0.0\"}</p>\r\n                                    <p className=\"text-xs text-muted-foreground\">Rating</p>\r\n                                </div>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n                    <Card>\r\n                        <CardContent className=\"pt-6\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <Users className=\"h-5 w-5 text-blue-500\" />\r\n                                <div>\r\n                                    <p className=\"text-2xl font-bold\">{kp?.totalReviews || 0}</p>\r\n                                    <p className=\"text-xs text-muted-foreground\">Reviews</p>\r\n                                </div>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n                    <Card>\r\n                        <CardContent className=\"pt-6\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <Package className=\"h-5 w-5 text-green-500\" />\r\n                                <div>\r\n                                    <p className=\"text-2xl font-bold\">{kp?.totalPickups || 0}</p>\r\n                                    <p className=\"text-xs text-muted-foreground\">Pickups</p>\r\n                                </div>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n                    <Card>\r\n                        <CardContent className=\"pt-6\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <Clock className=\"h-5 w-5 text-orange-500\" />\r\n                                <div>\r\n                                    <p className=\"text-2xl font-bold\">{kp?.avgResponseTime || 0}m</p>\r\n                                    <p className=\"text-xs text-muted-foreground\">Avg Response</p>\r\n                                </div>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n                </div>\r\n\r\n                <Tabs defaultValue=\"basic\" className=\"space-y-6\">\r\n                    <TabsList className=\"grid w-full grid-cols-3\">\r\n                        <TabsTrigger value=\"basic\">Basic Info</TabsTrigger>\r\n                        <TabsTrigger value=\"rates\">Rates</TabsTrigger>\r\n                        <TabsTrigger value=\"hours\">Service Hours</TabsTrigger>\r\n                    </TabsList>\r\n\r\n                    {/* Basic Info */}\r\n                    <TabsContent value=\"basic\">\r\n                        <Card>\r\n                            <CardHeader>\r\n                                <CardTitle>Business Information</CardTitle>\r\n                                <CardDescription>This info will be visible to customers</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent>\r\n                                <form id=\"basic-form\" className=\"space-y-4\">\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label>Business Name</Label>\r\n                                        <Input name=\"businessName\" defaultValue={kp?.businessName || \"\"} />\r\n                                    </div>\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label>About Your Business</Label>\r\n                                        <Textarea\r\n                                            name=\"bio\"\r\n                                            defaultValue={kp?.bio || \"\"}\r\n                                            placeholder=\"Tell customers about your service...\"\r\n                                            rows={4}\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label>Service Area</Label>\r\n                                        <Input\r\n                                            name=\"serviceArea\"\r\n                                            defaultValue={kp?.serviceArea || \"\"}\r\n                                            placeholder=\"e.g. South Delhi, Noida, Gurugram\"\r\n                                        />\r\n                                    </div>\r\n                                    <Button onClick={() => handleSave(\"basic\")} disabled={saving}>\r\n                                        {saving && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                                        <Save className=\"h-4 w-4 mr-2\" /> Save Changes\r\n                                    </Button>\r\n                                </form>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </TabsContent>\r\n\r\n                    {/* Rates */}\r\n                    <TabsContent value=\"rates\">\r\n                        <Card>\r\n                            <CardHeader>\r\n                                <CardTitle>Your Rates ( per kg)</CardTitle>\r\n                                <CardDescription>Set competitive prices to attract customers</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent>\r\n                                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\r\n                                    {Object.entries(rates).map(([material, price]) => (\r\n                                        <div key={material} className=\"space-y-2\">\r\n                                            <Label className=\"capitalize\">{material}</Label>\r\n                                            <div className=\"flex items-center\">\r\n                                                <span className=\"px-3 py-2 bg-muted rounded-l-md border border-r-0\"></span>\r\n                                                <Input\r\n                                                    type=\"number\"\r\n                                                    value={price}\r\n                                                    onChange={(e) => setRates({ ...rates, [material]: Number(e.target.value) })}\r\n                                                    className=\"rounded-l-none\"\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                                <Button onClick={() => handleSave(\"rates\")} disabled={saving}>\r\n                                    {saving && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                                    <Save className=\"h-4 w-4 mr-2\" /> Save Rates\r\n                                </Button>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </TabsContent>\r\n\r\n                    {/* Service Hours */}\r\n                    <TabsContent value=\"hours\">\r\n                        <Card>\r\n                            <CardHeader>\r\n                                <CardTitle>Service Hours</CardTitle>\r\n                                <CardDescription>When are you available for pickups?</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent>\r\n                                <div className=\"space-y-4 mb-6\">\r\n                                    {Object.entries(hours).map(([day, time]) => (\r\n                                        <div key={day} className=\"flex items-center gap-4\">\r\n                                            <Label className=\"capitalize w-20\">{day}</Label>\r\n                                            <Input\r\n                                                value={time}\r\n                                                onChange={(e) => setHours({ ...hours, [day]: e.target.value })}\r\n                                                placeholder=\"e.g. 9:00 AM - 6:00 PM or Closed\"\r\n                                                className=\"flex-1\"\r\n                                            />\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                                <Button onClick={() => handleSave(\"hours\")} disabled={saving}>\r\n                                    {saving && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                                    <Save className=\"h-4 w-4 mr-2\" /> Save Hours\r\n                                </Button>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </TabsContent>\r\n                </Tabs>\r\n            </motion.div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\market\\FavoriteButtonWrapper.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\market\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":20,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { db } from \"@/lib/db\"\r\nimport { cookies } from \"next/headers\"\r\nimport { KabadiwalaCard } from \"@/components/kabadiwala-card\"\r\nimport { Metadata } from \"next\"\r\n\r\nexport const metadata: Metadata = {\r\n    title: \"Find Kabadiwala Near You | Sell Scrap Online\",\r\n    description: \"Locate verified scrap dealers in your area. Check ratings, book pickups, and get the best rates for your scrap.\",\r\n}\r\n\r\nasync function getKabadiwalas() {\r\n    try {\r\n        const kabadiwalas = await db.kabadiwalaProfile.findMany({\r\n            include: { user: true },\r\n            orderBy: { isVerified: 'desc' } // Show verified first, then others\r\n        })\r\n        return kabadiwalas\r\n    } catch (error) {\r\n        return []\r\n    }\r\n}\r\n\r\nasync function getUserFavorites() {\r\n    const cookieStore = await cookies()\r\n    const userId = cookieStore.get(\"userId\")?.value\r\n    if (!userId) return []\r\n\r\n    const favorites = await db.favorite.findMany({\r\n        where: { userId },\r\n        select: { kabadiwalaId: true }\r\n    })\r\n    return favorites.map(f => f.kabadiwalaId)\r\n}\r\n\r\nexport default async function MarketPage() {\r\n    const kabadiwalas = await getKabadiwalas()\r\n    const favoriteIds = await getUserFavorites()\r\n\r\n    return (\r\n        <div className=\"container mx-auto py-8 px-4\">\r\n            <div className=\"mb-8\">\r\n                <h1 className=\"text-3xl font-bold mb-2\">Find a Kabadiwala Nearby</h1>\r\n                <p className=\"text-muted-foreground\">Browse verified scrap dealers in your area</p>\r\n            </div>\r\n\r\n            <div className=\"flex gap-4 mb-8\">\r\n                <Input placeholder=\"Search by area or name...\" className=\"max-w-md\" />\r\n                <Button>Search</Button>\r\n            </div>\r\n\r\n            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                {kabadiwalas.length === 0 ? (\r\n                    <p className=\"col-span-full text-center text-muted-foreground py-12\">\r\n                        No verified Kabadiwalas found. Please try seeding the database.\r\n                    </p>\r\n                ) : (\r\n                    kabadiwalas.map((profile) => (\r\n                        <KabadiwalaCard\r\n                            key={profile.id}\r\n                            profile={profile}\r\n                            isFavorited={favoriteIds.includes(profile.userId)}\r\n                        />\r\n                    ))\r\n                )}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\orders\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tabs' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsContent' is defined but never used.","line":4,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsList' is defined but never used.","line":4,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsTrigger' is defined but never used.","line":4,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":5,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":5,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Loader2, Package, Clock, CheckCircle, XCircle, RefreshCw } from \"lucide-react\"\r\nimport { OrderCard } from \"@/components/orders\"\r\n\r\ninterface Order {\r\n    id: string\r\n    status: string\r\n    address: string\r\n    pickupDate: string | null\r\n    totalAmount: number | null\r\n    items: string | null\r\n    createdAt: string\r\n    buyer: {\r\n        id: string\r\n        name: string | null\r\n        phone: string\r\n        kabadiwalaProfile?: {\r\n            businessName: string\r\n            rating: number\r\n            isVerified: boolean\r\n        } | null\r\n    }\r\n    review?: {\r\n        rating: number\r\n        comment: string | null\r\n    } | null\r\n}\r\n\r\nexport default function OrdersPage() {\r\n    const [orders, setOrders] = useState<Order[]>([])\r\n    const [loading, setLoading] = useState(true)\r\n    const [activeTab, setActiveTab] = useState(\"all\")\r\n\r\n    const fetchOrders = async () => {\r\n        setLoading(true)\r\n        try {\r\n            const res = await fetch(\"/api/orders\")\r\n            if (res.ok) {\r\n                const data = await res.json()\r\n                setOrders(data)\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch orders:\", error)\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        fetchOrders()\r\n    }, [])\r\n\r\n    const filteredOrders = orders.filter(order => {\r\n        if (activeTab === \"all\") return true\r\n        return order.status === activeTab.toUpperCase()\r\n    })\r\n\r\n    const stats = {\r\n        all: orders.length,\r\n        requested: orders.filter(o => o.status === \"REQUESTED\").length,\r\n        accepted: orders.filter(o => o.status === \"ACCEPTED\").length,\r\n        completed: orders.filter(o => o.status === \"COMPLETED\").length,\r\n        cancelled: orders.filter(o => o.status === \"CANCELLED\").length,\r\n    }\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"container mx-auto py-12 flex items-center justify-center\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"container mx-auto py-8 px-4\">\r\n            <div className=\"flex items-center justify-between mb-8\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold\">My Orders</h1>\r\n                    <p className=\"text-muted-foreground\">Manage your pickup requests</p>\r\n                </div>\r\n                <Button variant=\"outline\" onClick={fetchOrders} className=\"gap-2\">\r\n                    <RefreshCw className=\"h-4 w-4\" />\r\n                    Refresh\r\n                </Button>\r\n            </div>\r\n\r\n            {/* Quick Stats */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4 mb-8\">\r\n                <Card className={`cursor-pointer transition-all ${activeTab === \"all\" ? \"ring-2 ring-primary\" : \"\"}`} onClick={() => setActiveTab(\"all\")}>\r\n                    <CardContent className=\"pt-4 pb-4\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Package className=\"h-5 w-5 text-primary\" />\r\n                            <div>\r\n                                <p className=\"text-2xl font-bold\">{stats.all}</p>\r\n                                <p className=\"text-xs text-muted-foreground\">All Orders</p>\r\n                            </div>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card className={`cursor-pointer transition-all ${activeTab === \"requested\" ? \"ring-2 ring-yellow-500\" : \"\"}`} onClick={() => setActiveTab(\"requested\")}>\r\n                    <CardContent className=\"pt-4 pb-4\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Clock className=\"h-5 w-5 text-yellow-500\" />\r\n                            <div>\r\n                                <p className=\"text-2xl font-bold\">{stats.requested}</p>\r\n                                <p className=\"text-xs text-muted-foreground\">Pending</p>\r\n                            </div>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card className={`cursor-pointer transition-all ${activeTab === \"accepted\" ? \"ring-2 ring-blue-500\" : \"\"}`} onClick={() => setActiveTab(\"accepted\")}>\r\n                    <CardContent className=\"pt-4 pb-4\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Package className=\"h-5 w-5 text-blue-500\" />\r\n                            <div>\r\n                                <p className=\"text-2xl font-bold\">{stats.accepted}</p>\r\n                                <p className=\"text-xs text-muted-foreground\">Scheduled</p>\r\n                            </div>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card className={`cursor-pointer transition-all ${activeTab === \"completed\" ? \"ring-2 ring-green-500\" : \"\"}`} onClick={() => setActiveTab(\"completed\")}>\r\n                    <CardContent className=\"pt-4 pb-4\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <CheckCircle className=\"h-5 w-5 text-green-500\" />\r\n                            <div>\r\n                                <p className=\"text-2xl font-bold\">{stats.completed}</p>\r\n                                <p className=\"text-xs text-muted-foreground\">Completed</p>\r\n                            </div>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card className={`cursor-pointer transition-all ${activeTab === \"cancelled\" ? \"ring-2 ring-red-500\" : \"\"}`} onClick={() => setActiveTab(\"cancelled\")}>\r\n                    <CardContent className=\"pt-4 pb-4\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <XCircle className=\"h-5 w-5 text-red-500\" />\r\n                            <div>\r\n                                <p className=\"text-2xl font-bold\">{stats.cancelled}</p>\r\n                                <p className=\"text-xs text-muted-foreground\">Cancelled</p>\r\n                            </div>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Orders List */}\r\n            {filteredOrders.length === 0 ? (\r\n                <Card>\r\n                    <CardContent className=\"py-12 text-center\">\r\n                        <Package className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\r\n                        <p className=\"text-muted-foreground mb-4\">\r\n                            {activeTab === \"all\" ? \"No orders yet\" : `No ${activeTab} orders`}\r\n                        </p>\r\n                        <Button asChild>\r\n                            <a href=\"/market\">Find Kabadiwala</a>\r\n                        </Button>\r\n                    </CardContent>\r\n                </Card>\r\n            ) : (\r\n                <div className=\"space-y-4\">\r\n                    {filteredOrders.map((order) => (\r\n                        <OrderCard\r\n                            key={order.id}\r\n                            order={order}\r\n                            userRole=\"SELLER\"\r\n                            onStatusUpdate={fetchOrders}\r\n                        />\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":61,"column":84,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2424,2452],"text":"India&apos;s #1 Scrap Selling App"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2424,2452],"text":"India&lsquo;s #1 Scrap Selling App"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2424,2452],"text":"India&#39;s #1 Scrap Selling App"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2424,2452],"text":"India&rsquo;s #1 Scrap Selling App"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":151,"column":77,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[7575,7605],"text":"Leftover Food? Don&apos;t Throw It!"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[7575,7605],"text":"Leftover Food? Don&lsquo;t Throw It!"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[7575,7605],"text":"Leftover Food? Don&#39;t Throw It!"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[7575,7605],"text":"Leftover Food? Don&rsquo;t Throw It!"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":195,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9452,9455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9452,9455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from \"next/link\"\nimport React from \"react\"\nimport { Button } from \"@/components/ui/button\"\nimport { Card, CardContent } from \"@/components/ui/card\"\nimport { ArrowRight, MapPin, MessageCircle, Star, Phone, Recycle, LayoutDashboard, Heart, Utensils } from \"lucide-react\"\nimport { StoriesSection } from \"@/components/stories/StoriesSection\"\nimport { ScrapRatesTicker } from \"@/components/dashboard/ScrapRatesTicker\"\nimport { db } from \"@/lib/db\"\nimport { KabadiwalaCard } from \"@/components/kabadiwala-card\"\nimport { cookies } from \"next/headers\"\nimport Image from \"next/image\"\n\n// Direct call number for users who don't want to create profile\nconst HELPLINE_NUMBER = \"8586040076\"\n\nasync function getFeaturedKabadiwalas() {\n  try {\n    return await db.kabadiwalaProfile.findMany({\n      include: { user: true },\n      where: { isVerified: true },\n      take: 3, // Featured limit\n      orderBy: { rating: 'desc' }\n    })\n  } catch {\n    return []\n  }\n}\n\nasync function getUserFavorites() {\n  const cookieStore = await cookies()\n  const userId = cookieStore.get(\"userId\")?.value\n  if (!userId) return []\n\n  try {\n    const favorites = await db.favorite.findMany({\n      where: { userId },\n      select: { kabadiwalaId: true }\n    })\n    return favorites.map(f => f.kabadiwalaId)\n  } catch (error) {\n    console.error(\"Error fetching favorites:\", error)\n    return []\n  }\n}\n\nexport default async function LandingPage() {\n  const featuredKabadiwalas = await getFeaturedKabadiwalas()\n  const favoriteIds = await getUserFavorites()\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <main className=\"flex-1\">\n        {/* Hero Section */}\n        <section className=\"relative py-24 px-4 text-center overflow-hidden\">\n          {/* Animated Background Blob */}\n          <div className=\"absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[800px] bg-primary/5 rounded-full blur-3xl -z-10 animate-pulse duration-[5000ms]\" />\n\n          <div className=\"container mx-auto max-w-3xl relative z-10\">\n            <div className=\"inline-flex items-center gap-2 bg-gradient-to-r from-primary/10 to-transparent border border-primary/10 text-primary px-5 py-2.5 rounded-full mb-8 backdrop-blur-sm shadow-sm hover:scale-105 transition-transform duration-300\">\n              <Recycle className=\"h-5 w-5 animate-spin-slow\" />\n              <span className=\"text-sm font-semibold tracking-wide uppercase\">India's #1 Scrap Selling App</span>\n            </div>\n\n            <h1 className=\"text-5xl md:text-7xl font-black tracking-tight mb-8 bg-gradient-to-b from-foreground to-foreground/60 bg-clip-text text-transparent px-2 leading-[1.1]\">\n              Turn Your Waste into <span className=\"text-green-600 dark:text-green-500\">Cash </span>\n            </h1>\n\n            <p className=\"text-xl md:text-2xl text-muted-foreground mb-10 max-w-2xl mx-auto leading-relaxed\">\n              Fastest way to sell clean scrap. Get instant quotes, free doorstep pickup, and immediate payment.\n            </p>\n\n            <div className=\"flex flex-col sm:flex-row justify-center items-center gap-4\">\n              {/* Conditional Dashboard Button */}\n              {(await cookies()).get(\"userId\") ? (\n                <Button asChild size=\"lg\" className=\"h-14 px-10 text-lg rounded-full shadow-lg shadow-primary/20 hover:shadow-xl hover:shadow-primary/30 active:scale-95 transition-all w-full sm:w-auto bg-gradient-to-r from-green-600 to-emerald-600 border-0\">\n                  <Link href=\"/dashboard\">\n                    <LayoutDashboard className=\"mr-2 h-5 w-5\" /> Go to Dashboard\n                  </Link>\n                </Button>\n              ) : (\n                <>\n                  <Button asChild size=\"lg\" className=\"h-14 px-10 text-lg rounded-full shadow-lg shadow-primary/20 hover:shadow-xl hover:shadow-primary/30 active:scale-95 transition-all w-full sm:w-auto bg-green-600 hover:bg-green-700\">\n                    <Link href=\"/market\">\n                      Find Kabadiwala <ArrowRight className=\"ml-2 h-5 w-5\" />\n                    </Link>\n                  </Button>\n                  <Button asChild size=\"lg\" variant=\"outline\" className=\"h-14 px-10 text-lg rounded-full border-2 hover:bg-muted active:scale-95 transition-all w-full sm:w-auto bg-transparent backdrop-blur-sm\">\n                    <Link href=\"/register\">\n                      Create Account\n                    </Link>\n                  </Button>\n                </>\n              )}\n            </div>\n          </div>\n        </section>\n\n        {/* Daily Rates Ticker */}\n        <section className=\"container mx-auto px-4 -mt-6 relative z-10 mb-8\">\n          <ScrapRatesTicker />\n        </section>\n\n        {/* COMMUNITY IMPACT SECTION (NEW) */}\n        <section className=\"py-16 px-4 bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-950/20 dark:to-background\">\n          <div className=\"container mx-auto max-w-6xl\">\n            <div className=\"text-center mb-12\">\n              <h2 className=\"text-3xl md:text-4xl font-bold mb-4\">Making a Difference Together </h2>\n              <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n                We are more than just a business. Join us in our mission to help the needy and reduce food waste.\n              </p>\n            </div>\n\n            <div className=\"grid md:grid-cols-2 gap-8 items-center\">\n\n              {/* Donation Card */}\n              <Card className=\"overflow-hidden border-orange-200 shadow-xl bg-white dark:bg-card\">\n                <CardContent className=\"p-0 flex flex-col md:flex-row\">\n                  <div className=\"bg-orange-600 p-8 flex flex-col justify-center items-center text-white md:w-2/5\">\n                    <Image\n                      src=\"/donate-qr.png\"\n                      alt=\"Donation QR Code\"\n                      width={300}\n                      height={300}\n                      className=\"rounded-xl shadow-lg mb-4 bg-white p-3\"\n                    />\n                    <p className=\"font-bold text-center text-sm opacity-90\">SCAN TO DONATE</p>\n                  </div>\n                  <div className=\"p-8 md:w-3/5 flex flex-col justify-center\">\n                    <div className=\"flex items-center gap-2 text-orange-600 font-bold mb-2\">\n                      <Heart className=\"h-5 w-5 fill-current\" />\n                      <span>Support the Cause</span>\n                    </div>\n                    <h3 className=\"text-2xl font-bold mb-2\">Share Your Profit</h3>\n                    <p className=\"text-muted-foreground mb-6\">\n                      If you are a Kabadiwala and made a profit, consider sharing a small part.\n                      Your donation helps us feed the poor and support our team.\n                    </p>\n                    <p className=\"text-xs text-muted-foreground italic\">\n                      * All donations are voluntary and used 100% for social welfare.\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Food Rescue Card */}\n              <Card className=\"overflow-hidden border-green-200 shadow-xl bg-white dark:bg-card h-full\">\n                <CardContent className=\"p-8 flex flex-col h-full justify-center text-center items-center\">\n                  <div className=\"h-16 w-16 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-full flex items-center justify-center mb-6\">\n                    <Utensils className=\"h-8 w-8\" />\n                  </div>\n                  <h3 className=\"text-2xl font-bold mb-2\">Leftover Food? Don't Throw It!</h3>\n                  <p className=\"text-muted-foreground mb-8 max-w-md\">\n                    Have excess food from a wedding or party? Let us know.\n                    We will pick it up and distribute it to the hungry.\n                  </p>\n                  <Button asChild size=\"lg\" className=\"w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-600/20\">\n                    <Link href=\"/food-rescue\">\n                      Start Food Rescue (Annadaan) <ArrowRight className=\"ml-2 h-4 w-4\" />\n                    </Link>\n                  </Button>\n                </CardContent>\n              </Card>\n\n            </div>\n          </div>\n        </section>\n\n        {/* Stories Section */}\n        <section className=\"py-6 px-4\">\n          <div className=\"container mx-auto max-w-4xl\">\n            <StoriesSection />\n          </div>\n        </section>\n\n        {/* Featured Kabadiwalas Section */}\n        {featuredKabadiwalas.length > 0 && (\n          <section className=\"py-16 px-4 bg-muted/50\">\n            <div className=\"container mx-auto\">\n              <div className=\"flex justify-between items-end mb-10\">\n                <div>\n                  <h3 className=\"text-2xl font-bold mb-2\">Top Rated Kabadiwalas</h3>\n                  <p className=\"text-muted-foreground\">Trusted scrap dealers near you</p>\n                </div>\n                <Button asChild variant=\"ghost\">\n                  <Link href=\"/market\">\n                    View All <ArrowRight className=\"ml-2 h-4 w-4\" />\n                  </Link>\n                </Button>\n              </div>\n\n              <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {featuredKabadiwalas.map((profile) => (\n                  <KabadiwalaCard\n                    key={profile.id}\n                    profile={profile as any}\n                    isFavorited={favoriteIds.includes(profile.userId)}\n                  />\n                ))}\n              </div>\n            </div>\n          </section>\n        )}\n\n        {/* Direct Call Section - For users who don't want to register */}\n        <section className=\"py-12 px-4 bg-gradient-to-r from-green-500/10 via-green-500/5 to-green-500/10\">\n          <div className=\"container mx-auto max-w-3xl\">\n            <Card className=\"border-2 border-green-500/30 bg-gradient-to-br from-green-50 to-white dark:from-green-950/30 dark:to-background overflow-hidden\">\n              <CardContent className=\"p-8\">\n                <div className=\"flex flex-col md:flex-row items-center gap-6\">\n                  <div className=\"p-4 bg-green-500/10 rounded-full\">\n                    <Phone className=\"h-10 w-10 text-green-600\" />\n                  </div>\n                  <div className=\"flex-1 text-center md:text-left\">\n                    <h3 className=\"text-2xl font-bold mb-2\">Don&apos;t Want to Register?</h3>\n                    <p className=\"text-muted-foreground mb-4\">\n                      No problem! Simply call our helpline number and sell your scrap directly.\n                      Our team will arrange pickup at your doorstep.\n                    </p>\n                    <div className=\"flex flex-col sm:flex-row items-center gap-4\">\n                      <a\n                        href={`tel:${HELPLINE_NUMBER}`}\n                        className=\"inline-flex items-center gap-3 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold text-lg transition-colors\"\n                      >\n                        <Phone className=\"h-5 w-5\" />\n                        Call Now: {HELPLINE_NUMBER}\n                      </a>\n                      <div className=\"text-sm text-muted-foreground\">\n                        <p> Available 9 AM - 8 PM</p>\n                        <p> Hindi & English</p>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                <div className=\"mt-6 pt-6 border-t grid grid-cols-1 sm:grid-cols-3 gap-4 text-center\">\n                  <div>\n                    <p className=\"font-semibold text-lg\"> Free Pickup</p>\n                    <p className=\"text-sm text-muted-foreground\">At your doorstep</p>\n                  </div>\n                  <div>\n                    <p className=\"font-semibold text-lg\"> Cash Payment</p>\n                    <p className=\"text-sm text-muted-foreground\">On the spot</p>\n                  </div>\n                  <div>\n                    <p className=\"font-semibold text-lg\"> Fair Rates</p>\n                    <p className=\"text-sm text-muted-foreground\">Market price</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </section>\n\n        {/* Features */}\n        <section className=\"py-16 px-4\">\n          <div className=\"container mx-auto\">\n            <h3 className=\"text-2xl font-bold text-center mb-10\">Why Choose Our App?</h3>\n            <div className=\"grid md:grid-cols-3 gap-8\">\n              <FeatureCard\n                icon={<Star className=\"h-10 w-10 text-yellow-500\" />}\n                title=\"Rated Dealers\"\n                description=\"Choose the best Kabadiwala based on real user reviews and ratings.\"\n              />\n              <FeatureCard\n                icon={<MessageCircle className=\"h-10 w-10 text-blue-500\" />}\n                title=\"Direct Chat\"\n                description=\"Chat directly with the dealer to negotiate prices and confirm details.\"\n              />\n              <FeatureCard\n                icon={<MapPin className=\"h-10 w-10 text-green-500\" />}\n                title=\"Doorstep Pickup\"\n                description=\"Schedule a pickup at your convenience. Instant cash payment.\"\n              />\n            </div>\n          </div>\n        </section>\n\n        {/* How It Works */}\n        <section className=\"py-16 px-4 bg-muted/30\">\n          <div className=\"container mx-auto max-w-4xl\">\n            <h3 className=\"text-2xl font-bold text-center mb-10\">How It Works</h3>\n            <div className=\"grid md:grid-cols-4 gap-6\">\n              <Step number=\"1\" title=\"Find\" description=\"Browse local Kabadiwalas\" />\n              <Step number=\"2\" title=\"Chat\" description=\"Discuss rates & details\" />\n              <Step number=\"3\" title=\"Book\" description=\"Schedule pickup time\" />\n              <Step number=\"4\" title=\"Earn\" description=\"Get cash on delivery\" />\n            </div>\n          </div>\n        </section>\n      </main>\n\n      <footer className=\"border-t py-8 text-center text-muted-foreground mb-20 md:mb-0\">\n        <div className=\"container mx-auto\">\n          <p className=\"mb-2\">Need help? Call: <a href={`tel:${HELPLINE_NUMBER}`} className=\"text-primary font-semibold\">{HELPLINE_NUMBER}</a></p>\n          <p>&copy; 2024 Kabadiwala App. All rights reserved.</p>\n        </div>\n      </footer>\n    </div>\n  )\n}\n\nfunction FeatureCard({ icon, title, description }: { icon: React.ReactNode, title: string, description: string }) {\n  return (\n    <Card className=\"hover:shadow-lg transition-shadow\">\n      <CardContent className=\"pt-6 text-center flex flex-col items-center\">\n        <div className=\"mb-4 p-3 bg-accent rounded-full\">{icon}</div>\n        <h3 className=\"text-xl font-semibold mb-2\">{title}</h3>\n        <p className=\"text-muted-foreground\">{description}</p>\n      </CardContent>\n    </Card>\n  )\n}\n\nfunction Step({ number, title, description }: { number: string, title: string, description: string }) {\n  return (\n    <div className=\"text-center\">\n      <div className=\"w-12 h-12 rounded-full bg-primary text-primary-foreground text-xl font-bold flex items-center justify-center mx-auto mb-3\">\n        {number}\n      </div>\n      <h4 className=\"font-semibold text-lg\">{title}</h4>\n      <p className=\"text-sm text-muted-foreground\">{description}</p>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\privacy-policy\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\profile\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Leaf' is defined but never used.","line":23,"column":90,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":94},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Recycle' is defined but never used.","line":23,"column":96,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":103},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProfile'. Either include it or remove the dependency array.","line":83,"column":8,"nodeType":"ArrayExpression","endLine":83,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchProfile]","fix":{"range":[3197,3199],"text":"[fetchProfile]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":330,"column":29,"nodeType":"JSXOpeningElement","endLine":330,"endColumn":107},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":463,"column":45,"nodeType":"JSXOpeningElement","endLine":463,"endColumn":123},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":715,"column":61,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[33871,33906],"text":"Type &quot;DELETE MY ACCOUNT\" to confirm"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[33871,33906],"text":"Type &ldquo;DELETE MY ACCOUNT\" to confirm"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[33871,33906],"text":"Type &#34;DELETE MY ACCOUNT\" to confirm"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[33871,33906],"text":"Type &rdquo;DELETE MY ACCOUNT\" to confirm"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":715,"column":79,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[33871,33906],"text":"Type \"DELETE MY ACCOUNT&quot; to confirm"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[33871,33906],"text":"Type \"DELETE MY ACCOUNT&ldquo; to confirm"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[33871,33906],"text":"Type \"DELETE MY ACCOUNT&#34; to confirm"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[33871,33906],"text":"Type \"DELETE MY ACCOUNT&rdquo; to confirm"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect, useRef } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Switch } from \"@/components/ui/switch\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n    AlertDialogTrigger,\r\n} from \"@/components/ui/alert-dialog\"\r\nimport { Loader2, User, Lock, Camera, Bell, Trash2, Save, Upload, CheckCircle, Settings, Leaf, Recycle, Sun, Moon } from \"lucide-react\"\r\nimport { toast } from \"sonner\"\r\nimport Link from \"next/link\"\r\nimport { EcoImpactVisualizer } from \"@/components/profile/EcoImpactVisualizer\"\r\nimport { useTheme } from \"next-themes\"\r\nimport { GreenWalletCard } from \"@/components/gamification/green-wallet-card\"\r\nimport { getUserPoints } from \"@/actions/gamification\"\r\n\r\ninterface UserProfile {\r\n    id: string\r\n    name: string | null\r\n    phone: string\r\n    image: string | null\r\n    address: string | null\r\n    role: string\r\n    createdAt: string\r\n    kabadiwalaProfile?: {\r\n        coverImage: string | null\r\n    }\r\n}\r\n\r\nexport default function ProfilePage() {\r\n    const router = useRouter()\r\n    const { theme, setTheme } = useTheme()\r\n    const fileInputRef = useRef<HTMLInputElement>(null)\r\n    const [loading, setLoading] = useState(true)\r\n    const [saving, setSaving] = useState(false)\r\n    const [uploading, setUploading] = useState(false)\r\n    const [user, setUser] = useState<UserProfile | null>(null)\r\n\r\n    // Gamification Points\r\n    const [points, setPoints] = useState(0)\r\n\r\n    // Profile fields\r\n    const [name, setName] = useState(\"\")\r\n    const [address, setAddress] = useState(\"\")\r\n    const [imageUrl, setImageUrl] = useState(\"\")\r\n    const [coverImageUrl, setCoverImageUrl] = useState(\"\") // New state for cover image\r\n\r\n    // Password change\r\n    const [currentPassword, setCurrentPassword] = useState(\"\")\r\n    const [newPassword, setNewPassword] = useState(\"\")\r\n    const [confirmPassword, setConfirmPassword] = useState(\"\")\r\n    const [changingPassword, setChangingPassword] = useState(false)\r\n\r\n    // Notifications\r\n    const [pushEnabled, setPushEnabled] = useState(false)\r\n    const [orderNotifications, setOrderNotifications] = useState(true)\r\n    const [messageNotifications, setMessageNotifications] = useState(true)\r\n    const [promoNotifications, setPromoNotifications] = useState(false)\r\n\r\n    // Delete account\r\n    const [deletePassword, setDeletePassword] = useState(\"\")\r\n    const [deleteConfirm, setDeleteConfirm] = useState(\"\")\r\n    const [deleting, setDeleting] = useState(false)\r\n\r\n    const coverInputRef = useRef<HTMLInputElement>(null) // Ref for cover input\r\n\r\n    useEffect(() => {\r\n        fetchProfile()\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        if (user?.id) {\r\n            getUserPoints(user.id).then(setPoints)\r\n        }\r\n    }, [user?.id])\r\n\r\n    const fetchProfile = async () => {\r\n        try {\r\n            const res = await fetch(\"/api/profile\")\r\n            if (res.ok) {\r\n                const data = await res.json()\r\n                setUser(data)\r\n                setName(data.name || \"\")\r\n                setAddress(data.address || \"\")\r\n                setImageUrl(data.image || \"\")\r\n                // Set cover image if exists in kabadiwalaProfile\r\n                if (data.kabadiwalaProfile?.coverImage) {\r\n                    setCoverImageUrl(data.kabadiwalaProfile.coverImage)\r\n                }\r\n            } else {\r\n                router.push(\"/login\")\r\n            }\r\n        } catch {\r\n            router.push(\"/login\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>, type: 'profile' | 'cover' = 'profile') => {\r\n        const file = e.target.files?.[0]\r\n        if (!file) return\r\n\r\n        setUploading(true)\r\n        try {\r\n            const formData = new FormData()\r\n            formData.append(\"file\", file)\r\n            formData.append(\"type\", type)\r\n\r\n            const res = await fetch(\"/api/upload\", {\r\n                method: \"POST\",\r\n                body: formData\r\n            })\r\n\r\n            if (res.ok) {\r\n                const data = await res.json()\r\n                if (type === 'profile') {\r\n                    setImageUrl(data.url)\r\n                } else {\r\n                    setCoverImageUrl(data.url)\r\n                }\r\n                toast.success(`${type === 'profile' ? 'Profile' : 'Cover'} photo uploaded!`)\r\n            } else {\r\n                const error = await res.text()\r\n                console.error(\"Upload failed:\", error)\r\n                toast.error(\"Upload failed: \" + (JSON.parse(error).error || \"Server error\"))\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Upload error:\", err)\r\n            toast.error(\"Something went wrong during upload\")\r\n        } finally {\r\n            setUploading(false)\r\n        }\r\n    }\r\n\r\n    const handleSaveProfile = async () => {\r\n        setSaving(true)\r\n        try {\r\n            const res = await fetch(\"/api/profile\", {\r\n                method: \"PUT\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({\r\n                    name,\r\n                    address,\r\n                    image: imageUrl,\r\n                    coverImage: coverImageUrl\r\n                })\r\n            })\r\n\r\n            if (res.ok) {\r\n                toast.success(\"Profile updated!\")\r\n                fetchProfile()\r\n            } else {\r\n                const data = await res.json()\r\n                toast.error(data.error || \"Failed to update\")\r\n            }\r\n        } catch {\r\n            toast.error(\"Something went wrong\")\r\n        } finally {\r\n            setSaving(false)\r\n        }\r\n    }\r\n\r\n    const handleChangePassword = async () => {\r\n        if (newPassword !== confirmPassword) {\r\n            toast.error(\"Passwords don't match\")\r\n            return\r\n        }\r\n\r\n        if (newPassword.length < 6) {\r\n            toast.error(\"Password must be at least 6 characters\")\r\n            return\r\n        }\r\n\r\n        setChangingPassword(true)\r\n        try {\r\n            const res = await fetch(\"/api/auth/change-password\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ currentPassword, newPassword })\r\n            })\r\n\r\n            const data = await res.json()\r\n            if (res.ok) {\r\n                toast.success(\"Password changed!\")\r\n                setCurrentPassword(\"\")\r\n                setNewPassword(\"\")\r\n                setConfirmPassword(\"\")\r\n            } else {\r\n                toast.error(data.error || \"Failed to change password\")\r\n            }\r\n        } catch {\r\n            toast.error(\"Something went wrong\")\r\n        } finally {\r\n            setChangingPassword(false)\r\n        }\r\n    }\r\n\r\n    const handleEnablePush = async () => {\r\n        if (!(\"Notification\" in window)) {\r\n            toast.error(\"Notifications not supported in this browser\")\r\n            return\r\n        }\r\n\r\n        const permission = await Notification.requestPermission()\r\n        if (permission === \"granted\") {\r\n            try {\r\n                if (!(\"serviceWorker\" in navigator)) {\r\n                    toast.error(\"Service Worker not supported\")\r\n                    return\r\n                }\r\n\r\n                const registration = await navigator.serviceWorker.ready\r\n\r\n                // Get VAPID key\r\n                const keyRes = await fetch(\"/api/notifications/vapid-key\")\r\n                const { publicKey } = await keyRes.json()\r\n\r\n                const convertedVapidKey = urlBase64ToUint8Array(publicKey)\r\n\r\n                // Subscribe\r\n                const subscription = await registration.pushManager.subscribe({\r\n                    userVisibleOnly: true,\r\n                    applicationServerKey: convertedVapidKey\r\n                })\r\n\r\n                // Send to server\r\n                await fetch(\"/api/notifications/subscribe\", {\r\n                    method: \"POST\",\r\n                    headers: { \"Content-Type\": \"application/json\" },\r\n                    body: JSON.stringify(subscription)\r\n                })\r\n\r\n                setPushEnabled(true)\r\n                toast.success(\"Notifications enabled!\")\r\n            } catch (error) {\r\n                console.error(\"Subscription failed:\", error)\r\n                toast.error(\"Failed to enable notifications\")\r\n            }\r\n        } else {\r\n            toast.error(\"Notification permission denied\")\r\n        }\r\n    }\r\n\r\n    function urlBase64ToUint8Array(base64String: string) {\r\n        const padding = \"=\".repeat((4 - (base64String.length % 4)) % 4)\r\n        const base64 = (base64String + padding)\r\n            .replace(/\\-/g, \"+\")\r\n            .replace(/_/g, \"/\")\r\n\r\n        const rawData = window.atob(base64)\r\n        const outputArray = new Uint8Array(rawData.length)\r\n\r\n        for (let i = 0; i < rawData.length; ++i) {\r\n            outputArray[i] = rawData.charCodeAt(i)\r\n        }\r\n        return outputArray\r\n    }\r\n\r\n    const handleDeleteAccount = async () => {\r\n        if (deleteConfirm !== \"DELETE MY ACCOUNT\") {\r\n            toast.error(\"Please type 'DELETE MY ACCOUNT' exactly\")\r\n            return\r\n        }\r\n\r\n        setDeleting(true)\r\n        try {\r\n            const res = await fetch(\"/api/profile\", {\r\n                method: \"DELETE\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({\r\n                    password: deletePassword,\r\n                    confirmDelete: deleteConfirm\r\n                })\r\n            })\r\n\r\n            if (res.ok) {\r\n                toast.success(\"Account deleted\")\r\n                router.push(\"/\")\r\n            } else {\r\n                const data = await res.json()\r\n                toast.error(data.error || \"Failed to delete account\")\r\n            }\r\n        } catch {\r\n            toast.error(\"Something went wrong\")\r\n        } finally {\r\n            setDeleting(false)\r\n        }\r\n    }\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-[60vh]\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    if (!user) return null\r\n\r\n    return (\r\n        <div className=\"container mx-auto py-8 px-4 max-w-2xl\">\r\n            {/* Eco Impact Visualizer (Gamification) */}\r\n            <div className=\"mb-8\">\r\n                <EcoImpactVisualizer totalWeight={128} />\r\n                <div className=\"mt-6\">\r\n                    <GreenWalletCard points={points} />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Profile Header */}\r\n            <div className=\"flex items-center gap-6 mb-8\">\r\n                <div className=\"relative\">\r\n                    <Avatar className=\"h-24 w-24 border-4 border-background shadow-lg\">\r\n                        {imageUrl ? (\r\n                            <img src={imageUrl} alt={name || \"\"} className=\"object-cover w-full h-full\" />\r\n                        ) : (\r\n                            <AvatarFallback className=\"bg-gradient-to-br from-green-400 to-green-600 text-white text-3xl\">\r\n                                {name?.[0] || user.phone[0]}\r\n                            </AvatarFallback>\r\n                        )}\r\n                    </Avatar>\r\n                    <button\r\n                        onClick={() => fileInputRef.current?.click()}\r\n                        disabled={uploading}\r\n                        className=\"absolute bottom-0 right-0 p-2 bg-primary rounded-full text-white hover:bg-primary/90 transition-colors\"\r\n                    >\r\n                        {uploading ? (\r\n                            <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                        ) : (\r\n                            <Camera className=\"h-4 w-4\" />\r\n                        )}\r\n                    </button>\r\n                    <input\r\n                        ref={fileInputRef}\r\n                        type=\"file\"\r\n                        accept=\"image/*\"\r\n                        onChange={handleImageUpload}\r\n                        className=\"hidden\"\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold\">{name || \"User\"}</h1>\r\n                    <p className=\"text-muted-foreground\">{user.phone}</p>\r\n                    <span className=\"inline-block mt-2 px-3 py-1 bg-primary/10 rounded-full text-sm text-primary capitalize\">\r\n                        {user.role.toLowerCase()}\r\n                    </span>\r\n                </div>\r\n            </div>\r\n\r\n            <Tabs defaultValue=\"profile\" className=\"space-y-6\">\r\n                <TabsList className=\"grid w-full grid-cols-4\">\r\n                    <TabsTrigger value=\"profile\" className=\"gap-1 text-xs sm:text-sm\">\r\n                        <User className=\"h-4 w-4\" />\r\n                        <span className=\"hidden sm:inline\">Profile</span>\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"security\" className=\"gap-1 text-xs sm:text-sm\">\r\n                        <Lock className=\"h-4 w-4\" />\r\n                        <span className=\"hidden sm:inline\">Security</span>\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"notifications\" className=\"gap-1 text-xs sm:text-sm\">\r\n                        <Bell className=\"h-4 w-4\" />\r\n                        <span className=\"hidden sm:inline\">Alerts</span>\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"settings\" className=\"gap-1 text-xs sm:text-sm\">\r\n                        <Settings className=\"h-4 w-4\" />\r\n                        <span className=\"hidden sm:inline\">Settings</span>\r\n                    </TabsTrigger>\r\n                </TabsList>\r\n\r\n                {/* Profile Tab */}\r\n                <TabsContent value=\"profile\">\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle>Profile Information</CardTitle>\r\n                            <CardDescription>Update your personal details and photo</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent className=\"space-y-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"name\">Full Name</Label>\r\n                                <Input\r\n                                    id=\"name\"\r\n                                    value={name}\r\n                                    onChange={(e) => setName(e.target.value)}\r\n                                    placeholder=\"Your name\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"phone\">Phone Number</Label>\r\n                                <Input\r\n                                    id=\"phone\"\r\n                                    value={user.phone}\r\n                                    disabled\r\n                                    className=\"bg-muted\"\r\n                                />\r\n                                <p className=\"text-xs text-muted-foreground\">Phone number cannot be changed</p>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"address\">Default Pickup Address</Label>\r\n                                <Textarea\r\n                                    id=\"address\"\r\n                                    value={address}\r\n                                    onChange={(e) => setAddress(e.target.value)}\r\n                                    placeholder=\"Enter your complete address for pickups\"\r\n                                    rows={3}\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label>Profile Photo</Label>\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <Input\r\n                                        value={imageUrl}\r\n                                        onChange={(e) => setImageUrl(e.target.value)}\r\n                                        placeholder=\"Or paste image URL...\"\r\n                                        className=\"flex-1\"\r\n                                    />\r\n                                    <Button\r\n                                        variant=\"outline\"\r\n                                        onClick={() => fileInputRef.current?.click()}\r\n                                        disabled={uploading}\r\n                                    >\r\n                                        <Upload className=\"h-4 w-4 mr-2\" />\r\n                                        Upload\r\n                                    </Button>\r\n                                </div>\r\n                            </div>\r\n                            <Button onClick={handleSaveProfile} disabled={saving} className=\"w-full\">\r\n                                {saving ? (\r\n                                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                                ) : (\r\n                                    <Save className=\"h-4 w-4 mr-2\" />\r\n                                )}\r\n                                Save Changes\r\n                            </Button>\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    {user.role === 'KABADIWALA' && (\r\n                        <Card className=\"mt-6\">\r\n                            <CardHeader>\r\n                                <CardTitle>Business Profile</CardTitle>\r\n                                <CardDescription>Manage your business appearance</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent className=\"space-y-4\">\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Cover Photo</Label>\r\n                                    <div className=\"relative w-full h-40 bg-muted rounded-lg overflow-hidden border-2 border-dashed border-muted-foreground/25 flex items-center justify-center group\">\r\n                                        {coverImageUrl ? (\r\n                                            <img src={coverImageUrl} alt=\"Cover\" className=\"w-full h-full object-cover\" />\r\n                                        ) : (\r\n                                            <div className=\"text-center text-muted-foreground p-4\">\r\n                                                <Camera className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\r\n                                                <span className=\"text-sm\">Upload Cover Photo</span>\r\n                                            </div>\r\n                                        )}\r\n                                        <div className=\"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\r\n                                            <Button variant=\"secondary\" size=\"sm\" onClick={() => coverInputRef.current?.click()} disabled={uploading}>\r\n                                                <Camera className=\"h-4 w-4 mr-2\" />\r\n                                                Change Cover\r\n                                            </Button>\r\n                                        </div>\r\n                                        <input\r\n                                            ref={coverInputRef}\r\n                                            type=\"file\"\r\n                                            accept=\"image/*\"\r\n                                            onChange={(e) => handleImageUpload(e, 'cover')}\r\n                                            className=\"hidden\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </CardContent>\r\n                        </Card>\r\n                    )}\r\n                </TabsContent>\r\n\r\n                {/* Security Tab */}\r\n                <TabsContent value=\"security\">\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle>Change Password</CardTitle>\r\n                            <CardDescription>Update your password to keep your account secure</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent className=\"space-y-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"currentPassword\">Current Password</Label>\r\n                                <Input\r\n                                    id=\"currentPassword\"\r\n                                    type=\"password\"\r\n                                    value={currentPassword}\r\n                                    onChange={(e) => setCurrentPassword(e.target.value)}\r\n                                    placeholder=\"Enter current password\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"newPassword\">New Password</Label>\r\n                                <Input\r\n                                    id=\"newPassword\"\r\n                                    type=\"password\"\r\n                                    value={newPassword}\r\n                                    onChange={(e) => setNewPassword(e.target.value)}\r\n                                    placeholder=\"Min 6 characters\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"confirmPassword\">Confirm New Password</Label>\r\n                                <Input\r\n                                    id=\"confirmPassword\"\r\n                                    type=\"password\"\r\n                                    value={confirmPassword}\r\n                                    onChange={(e) => setConfirmPassword(e.target.value)}\r\n                                    placeholder=\"Confirm new password\"\r\n                                />\r\n                            </div>\r\n                            <Button\r\n                                onClick={handleChangePassword}\r\n                                disabled={changingPassword || !currentPassword || !newPassword}\r\n                                className=\"w-full\"\r\n                            >\r\n                                {changingPassword ? (\r\n                                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                                ) : (\r\n                                    <CheckCircle className=\"h-4 w-4 mr-2\" />\r\n                                )}\r\n                                Change Password\r\n                            </Button>\r\n                            <div className=\"pt-4 border-t\">\r\n                                <Link href=\"/reset-password\" className=\"text-sm text-primary hover:underline\">\r\n                                    Forgot your password?\r\n                                </Link>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n\r\n                {/* Notifications Tab */}\r\n                <TabsContent value=\"notifications\">\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle>Notification Settings</CardTitle>\r\n                            <CardDescription>Manage how you receive notifications</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent className=\"space-y-6\">\r\n                            {/* Push Notifications */}\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <div className=\"space-y-0.5\">\r\n                                    <Label>Push Notifications</Label>\r\n                                    <p className=\"text-sm text-muted-foreground\">\r\n                                        Receive notifications on your device\r\n                                    </p>\r\n                                </div>\r\n                                {pushEnabled ? (\r\n                                    <span className=\"text-sm text-green-600 font-medium flex items-center gap-1\">\r\n                                        <CheckCircle className=\"h-4 w-4\" /> Enabled\r\n                                    </span>\r\n                                ) : (\r\n                                    <Button size=\"sm\" onClick={handleEnablePush}>\r\n                                        Enable\r\n                                    </Button>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"border-t pt-4 space-y-4\">\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div className=\"space-y-0.5\">\r\n                                        <Label>Order Updates</Label>\r\n                                        <p className=\"text-sm text-muted-foreground\">\r\n                                            New orders, status changes, completions\r\n                                        </p>\r\n                                    </div>\r\n                                    <Switch\r\n                                        checked={orderNotifications}\r\n                                        onCheckedChange={setOrderNotifications}\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div className=\"space-y-0.5\">\r\n                                        <Label>Messages</Label>\r\n                                        <p className=\"text-sm text-muted-foreground\">\r\n                                            New chat messages from Kabadiwalas\r\n                                        </p>\r\n                                    </div>\r\n                                    <Switch\r\n                                        checked={messageNotifications}\r\n                                        onCheckedChange={setMessageNotifications}\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div className=\"space-y-0.5\">\r\n                                        <Label>Promotions & Offers</Label>\r\n                                        <p className=\"text-sm text-muted-foreground\">\r\n                                            Special deals and rate updates\r\n                                        </p>\r\n                                    </div>\r\n                                    <Switch\r\n                                        checked={promoNotifications}\r\n                                        onCheckedChange={setPromoNotifications}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n\r\n                {/* Settings Tab */}\r\n                <TabsContent value=\"settings\">\r\n                    <div className=\"space-y-6\">\r\n                        <Card>\r\n                            <CardHeader>\r\n                                <CardTitle>Appearance</CardTitle>\r\n                                <CardDescription>Customize your view</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent>\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div className=\"flex items-center space-x-2\">\r\n                                        <Sun className=\"h-4 w-4\" />\r\n                                        <Label htmlFor=\"profile-dark-mode\">Dark Mode</Label>\r\n                                        <Moon className=\"h-4 w-4\" />\r\n                                    </div>\r\n                                    <Switch\r\n                                        id=\"profile-dark-mode\"\r\n                                        checked={theme === 'dark'}\r\n                                        onCheckedChange={(checked) => setTheme(checked ? 'dark' : 'light')}\r\n                                    />\r\n                                </div>\r\n                            </CardContent>\r\n                        </Card>\r\n\r\n                        <Card>\r\n                            <CardHeader>\r\n                                <CardTitle>Account Information</CardTitle>\r\n                            </CardHeader>\r\n                            <CardContent className=\"space-y-3\">\r\n                                <div className=\"flex justify-between\">\r\n                                    <span className=\"text-muted-foreground\">Member Since</span>\r\n                                    <span>{new Date(user.createdAt).toLocaleDateString('en-IN', {\r\n                                        year: 'numeric', month: 'long', day: 'numeric'\r\n                                    })}</span>\r\n                                </div>\r\n                                <div className=\"flex justify-between\">\r\n                                    <span className=\"text-muted-foreground\">Account Type</span>\r\n                                    <span className=\"capitalize\">{user.role.toLowerCase()}</span>\r\n                                </div>\r\n                            </CardContent>\r\n                        </Card>\r\n\r\n                        <Card>\r\n                            <CardHeader>\r\n                                <CardTitle>Quick Links</CardTitle>\r\n                            </CardHeader>\r\n                            <CardContent className=\"space-y-2\">\r\n                                <Link href=\"/privacy-policy\" className=\"block\">\r\n                                    <Button variant=\"ghost\" className=\"w-full justify-start\">\r\n                                        Privacy Policy\r\n                                    </Button>\r\n                                </Link>\r\n                                <Link href=\"/terms-of-service\" className=\"block\">\r\n                                    <Button variant=\"ghost\" className=\"w-full justify-start\">\r\n                                        Terms of Service\r\n                                    </Button>\r\n                                </Link>\r\n                            </CardContent>\r\n                        </Card>\r\n\r\n                        {/* Delete Account */}\r\n                        <Card className=\"border-red-200 dark:border-red-900\">\r\n                            <CardHeader>\r\n                                <CardTitle className=\"text-red-600\">Danger Zone</CardTitle>\r\n                                <CardDescription>\r\n                                    Permanently delete your account and all data\r\n                                </CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent>\r\n                                <AlertDialog>\r\n                                    <AlertDialogTrigger asChild>\r\n                                        <Button variant=\"destructive\" className=\"w-full\">\r\n                                            <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                                            Delete Account\r\n                                        </Button>\r\n                                    </AlertDialogTrigger>\r\n                                    <AlertDialogContent>\r\n                                        <AlertDialogHeader>\r\n                                            <AlertDialogTitle>Delete Account?</AlertDialogTitle>\r\n                                            <AlertDialogDescription>\r\n                                                This action cannot be undone. All your data including orders,\r\n                                                chats, favorites, and profile will be permanently deleted.\r\n                                            </AlertDialogDescription>\r\n                                        </AlertDialogHeader>\r\n                                        <div className=\"space-y-4 py-4\">\r\n                                            <div className=\"space-y-2\">\r\n                                                <Label>Enter your password</Label>\r\n                                                <Input\r\n                                                    type=\"password\"\r\n                                                    value={deletePassword}\r\n                                                    onChange={(e) => setDeletePassword(e.target.value)}\r\n                                                    placeholder=\"Current password\"\r\n                                                />\r\n                                            </div>\r\n                                            <div className=\"space-y-2\">\r\n                                                <Label>Type \"DELETE MY ACCOUNT\" to confirm</Label>\r\n                                                <Input\r\n                                                    value={deleteConfirm}\r\n                                                    onChange={(e) => setDeleteConfirm(e.target.value)}\r\n                                                    placeholder=\"DELETE MY ACCOUNT\"\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                        <AlertDialogFooter>\r\n                                            <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n                                            <Button\r\n                                                variant=\"destructive\"\r\n                                                onClick={handleDeleteAccount}\r\n                                                disabled={deleting || !deletePassword || deleteConfirm !== \"DELETE MY ACCOUNT\"}\r\n                                            >\r\n                                                {deleting && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n                                                Delete Forever\r\n                                            </Button>\r\n                                        </AlertDialogFooter>\r\n                                    </AlertDialogContent>\r\n                                </AlertDialog>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </div>\r\n                </TabsContent>\r\n            </Tabs>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\register\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsContent' is defined but never used.","line":10,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport Link from \"next/link\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Loader2, User, Recycle } from \"lucide-react\"\r\nimport { toast } from \"sonner\"\r\n\r\nexport default function RegisterPage() {\r\n    const router = useRouter()\r\n    const [loading, setLoading] = useState(false)\r\n    const [error, setError] = useState(\"\")\r\n    const [role, setRole] = useState<\"USER\" | \"KABADIWALA\">(\"USER\")\r\n    const [showOtp, setShowOtp] = useState(false)\r\n    const [registeredEmail, setRegisteredEmail] = useState(\"\")\r\n    const [otp, setOtp] = useState(\"\")\r\n\r\n    async function handleSubmit(e: React.FormEvent<HTMLFormElement>) {\r\n        e.preventDefault()\r\n        setLoading(true)\r\n        setError(\"\")\r\n\r\n        const formData = new FormData(e.currentTarget)\r\n        const name = formData.get(\"name\") as string\r\n        const phone = formData.get(\"phone\") as string\r\n        const email = formData.get(\"email\") as string\r\n        const password = formData.get(\"password\") as string\r\n        const businessName = formData.get(\"businessName\") as string\r\n        const serviceArea = formData.get(\"serviceArea\") as string\r\n\r\n        try {\r\n            const res = await fetch(\"/api/auth/register\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ name, phone, email, password, role, businessName, serviceArea }),\r\n            })\r\n\r\n            const data = await res.json()\r\n\r\n            if (res.ok) {\r\n                if (data.requireVerification) {\r\n                    setRegisteredEmail(data.email)\r\n                    setShowOtp(true)\r\n                    toast.success(\"Account created! Please verify your email.\")\r\n                } else {\r\n                    router.push(\"/login\")\r\n                }\r\n            } else {\r\n                setError(data.error || \"Registration failed\")\r\n            }\r\n        } catch {\r\n            setError(\"Something went wrong\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    async function handleVerifyOtp(e: React.FormEvent) {\r\n        e.preventDefault()\r\n        setLoading(true)\r\n        setError(\"\")\r\n\r\n        try {\r\n            const res = await fetch(\"/api/otp\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({\r\n                    action: \"VERIFY\",\r\n                    email: registeredEmail,\r\n                    otp: otp,\r\n                }),\r\n            })\r\n\r\n            const data = await res.json()\r\n\r\n            if (res.ok) {\r\n                toast.success(\"Email Verified! You can now login.\")\r\n                router.push(\"/dashboard\") // Redirecting to Dashboard/Home as requested\r\n                // Note: Assuming /dashboard creates user context or user will be directed correctly.\r\n            } else {\r\n                setError(data.error || \"Verification failed\")\r\n            }\r\n        } catch {\r\n            setError(\"Something went wrong during verification\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    if (showOtp) {\r\n        return (\r\n            <div className=\"min-h-screen flex items-center justify-center bg-muted/30 px-4 py-8\">\r\n                <Card className=\"w-full max-w-md\">\r\n                    <CardHeader className=\"text-center\">\r\n                        <CardTitle className=\"text-2xl\">Verify Email</CardTitle>\r\n                        <CardDescription>Enter the OTP sent to {registeredEmail}</CardDescription>\r\n                    </CardHeader>\r\n                    <form onSubmit={handleVerifyOtp}>\r\n                        <CardContent className=\"space-y-4\">\r\n                            {error && (\r\n                                <div className=\"p-3 text-sm text-red-500 bg-red-50 rounded-lg\">{error}</div>\r\n                            )}\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"otp\">One-Time Password</Label>\r\n                                <Input\r\n                                    id=\"otp\"\r\n                                    value={otp}\r\n                                    onChange={(e) => setOtp(e.target.value)}\r\n                                    placeholder=\"000000\"\r\n                                    maxLength={6}\r\n                                    required\r\n                                    className=\"text-center text-2xl tracking-widest\"\r\n                                />\r\n                            </div>\r\n                        </CardContent>\r\n                        <CardFooter>\r\n                            <Button type=\"submit\" className=\"w-full\" disabled={loading}>\r\n                                {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                                Verify & Login\r\n                            </Button>\r\n                        </CardFooter>\r\n                    </form>\r\n                </Card>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-muted/30 px-4 py-8\">\r\n            <Card className=\"w-full max-w-md\">\r\n                <CardHeader className=\"text-center\">\r\n                    <CardTitle className=\"text-2xl\">Create Account</CardTitle>\r\n                    <CardDescription>Sign up to get started</CardDescription>\r\n                </CardHeader>\r\n                <form onSubmit={handleSubmit}>\r\n                    <CardContent className=\"space-y-4\">\r\n                        {error && (\r\n                            <div className=\"p-3 text-sm text-red-500 bg-red-50 rounded-lg\">{error}</div>\r\n                        )}\r\n\r\n                        <Tabs value={role} onValueChange={(v) => setRole(v as \"USER\" | \"KABADIWALA\")}>\r\n                            <TabsList className=\"grid w-full grid-cols-2\">\r\n                                <TabsTrigger value=\"USER\" className=\"gap-2\">\r\n                                    <User className=\"h-4 w-4\" /> I want to sell scrap\r\n                                </TabsTrigger>\r\n                                <TabsTrigger value=\"KABADIWALA\" className=\"gap-2\">\r\n                                    <Recycle className=\"h-4 w-4\" /> I am a Kabadiwala\r\n                                </TabsTrigger>\r\n                            </TabsList>\r\n                        </Tabs>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"name\">Full Name</Label>\r\n                            <Input id=\"name\" name=\"name\" placeholder=\"Your Name\" required />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"phone\">Phone Number</Label>\r\n                            <Input\r\n                                id=\"phone\"\r\n                                name=\"phone\"\r\n                                type=\"tel\"\r\n                                placeholder=\"9876543210\"\r\n                                required\r\n                                minLength={10}\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"email\">Email</Label>\r\n                            <Input\r\n                                id=\"email\"\r\n                                name=\"email\"\r\n                                type=\"email\"\r\n                                placeholder=\"hello@example.com\"\r\n                                required\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"password\">Password</Label>\r\n                            <Input\r\n                                id=\"password\"\r\n                                name=\"password\"\r\n                                type=\"password\"\r\n                                placeholder=\"Min 6 characters\"\r\n                                required\r\n                                minLength={6}\r\n                            />\r\n                        </div>\r\n\r\n                        {role === \"KABADIWALA\" && (\r\n                            <>\r\n                                <div className=\"space-y-2\">\r\n                                    <Label htmlFor=\"businessName\">Business Name</Label>\r\n                                    <Input\r\n                                        id=\"businessName\"\r\n                                        name=\"businessName\"\r\n                                        placeholder=\"Your shop name\"\r\n                                        required\r\n                                    />\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <Label htmlFor=\"serviceArea\">Service Area</Label>\r\n                                    <Input\r\n                                        id=\"serviceArea\"\r\n                                        name=\"serviceArea\"\r\n                                        placeholder=\"e.g. South Delhi\"\r\n                                        required\r\n                                    />\r\n                                </div>\r\n                            </>\r\n                        )}\r\n                    </CardContent>\r\n                    <CardFooter className=\"flex flex-col gap-4\">\r\n                        <Button type=\"submit\" className=\"w-full\" disabled={loading}>\r\n                            {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                            Create Account\r\n                        </Button>\r\n                        <p className=\"text-sm text-muted-foreground text-center\">\r\n                            Already have an account?{\" \"}\r\n                            <Link href=\"/login\" className=\"text-primary underline\">\r\n                                Login\r\n                            </Link>\r\n                        </p>\r\n                    </CardFooter>\r\n                </form>\r\n            </Card>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\reset-password\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\reviews\\[orderId]\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchOrder'. Either include it or remove the dependency array.","line":40,"column":8,"nodeType":"ArrayExpression","endLine":40,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [fetchOrder, orderId]","fix":{"range":[1310,1319],"text":"[fetchOrder, orderId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { useRouter, useParams } from \"next/navigation\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\"\r\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\"\r\nimport { Star, Loader2, CheckCircle } from \"lucide-react\"\r\nimport { motion } from \"framer-motion\"\r\n\r\ninterface Order {\r\n    id: string\r\n    buyer: {\r\n        name: string\r\n        kabadiwalaProfile: {\r\n            businessName: string\r\n        }\r\n    }\r\n    pickupDate: string\r\n    totalAmount: number\r\n}\r\n\r\nexport default function ReviewPage() {\r\n    const router = useRouter()\r\n    const params = useParams()\r\n    const orderId = params.orderId as string\r\n\r\n    const [loading, setLoading] = useState(true)\r\n    const [submitting, setSubmitting] = useState(false)\r\n    const [submitted, setSubmitted] = useState(false)\r\n    const [order, setOrder] = useState<Order | null>(null)\r\n    const [rating, setRating] = useState(0)\r\n    const [hoverRating, setHoverRating] = useState(0)\r\n    const [comment, setComment] = useState(\"\")\r\n    const [error, setError] = useState(\"\")\r\n\r\n    useEffect(() => {\r\n        fetchOrder()\r\n    }, [orderId])\r\n\r\n    async function fetchOrder() {\r\n        try {\r\n            const res = await fetch(`/api/reviews/${orderId}`)\r\n            if (res.ok) {\r\n                const data = await res.json()\r\n                if (data.existingReview) {\r\n                    setSubmitted(true)\r\n                    setRating(data.existingReview.rating)\r\n                    setComment(data.existingReview.comment || \"\")\r\n                }\r\n                setOrder(data.order)\r\n            } else if (res.status === 400) {\r\n                setError(\"Order is not completed yet\")\r\n            } else {\r\n                router.push(\"/dashboard\")\r\n            }\r\n        } catch {\r\n            router.push(\"/dashboard\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    async function handleSubmit() {\r\n        if (rating === 0) {\r\n            setError(\"Please select a rating\")\r\n            return\r\n        }\r\n\r\n        setSubmitting(true)\r\n        setError(\"\")\r\n\r\n        try {\r\n            const res = await fetch(`/api/reviews/${orderId}`, {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ rating, comment })\r\n            })\r\n\r\n            if (res.ok) {\r\n                setSubmitted(true)\r\n            } else {\r\n                const data = await res.json()\r\n                setError(data.error || \"Failed to submit review\")\r\n            }\r\n        } catch {\r\n            setError(\"Something went wrong\")\r\n        } finally {\r\n            setSubmitting(false)\r\n        }\r\n    }\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-[60vh]\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    if (!order) return null\r\n\r\n    return (\r\n        <div className=\"container mx-auto py-8 px-4 max-w-lg\">\r\n            <motion.div\r\n                initial={{ opacity: 0, y: 20 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                transition={{ duration: 0.5 }}\r\n            >\r\n                {submitted ? (\r\n                    <Card className=\"text-center\">\r\n                        <CardContent className=\"py-12\">\r\n                            <motion.div\r\n                                initial={{ scale: 0 }}\r\n                                animate={{ scale: 1 }}\r\n                                transition={{ type: \"spring\", stiffness: 200 }}\r\n                            >\r\n                                <CheckCircle className=\"h-16 w-16 mx-auto text-green-500 mb-4\" />\r\n                            </motion.div>\r\n                            <h2 className=\"text-2xl font-bold mb-2\">Thank You!</h2>\r\n                            <p className=\"text-muted-foreground mb-6\">\r\n                                Your review helps other users find great Kabadiwalas\r\n                            </p>\r\n                            <div className=\"flex justify-center gap-1 mb-6\">\r\n                                {[1, 2, 3, 4, 5].map((star) => (\r\n                                    <Star\r\n                                        key={star}\r\n                                        className={`h-8 w-8 ${star <= rating ? \"fill-yellow-500 text-yellow-500\" : \"text-gray-300\"\r\n                                            }`}\r\n                                    />\r\n                                ))}\r\n                            </div>\r\n                            <Button onClick={() => router.push(\"/dashboard\")}>Back to Dashboard</Button>\r\n                        </CardContent>\r\n                    </Card>\r\n                ) : (\r\n                    <Card>\r\n                        <CardHeader className=\"text-center\">\r\n                            <CardTitle>Rate Your Experience</CardTitle>\r\n                            <CardDescription>How was your pickup with {order.buyer.kabadiwalaProfile.businessName}?</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent className=\"space-y-6\">\r\n                            {/* Kabadiwala Info */}\r\n                            <div className=\"flex items-center gap-4 p-4 bg-muted/50 rounded-lg\">\r\n                                <Avatar className=\"h-12 w-12\">\r\n                                    <AvatarFallback>{order.buyer.kabadiwalaProfile.businessName[0]}</AvatarFallback>\r\n                                </Avatar>\r\n                                <div>\r\n                                    <p className=\"font-semibold\">{order.buyer.kabadiwalaProfile.businessName}</p>\r\n                                    <p className=\"text-sm text-muted-foreground\">\r\n                                        {order.pickupDate && new Date(order.pickupDate).toLocaleDateString()}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Star Rating */}\r\n                            <div className=\"text-center\">\r\n                                <p className=\"text-sm text-muted-foreground mb-3\">Tap to rate</p>\r\n                                <div className=\"flex justify-center gap-2\">\r\n                                    {[1, 2, 3, 4, 5].map((star) => (\r\n                                        <motion.button\r\n                                            key={star}\r\n                                            whileHover={{ scale: 1.1 }}\r\n                                            whileTap={{ scale: 0.95 }}\r\n                                            onMouseEnter={() => setHoverRating(star)}\r\n                                            onMouseLeave={() => setHoverRating(0)}\r\n                                            onClick={() => setRating(star)}\r\n                                            className=\"p-1\"\r\n                                        >\r\n                                            <Star\r\n                                                className={`h-10 w-10 transition-colors ${star <= (hoverRating || rating)\r\n                                                        ? \"fill-yellow-500 text-yellow-500\"\r\n                                                        : \"text-gray-300\"\r\n                                                    }`}\r\n                                            />\r\n                                        </motion.button>\r\n                                    ))}\r\n                                </div>\r\n                                <p className=\"text-sm mt-2\">\r\n                                    {rating === 1 && \"Poor\"}\r\n                                    {rating === 2 && \"Fair\"}\r\n                                    {rating === 3 && \"Good\"}\r\n                                    {rating === 4 && \"Very Good\"}\r\n                                    {rating === 5 && \"Excellent!\"}\r\n                                </p>\r\n                            </div>\r\n\r\n                            {/* Comment */}\r\n                            <div>\r\n                                <Textarea\r\n                                    placeholder=\"Share your experience (optional)...\"\r\n                                    value={comment}\r\n                                    onChange={(e) => setComment(e.target.value)}\r\n                                    rows={4}\r\n                                />\r\n                            </div>\r\n\r\n                            {error && (\r\n                                <p className=\"text-sm text-red-500 text-center\">{error}</p>\r\n                            )}\r\n\r\n                            <Button\r\n                                onClick={handleSubmit}\r\n                                disabled={submitting || rating === 0}\r\n                                className=\"w-full\"\r\n                                size=\"lg\"\r\n                            >\r\n                                {submitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                                Submit Review\r\n                            </Button>\r\n                        </CardContent>\r\n                    </Card>\r\n                )}\r\n            </motion.div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\rewards\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used.","line":7,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":42},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":175,"column":136,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[7525,7544],"text":" points to redeem &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[7525,7544],"text":" points to redeem &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[7525,7544],"text":" points to redeem &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[7525,7544],"text":" points to redeem &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":175,"column":151,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[7558,7618],"text":"&quot;?\r\n                                                        "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[7558,7618],"text":"&ldquo;?\r\n                                                        "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[7558,7618],"text":"&#34;?\r\n                                                        "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[7558,7618],"text":"&rdquo;?\r\n                                                        "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Loader2, Gift, Lock, CheckCircle, AlertCircle } from \"lucide-react\"\r\nimport { toast } from \"sonner\"\r\nimport { getRewards, redeemReward } from \"@/actions/gamification\"\r\nimport { Progress } from \"@/components/ui/progress\"\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n    AlertDialogTrigger,\r\n} from \"@/components/ui/alert-dialog\"\r\n\r\ninterface Reward {\r\n    id: string\r\n    title: string\r\n    description: string\r\n    cost: number\r\n    isActive: boolean\r\n}\r\n\r\ninterface UserData {\r\n    id: string\r\n    name: string | null\r\n    points: number\r\n}\r\n\r\nexport default function RewardsPage() {\r\n    const router = useRouter()\r\n    const [loading, setLoading] = useState(true)\r\n    const [points, setPoints] = useState(0)\r\n    const [rewards, setRewards] = useState<Reward[]>([])\r\n    const [redeeming, setRedeeming] = useState(false)\r\n    const [user, setUser] = useState<UserData | null>(null)\r\n\r\n    useEffect(() => {\r\n        fetchData()\r\n    }, [])\r\n\r\n    const fetchData = async () => {\r\n        try {\r\n            // Fetch rewards for everyone\r\n            const availableRewards = await getRewards()\r\n            setRewards(availableRewards)\r\n\r\n            // Fetch user data via API (cookie-based auth)\r\n            const res = await fetch(\"/api/profile\")\r\n            if (res.ok) {\r\n                const userData = await res.json()\r\n                setUser(userData)\r\n                setPoints(userData.points || 0)\r\n            } else {\r\n                setUser(null)\r\n                setPoints(0)\r\n            }\r\n        } catch (error) {\r\n            console.error(error)\r\n            toast.error(\"Failed to load rewards\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    const handleRedeem = async (rewardId: string) => {\r\n        if (!user) {\r\n            toast.error(\"Please login to redeem rewards\")\r\n            router.push(\"/login\")\r\n            return\r\n        }\r\n\r\n        setRedeeming(true)\r\n        try {\r\n            const result = await redeemReward(user.id, rewardId)\r\n            if (result.success) {\r\n                toast.success(result.message)\r\n                fetchData() // Refresh points\r\n            } else {\r\n                toast.error(result.error)\r\n            }\r\n        } catch (error) {\r\n            toast.error(\"Redemption failed\")\r\n            console.error(error)\r\n        } finally {\r\n            setRedeeming(false)\r\n        }\r\n    }\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex justify-center items-center min-h-[60vh]\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    // Render content for both guests and users\r\n    return (\r\n        <div className=\"container mx-auto py-8 px-4 max-w-4xl\">\r\n            <div className=\"mb-8 text-center bg-gradient-to-r from-green-600 to-emerald-600 text-white p-8 rounded-2xl shadow-xl\">\r\n                <h1 className=\"text-3xl font-bold mb-2\">My Green Wallet</h1>\r\n                <div className=\"text-6xl font-black mb-2\">{points.toLocaleString()}</div>\r\n                <p className=\"text-green-100\">Green Points Available</p>\r\n                {!user && (\r\n                    <div className=\"mt-4\">\r\n                        <Button variant=\"secondary\" size=\"sm\" onClick={() => router.push(\"/login\")}>\r\n                            Login to see your points\r\n                        </Button>\r\n                    </div>\r\n                )}\r\n                <div className=\"mt-6 flex justify-center\">\r\n                    <div className=\"bg-white/20 backdrop-blur-sm rounded-full px-6 py-2 text-sm font-medium\">\r\n                        Keep cleaning the planet to earn more!\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <h2 className=\"text-2xl font-bold mb-6 flex items-center gap-2\">\r\n                <Gift className=\"h-6 w-6 text-primary\" />\r\n                Available Rewards\r\n            </h2>\r\n\r\n            <div className=\"grid md:grid-cols-2 gap-6\">\r\n                {rewards.map((reward) => {\r\n                    const progress = Math.min((points / reward.cost) * 100, 100)\r\n                    const isUnlockable = points >= reward.cost\r\n\r\n                    return (\r\n                        <Card key={reward.id} className={`relative overflow-hidden transition-all ${isUnlockable ? 'border-green-500 shadow-lg' : 'opacity-90'}`}>\r\n                            {isUnlockable && (\r\n                                <div className=\"absolute top-0 right-0 bg-green-500 text-white text-xs px-3 py-1 rounded-bl-lg font-bold\">\r\n                                    UNLOCKED\r\n                                </div>\r\n                            )}\r\n                            <CardHeader>\r\n                                <CardTitle className=\"flex justify-between items-start\">\r\n                                    <span>{reward.title}</span>\r\n                                </CardTitle>\r\n                                <CardDescription className=\"text-base mt-2\">\r\n                                    {reward.description}\r\n                                </CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent>\r\n                                <div className=\"space-y-4\">\r\n                                    <div className=\"flex justify-between items-end\">\r\n                                        <div className=\"text-2xl font-bold text-primary\">\r\n                                            {reward.cost.toLocaleString()} <span className=\"text-sm font-normal text-muted-foreground\">pts</span>\r\n                                        </div>\r\n                                        <div className=\"text-sm font-medium\">\r\n                                            {Math.round(progress)}%\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <Progress value={progress} className={`h-3 ${isUnlockable ? 'bg-green-100' : 'bg-gray-100'}`} />\r\n\r\n                                    {isUnlockable ? (\r\n                                        <AlertDialog>\r\n                                            <AlertDialogTrigger asChild>\r\n                                                <Button className=\"w-full bg-green-600 hover:bg-green-700 text-white\" disabled={redeeming}>\r\n                                                    {redeeming ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <Gift className=\"h-4 w-4 mr-2\" />}\r\n                                                    Redeem Now\r\n                                                </Button>\r\n                                            </AlertDialogTrigger>\r\n                                            <AlertDialogContent>\r\n                                                <AlertDialogHeader>\r\n                                                    <AlertDialogTitle>Confirm Redemption</AlertDialogTitle>\r\n                                                    <AlertDialogDescription>\r\n                                                        Are you sure you want to spend {reward.cost.toLocaleString()} points to redeem \"{reward.title}\"?\r\n                                                        <br /><br />\r\n                                                        <strong>Note:</strong> Our team will contact you within 24 hours to schedule your service.\r\n                                                    </AlertDialogDescription>\r\n                                                </AlertDialogHeader>\r\n                                                <AlertDialogFooter>\r\n                                                    <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n                                                    <Button onClick={() => handleRedeem(reward.id)} className=\"bg-green-600 hover:bg-green-700\">\r\n                                                        Yes, Redeem It\r\n                                                    </Button>\r\n                                                </AlertDialogFooter>\r\n                                            </AlertDialogContent>\r\n                                        </AlertDialog>\r\n                                    ) : (\r\n                                        <Button variant=\"secondary\" className=\"w-full\" disabled>\r\n                                            <Lock className=\"h-4 w-4 mr-2\" />\r\n                                            {reward.cost - points} points needed\r\n                                        </Button>\r\n                                    )}\r\n                                </div>\r\n                            </CardContent>\r\n                        </Card>\r\n                    )\r\n                })}\r\n\r\n                {rewards.length === 0 && (\r\n                    <div className=\"col-span-full text-center py-12 text-muted-foreground\">\r\n                        <AlertCircle className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n                        <p>No rewards configured yet.</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\robots.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\settings\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Maximize2' is defined but never used.","line":11,"column":76,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":85},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used.","line":11,"column":87,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":93},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nE:\\edrivekabadi\\kabadiwala\\src\\app\\settings\\page.tsx:25:9\n  23 |     // Ensure hydration match\n  24 |     useEffect(() => {\n> 25 |         setMounted(true)\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  26 |     }, [])\n  27 |\n  28 |     const handleSave = () => {","line":25,"column":9,"nodeType":null,"endLine":25,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle, CardFooter } from \"@/components/ui/card\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Switch } from \"@/components/ui/switch\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Bell, Lock, Moon, Sun, User, Shield, LogOut, ChevronRight, Globe, Maximize2, Trash2, Database } from \"lucide-react\"\r\nimport { toast } from \"sonner\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { useTheme } from \"next-themes\"\r\n\r\nexport default function SettingsPage() {\r\n    const router = useRouter()\r\n    const { theme, setTheme } = useTheme()\r\n    const [emailNotifs, setEmailNotifs] = useState(true)\r\n    const [pushNotifs, setPushNotifs] = useState(true)\r\n    const [mounted, setMounted] = useState(false)\r\n\r\n    // Ensure hydration match\r\n    useEffect(() => {\r\n        setMounted(true)\r\n    }, [])\r\n\r\n    const handleSave = () => {\r\n        toast.success(\"Settings saved successfully\")\r\n    }\r\n\r\n    const handleLogout = async () => {\r\n        // Assuming there is a logout API or next-auth signOut\r\n        // For now, redirecting to login which might handle cleanup or usage of signOut from next-auth/react\r\n        // ideally use signOut() from next-auth/react\r\n        window.location.href = \"/api/auth/signout\"\r\n    }\r\n\r\n    if (!mounted) {\r\n        return <div className=\"p-8\">Loading settings...</div>\r\n    }\r\n\r\n    return (\r\n        <div className=\"container mx-auto py-8 px-4 max-w-4xl\">\r\n            <h1 className=\"text-3xl font-bold mb-6\">Settings</h1>\r\n\r\n            <Tabs defaultValue=\"general\" className=\"w-full\">\r\n                <TabsList className=\"grid w-full grid-cols-3 mb-8\">\r\n                    <TabsTrigger value=\"general\" className=\"gap-2\">\r\n                        <User className=\"h-4 w-4\" />\r\n                        <span className=\"hidden sm:inline\">General</span>\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"notifications\" className=\"gap-2\">\r\n                        <Bell className=\"h-4 w-4\" />\r\n                        <span className=\"hidden sm:inline\">Notifications</span>\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"security\" className=\"gap-2\">\r\n                        <Lock className=\"h-4 w-4\" />\r\n                        <span className=\"hidden sm:inline\">Security</span>\r\n                    </TabsTrigger>\r\n                </TabsList>\r\n\r\n                {/* General Settings */}\r\n                <TabsContent value=\"general\">\r\n                    <div className=\"grid gap-6\">\r\n                        <Card>\r\n                            <CardHeader>\r\n                                <CardTitle>Appearance & Language</CardTitle>\r\n                                <CardDescription>Customize how the app looks and feels of your experience.</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent className=\"space-y-4\">\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div className=\"flex items-center space-x-2\">\r\n                                        <Sun className=\"h-4 w-4\" />\r\n                                        <Label htmlFor=\"dark-mode\">Dark Mode</Label>\r\n                                        <Moon className=\"h-4 w-4\" />\r\n                                    </div>\r\n                                    <Switch\r\n                                        id=\"dark-mode\"\r\n                                        checked={theme === 'dark'}\r\n                                        onCheckedChange={(checked) => setTheme(checked ? 'dark' : 'light')}\r\n                                    />\r\n                                </div>\r\n                                <div className=\"flex items-center justify-between border-t pt-4\">\r\n                                    <div className=\"flex items-center space-x-2\">\r\n                                        <Globe className=\"h-4 w-4\" />\r\n                                        <Label>Language / </Label>\r\n                                    </div>\r\n                                    <Select defaultValue=\"en\">\r\n                                        <SelectTrigger className=\"w-[140px]\">\r\n                                            <SelectValue placeholder=\"Language\" />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            <SelectItem value=\"en\">English</SelectItem>\r\n                                            <SelectItem value=\"hi\"> (Hindi)</SelectItem>\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                            </CardContent>\r\n                        </Card>\r\n\r\n                        <Card>\r\n                            <CardHeader>\r\n                                <CardTitle>Data Management</CardTitle>\r\n                                <CardDescription>Manage your local app data and cache.</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent className=\"space-y-4\">\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div className=\"flex items-center space-x-2\">\r\n                                        <Database className=\"h-4 w-4\" />\r\n                                        <Label>Clear App Cache</Label>\r\n                                    </div>\r\n                                    <Button variant=\"outline\" size=\"sm\" onClick={() => {\r\n                                        localStorage.clear()\r\n                                        sessionStorage.clear()\r\n                                        toast.success(\"Cache cleared successfully\")\r\n                                        window.location.reload()\r\n                                    }}>\r\n                                        Clear Data\r\n                                    </Button>\r\n                                </div>\r\n                            </CardContent>\r\n                        </Card>\r\n\r\n                        <Card>\r\n                            <CardHeader>\r\n                                <CardTitle>Profile Settings</CardTitle>\r\n                                <CardDescription>Manage your public profile information.</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent className=\"space-y-4\">\r\n                                <Button variant=\"outline\" className=\"w-full justify-between\" onClick={() => router.push(\"/profile\")}>\r\n                                    <span className=\"flex items-center\"><User className=\"mr-2 h-4 w-4\" /> Edit Profile</span>\r\n                                    <ChevronRight className=\"h-4 w-4\" />\r\n                                </Button>\r\n                                {/* Only show if user might be Kabadiwala, or just show for upselling */}\r\n                                <Button variant=\"outline\" className=\"w-full justify-between\" onClick={() => router.push(\"/kabadiwala/profile\")}>\r\n                                    <span className=\"flex items-center\"><Shield className=\"mr-2 h-4 w-4\" /> Kabadiwala Profile</span>\r\n                                    <ChevronRight className=\"h-4 w-4\" />\r\n                                </Button>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </div>\r\n                </TabsContent>\r\n\r\n                {/* Notification Settings */}\r\n                <TabsContent value=\"notifications\">\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle>Notifications</CardTitle>\r\n                            <CardDescription>Choose what you want to be notified about.</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent className=\"space-y-4\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <Label htmlFor=\"email-notifs\">Email Notifications</Label>\r\n                                <Switch id=\"email-notifs\" checked={emailNotifs} onCheckedChange={setEmailNotifs} />\r\n                            </div>\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <Label htmlFor=\"push-notifs\">Push Notifications</Label>\r\n                                <Switch id=\"push-notifs\" checked={pushNotifs} onCheckedChange={setPushNotifs} />\r\n                            </div>\r\n                        </CardContent>\r\n                        <CardFooter>\r\n                            <Button onClick={handleSave}>Save Preferences</Button>\r\n                        </CardFooter>\r\n                    </Card>\r\n                </TabsContent>\r\n\r\n                {/* Security Settings */}\r\n                <TabsContent value=\"security\">\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle>Security</CardTitle>\r\n                            <CardDescription>Manage your password and account security.</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent className=\"space-y-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <Label>Change Password</Label>\r\n                                <Input type=\"password\" placeholder=\"Current Password\" />\r\n                                <Input type=\"password\" placeholder=\"New Password\" />\r\n                                <Input type=\"password\" placeholder=\"Confirm New Password\" />\r\n                            </div>\r\n                            <Button onClick={handleSave}>Update Password</Button>\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card className=\"mt-6 border-red-200 dark:border-red-900\">\r\n                        <CardHeader>\r\n                            <CardTitle className=\"text-red-600\">Danger Zone</CardTitle>\r\n                            <CardDescription>Irreversible account actions.</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            <Button variant=\"destructive\" className=\"w-full\">Delete Account</Button>\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n            </Tabs>\r\n\r\n            <div className=\"mt-8\">\r\n                <Button variant=\"ghost\" className=\"text-red-500 w-full\" onClick={handleLogout}>\r\n                    <LogOut className=\"mr-2 h-4 w-4\" /> Log Out\r\n                </Button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\sitemap.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\terms-of-service\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\verify-otp\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\app\\verify\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setType' is assigned a value but never used.","line":20,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, Suspense } from \"react\"\r\nimport { useSearchParams, useRouter } from \"next/navigation\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Loader2 } from \"lucide-react\"\r\nimport { toast } from \"sonner\"\r\n\r\nfunction VerifyContent() {\r\n    const searchParams = useSearchParams()\r\n    const router = useRouter()\r\n\r\n    // Get identifier from URL (e.g. ?phone=987...)\r\n    const phone = searchParams.get(\"phone\")\r\n    const email = searchParams.get(\"email\")\r\n\r\n    const [identifier, setIdentifier] = useState(phone || email || \"\")\r\n    const [type, setType] = useState(phone ? \"PHONE\" : \"EMAIL\")\r\n    const [otp, setOtp] = useState(\"\")\r\n    const [loading, setLoading] = useState(false)\r\n    const [step, setStep] = useState<\"SEND\" | \"VERIFY\">(\"SEND\")\r\n\r\n    async function handleSend() {\r\n        setLoading(true)\r\n        try {\r\n            const res = await fetch(\"/api/auth/verify\", {\r\n                method: \"POST\",\r\n                body: JSON.stringify({ action: \"SEND\", identifier, type })\r\n            })\r\n            const data = await res.json()\r\n            if (res.ok) {\r\n                toast.success(\"Verification code sent!\")\r\n                setStep(\"VERIFY\")\r\n            } else {\r\n                toast.error(data.error)\r\n            }\r\n        } catch {\r\n            toast.error(\"Failed to send code\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    async function handleVerify() {\r\n        setLoading(true)\r\n        try {\r\n            const res = await fetch(\"/api/auth/verify\", {\r\n                method: \"POST\",\r\n                body: JSON.stringify({ action: \"VERIFY\", identifier, type, token: otp })\r\n            })\r\n            const data = await res.json()\r\n            if (res.ok) {\r\n                toast.success(\"Verified successfully!\")\r\n                router.push(\"/dashboard\") // Redirect to dashboard\r\n            } else {\r\n                toast.error(data.error)\r\n            }\r\n        } catch {\r\n            toast.error(\"Verification failed\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"container max-w-md mx-auto py-20 px-4\">\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle>Verify your {type === \"PHONE\" ? \"Phone\" : \"Email\"}</CardTitle>\r\n                    <CardDescription>\r\n                        {step === \"SEND\"\r\n                            ? `We need to verify your ${type.toLowerCase()} to activate your account.`\r\n                            : `Enter the code sent to ${identifier}`\r\n                        }\r\n                    </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    {step === \"SEND\" ? (\r\n                        <>\r\n                            <Input\r\n                                value={identifier}\r\n                                onChange={(e) => setIdentifier(e.target.value)}\r\n                                placeholder={type === \"PHONE\" ? \"Enter Phone\" : \"Enter Email\"}\r\n                                disabled={!!(phone || email)} // Disable if passed from URL\r\n                            />\r\n                            <Button onClick={handleSend} className=\"w-full\" disabled={loading}>\r\n                                {loading ? <Loader2 className=\"animate-spin mr-2\" /> : null}\r\n                                Send Code\r\n                            </Button>\r\n                        </>\r\n                    ) : (\r\n                        <>\r\n                            <Input\r\n                                value={otp}\r\n                                onChange={(e) => setOtp(e.target.value)}\r\n                                placeholder=\"Enter 6-digit code\"\r\n                                maxLength={6}\r\n                                className=\"text-center text-lg tracking-widest\"\r\n                            />\r\n                            <Button onClick={handleVerify} className=\"w-full\" disabled={loading}>\r\n                                {loading ? <Loader2 className=\"animate-spin mr-2\" /> : null}\r\n                                Verify\r\n                            </Button>\r\n                            <Button variant=\"ghost\" className=\"w-full\" onClick={() => setStep(\"SEND\")}>\r\n                                Resend or Change Number\r\n                            </Button>\r\n                        </>\r\n                    )}\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default function VerifyPage() {\r\n    return (\r\n        <Suspense fallback={\r\n            <div className=\"container max-w-md mx-auto py-20 px-4\">\r\n                <Card>\r\n                    <CardContent className=\"p-8 flex justify-center\">\r\n                        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n        }>\r\n            <VerifyContent />\r\n        </Suspense>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\auth.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\chat\\QuickChatSheet.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":3,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":10,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Check' is defined but never used.","line":10,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":48},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnimatePresence' is defined but never used.","line":11,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userName' is defined but never used.","line":34,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect, useRef, useCallback } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Sheet, SheetContent, SheetHeader, SheetTitle, SheetTrigger } from \"@/components/ui/sheet\"\r\nimport { Send, Loader2, MessageCircle, X, Check, CheckCheck } from \"lucide-react\"\r\nimport { motion, AnimatePresence } from \"framer-motion\"\r\nimport { toast } from \"sonner\"\r\n\r\ninterface QuickChatSheetProps {\r\n    otherUserId: string\r\n    businessName: string\r\n    userName: string\r\n    userImage?: string | null\r\n    isVerified: boolean\r\n    trigger?: React.ReactNode\r\n}\r\n\r\ninterface Message {\r\n    id: string\r\n    senderId: string\r\n    content: string\r\n    createdAt: string\r\n    isRead: boolean\r\n}\r\n\r\nexport function QuickChatSheet({\r\n    otherUserId,\r\n    businessName,\r\n    userName,\r\n    userImage,\r\n    isVerified,\r\n    trigger\r\n}: QuickChatSheetProps) {\r\n    const router = useRouter()\r\n    const [isOpen, setIsOpen] = useState(false)\r\n    const [messages, setMessages] = useState<Message[]>([])\r\n    const [newMessage, setNewMessage] = useState(\"\")\r\n    const [loading, setLoading] = useState(true)\r\n    const [sending, setSending] = useState(false)\r\n    const [currentUserId, setCurrentUserId] = useState<string | null>(null)\r\n    const messagesEndRef = useRef<HTMLDivElement>(null)\r\n\r\n    // Poll for messages when open\r\n    useEffect(() => {\r\n        if (!isOpen) return\r\n\r\n        const fetchMessages = async () => {\r\n            try {\r\n                const res = await fetch(`/api/chat/${otherUserId}`)\r\n                if (res.ok) {\r\n                    const data = await res.json()\r\n                    setMessages(data.messages || [])\r\n                    setCurrentUserId(data.userId)\r\n                } else if (res.status === 401) {\r\n                    toast.error(\"Please login to chat\")\r\n                    router.push(\"/login\")\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch messages\", error)\r\n            } finally {\r\n                setLoading(false)\r\n            }\r\n        }\r\n\r\n        fetchMessages()\r\n        const interval = setInterval(fetchMessages, 3000)\r\n        return () => clearInterval(interval)\r\n    }, [isOpen, otherUserId, router])\r\n\r\n    // Scroll to bottom\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" })\r\n        }\r\n    }, [messages, isOpen])\r\n\r\n    const handleSend = async (e?: React.FormEvent) => {\r\n        e?.preventDefault()\r\n        if (!newMessage.trim()) return\r\n\r\n        const tempMsg = {\r\n            id: `temp-${Date.now()}`,\r\n            senderId: currentUserId || \"me\",\r\n            content: newMessage,\r\n            createdAt: new Date().toISOString(),\r\n            isRead: false\r\n        }\r\n\r\n        setMessages(prev => [...prev, tempMsg])\r\n        setNewMessage(\"\")\r\n        setSending(true)\r\n\r\n        try {\r\n            const res = await fetch(`/api/chat/${otherUserId}`, {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ content: tempMsg.content })\r\n            })\r\n\r\n            if (!res.ok) throw new Error(\"Failed to send\")\r\n\r\n            // Refresh messages immediately\r\n            const fetchRes = await fetch(`/api/chat/${otherUserId}`)\r\n            if (fetchRes.ok) {\r\n                const data = await fetchRes.json()\r\n                setMessages(data.messages || [])\r\n            }\r\n        } catch {\r\n            toast.error(\"Failed to send message\")\r\n            setMessages(prev => prev.filter(m => m.id !== tempMsg.id))\r\n        } finally {\r\n            setSending(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <Sheet open={isOpen} onOpenChange={setIsOpen}>\r\n            <SheetTrigger asChild>\r\n                {trigger || (\r\n                    <Button variant=\"outline\" className=\"w-full\">\r\n                        <MessageCircle className=\"mr-2 h-4 w-4\" /> Chat\r\n                    </Button>\r\n                )}\r\n            </SheetTrigger>\r\n            <SheetContent side=\"right\" className=\"w-[100%] sm:w-[400px] p-0 flex flex-col h-full\">\r\n                <SheetHeader className=\"p-4 border-b bg-muted/20\">\r\n                    <SheetTitle className=\"sr-only\">Chat with {businessName}</SheetTitle>\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <Avatar className=\"h-10 w-10 border\">\r\n                            <AvatarImage src={userImage || undefined} />\r\n                            <AvatarFallback>{businessName[0]}</AvatarFallback>\r\n                        </Avatar>\r\n                        <div>\r\n                            <p className=\"font-semibold flex items-center gap-1\">\r\n                                {businessName}\r\n                                {isVerified && <CheckCheck className=\"h-3 w-3 text-blue-500\" />}\r\n                            </p>\r\n                            <p className=\"text-xs text-muted-foreground flex items-center gap-1\">\r\n                                <span className=\"relative flex h-2 w-2\">\r\n                                    <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75\"></span>\r\n                                    <span className=\"relative inline-flex rounded-full h-2 w-2 bg-green-500\"></span>\r\n                                </span>\r\n                                Online Now\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </SheetHeader>\r\n\r\n                {/* Messages Area */}\r\n                <div className=\"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50 dark:bg-slate-900/50\">\r\n                    {loading ? (\r\n                        <div className=\"flex justify-center py-10\">\r\n                            <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\r\n                        </div>\r\n                    ) : messages.length === 0 ? (\r\n                        <div className=\"text-center py-20 text-muted-foreground\">\r\n                            <MessageCircle className=\"h-12 w-12 mx-auto mb-2 opacity-20\" />\r\n                            <p>Start a conversation with {businessName}</p>\r\n                            <p className=\"text-xs\">Ask about rates or pickup times</p>\r\n                        </div>\r\n                    ) : (\r\n                        messages.map((msg) => {\r\n                            const isMe = msg.senderId === currentUserId\r\n                            return (\r\n                                <motion.div\r\n                                    key={msg.id}\r\n                                    initial={{ opacity: 0, y: 10 }}\r\n                                    animate={{ opacity: 1, y: 0 }}\r\n                                    className={`flex ${isMe ? 'justify-end' : 'justify-start'}`}\r\n                                >\r\n                                    <div\r\n                                        className={`max-w-[80%] p-3 rounded-2xl text-sm ${isMe\r\n                                                ? 'bg-primary text-primary-foreground rounded-br-none'\r\n                                                : 'bg-white dark:bg-slate-800 border rounded-bl-none'\r\n                                            }`}\r\n                                    >\r\n                                        <p>{msg.content}</p>\r\n                                        <p className={`text-[10px] mt-1 text-right ${isMe ? 'text-primary-foreground/70' : 'text-muted-foreground'}`}>\r\n                                            {new Date(msg.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                        </p>\r\n                                    </div>\r\n                                </motion.div>\r\n                            )\r\n                        })\r\n                    )}\r\n                    <div ref={messagesEndRef} />\r\n                </div>\r\n\r\n                {/* Input Area */}\r\n                <div className=\"p-4 border-t bg-background\">\r\n                    <form onSubmit={handleSend} className=\"flex gap-2\">\r\n                        <Input\r\n                            value={newMessage}\r\n                            onChange={(e) => setNewMessage(e.target.value)}\r\n                            placeholder=\"Type a message...\"\r\n                            className=\"flex-1\"\r\n                            disabled={sending}\r\n                        />\r\n                        <Button type=\"submit\" size=\"icon\" disabled={!newMessage.trim() || sending}>\r\n                            {sending ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <Send className=\"h-4 w-4\" />}\r\n                        </Button>\r\n                    </form>\r\n                </div>\r\n            </SheetContent>\r\n        </Sheet>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\dashboard\\BusinessStatus.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Label' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Switch } from \"@/components/ui/switch\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { toast } from \"sonner\"\r\nimport { Power, Circle } from \"lucide-react\"\r\n\r\ninterface BusinessStatusProps {\r\n    isAvailable: boolean\r\n}\r\n\r\nexport function BusinessStatus({ isAvailable: initialStatus }: BusinessStatusProps) {\r\n    const [isAvailable, setIsAvailable] = useState(initialStatus)\r\n    const [loading, setLoading] = useState(false)\r\n\r\n    const toggleStatus = async (checked: boolean) => {\r\n        setIsAvailable(checked)\r\n        setLoading(true)\r\n        try {\r\n            const res = await fetch(\"/api/kabadiwala/status\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ isAvailable: checked })\r\n            })\r\n\r\n            if (res.ok) {\r\n                toast.success(checked ? \"You are now Online\" : \"You are now Offline\")\r\n            } else {\r\n                toast.error(\"Failed to update status\")\r\n                setIsAvailable(!checked) // Revert\r\n            }\r\n        } catch {\r\n            toast.error(\"Network error\")\r\n            setIsAvailable(!checked) // Revert\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex items-center gap-4 bg-white dark:bg-card p-2 pr-4 rounded-full border shadow-sm\">\r\n            <div className={`p-2 rounded-full ${isAvailable ? \"bg-green-100 dark:bg-green-900/20\" : \"bg-gray-100 dark:bg-gray-800\"}`}>\r\n                <Power className={`h-4 w-4 ${isAvailable ? \"text-green-600\" : \"text-gray-500\"}`} />\r\n            </div>\r\n            <div className=\"flex flex-col\">\r\n                <span className=\"text-xs font-medium text-muted-foreground uppercase tracking-wider\">Status</span>\r\n                <span className={`text-sm font-bold flex items-center gap-1.5 ${isAvailable ? \"text-green-600\" : \"text-gray-500\"}`}>\r\n                    <Circle className={`h-2 w-2 fill-current ${isAvailable ? \"animate-pulse\" : \"\"}`} />\r\n                    {isAvailable ? \"Online\" : \"Offline\"}\r\n                </span>\r\n            </div>\r\n            <Switch\r\n                checked={isAvailable}\r\n                onCheckedChange={toggleStatus}\r\n                disabled={loading}\r\n                className=\"ml-2 data-[state=checked]:bg-green-600\"\r\n            />\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\dashboard\\DealerEarningsChart.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'variant' is defined but never used.","line":83,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":83,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3932,3935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3932,3935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\"\r\nimport { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from \"recharts\"\r\nimport { TrendingUp, IndianRupee } from \"lucide-react\"\r\n\r\nconst DATA = [\r\n    { name: \"Mon\", income: 1200 },\r\n    { name: \"Tue\", income: 2100 },\r\n    { name: \"Wed\", income: 800 },\r\n    { name: \"Thu\", income: 1600 },\r\n    { name: \"Fri\", income: 2400 },\r\n    { name: \"Sat\", income: 3200 },\r\n    { name: \"Sun\", income: 2800 },\r\n]\r\n\r\nexport function DealerEarningsChart() {\r\n    return (\r\n        <Card className=\"h-full border-none shadow-sm bg-white dark:bg-card\">\r\n            <CardHeader>\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                        <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                            <TrendingUp className=\"h-5 w-5 text-green-600\" />\r\n                            Weekly Income\r\n                        </CardTitle>\r\n                        <CardDescription>Your collection revenue</CardDescription>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                        <p className=\"text-2xl font-bold flex items-center justify-end text-green-600\">\r\n                            <IndianRupee className=\"h-5 w-5\" /> 14,100\r\n                        </p>\r\n                        <Badge variant=\"outline\" className=\"text-green-600 bg-green-50 border-green-200\">\r\n                            +12.5% vs last week\r\n                        </Badge>\r\n                    </div>\r\n                </div>\r\n            </CardHeader>\r\n            <CardContent className=\"pl-0\">\r\n                <div className=\"h-[200px] w-full\">\r\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                        <AreaChart data={DATA}>\r\n                            <defs>\r\n                                <linearGradient id=\"colorIncome\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                    <stop offset=\"5%\" stopColor=\"#16a34a\" stopOpacity={0.2} />\r\n                                    <stop offset=\"95%\" stopColor=\"#16a34a\" stopOpacity={0} />\r\n                                </linearGradient>\r\n                            </defs>\r\n                            <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#f0f0f0\" />\r\n                            <XAxis\r\n                                dataKey=\"name\"\r\n                                axisLine={false}\r\n                                tickLine={false}\r\n                                tick={{ fontSize: 12, fill: '#888' }}\r\n                                dy={10}\r\n                            />\r\n                            <YAxis\r\n                                axisLine={false}\r\n                                tickLine={false}\r\n                                tick={{ fontSize: 12, fill: '#888' }}\r\n                                tickFormatter={(val) => `${val}`}\r\n                            />\r\n                            <Tooltip\r\n                                contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)' }}\r\n                                cursor={{ stroke: '#16a34a', strokeWidth: 1, strokeDasharray: '4 4' }}\r\n                            />\r\n                            <Area\r\n                                type=\"monotone\"\r\n                                dataKey=\"income\"\r\n                                stroke=\"#16a34a\"\r\n                                strokeWidth={3}\r\n                                fillOpacity={1}\r\n                                fill=\"url(#colorIncome)\"\r\n                            />\r\n                        </AreaChart>\r\n                    </ResponsiveContainer>\r\n                </div>\r\n            </CardContent>\r\n        </Card>\r\n    )\r\n}\r\n\r\nfunction Badge({ children, variant, className }: any) {\r\n    return <span className={`px-2 py-0.5 rounded text-xs font-medium ${className}`}>{children}</span>\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\dashboard\\EarningsChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\dashboard\\EcoTipsWidget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\dashboard\\InventoryManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Package' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'kabadiwalaId' is defined but never used.","line":18,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":66}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Package, Plus, Minus, Warehouse, Save, Loader2 } from \"lucide-react\"\r\nimport { toast } from \"sonner\"\r\n\r\ninterface InventoryManagerProps {\r\n    initialInventory?: Record<string, number>\r\n    kabadiwalaId: string\r\n}\r\n\r\nconst MATERIALS = [\"Iron\", \"Plastic\", \"Paper\", \"Cardboard\", \"Copper\", \"Brass\", \"Aluminium\", \"E-Waste\"]\r\n\r\nexport function InventoryManager({ initialInventory, kabadiwalaId }: InventoryManagerProps) {\r\n    const [inventory, setInventory] = useState<Record<string, number>>(initialInventory || {})\r\n    const [loading, setLoading] = useState(false)\r\n\r\n    const updateStock = (item: string, delta: number) => {\r\n        setInventory(prev => {\r\n            const current = prev[item] || 0\r\n            const newAmount = Math.max(0, current + delta)\r\n            return { ...prev, [item]: newAmount }\r\n        })\r\n    }\r\n\r\n    const saveInventory = async () => {\r\n        setLoading(true)\r\n        try {\r\n            const res = await fetch(\"/api/kabadiwala/inventory\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ inventory })\r\n            })\r\n\r\n            if (res.ok) {\r\n                toast.success(\"Inventory updated\")\r\n            } else {\r\n                toast.error(\"Failed to update\")\r\n            }\r\n        } catch {\r\n            toast.error(\"Error saving inventory\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    const totalWeight = Object.values(inventory).reduce((a, b) => a + b, 0)\r\n\r\n    return (\r\n        <Card className=\"h-full border-orange-100 dark:border-orange-900 shadow-sm\">\r\n            <CardHeader className=\"pb-3 border-b bg-orange-50/50 dark:bg-orange-950/20\">\r\n                <div className=\"flex justify-between items-center\">\r\n                    <div>\r\n                        <CardTitle className=\"flex items-center gap-2\">\r\n                            <Warehouse className=\"h-5 w-5 text-orange-600\" />\r\n                            Inventory\r\n                        </CardTitle>\r\n                        <CardDescription>Track collected scrap</CardDescription>\r\n                    </div>\r\n                    <Badge variant=\"outline\" className=\"text-orange-600 bg-orange-50 border-orange-200\">\r\n                        {totalWeight} kg Total\r\n                    </Badge>\r\n                </div>\r\n            </CardHeader>\r\n            <CardContent className=\"p-0\">\r\n                <div className=\"max-h-[300px] overflow-y-auto p-4 space-y-4\">\r\n                    {MATERIALS.map(item => (\r\n                        <div key={item} className=\"flex items-center justify-between\">\r\n                            <span className=\"font-medium text-sm\">{item}</span>\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <Button\r\n                                    size=\"icon\"\r\n                                    variant=\"outline\"\r\n                                    className=\"h-8 w-8\"\r\n                                    onClick={() => updateStock(item, -10)}\r\n                                >\r\n                                    <Minus className=\"h-3 w-3\" />\r\n                                </Button>\r\n                                <div className=\"w-16 text-center font-mono text-sm\">\r\n                                    {inventory[item] || 0} <span className=\"text-xs text-muted-foreground\">kg</span>\r\n                                </div>\r\n                                <Button\r\n                                    size=\"icon\"\r\n                                    variant=\"outline\"\r\n                                    className=\"h-8 w-8\"\r\n                                    onClick={() => updateStock(item, 10)}\r\n                                >\r\n                                    <Plus className=\"h-3 w-3\" />\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n                <div className=\"p-4 border-t bg-muted/10\">\r\n                    <Button className=\"w-full bg-orange-600 hover:bg-orange-700 text-white\" onClick={saveInventory} disabled={loading}>\r\n                        {loading ? <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" /> : <Save className=\"h-4 w-4 mr-2\" />}\r\n                        Update Stock\r\n                    </Button>\r\n                </div>\r\n            </CardContent>\r\n        </Card>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\dashboard\\RateManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Switch' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Save' is defined but never used.","line":10,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'kabadiwalaId' is defined but never used.","line":34,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":57}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Switch } from \"@/components/ui/switch\"\r\nimport { Loader2, Save, IndianRupee, Edit2, Plus, Trash2 } from \"lucide-react\"\r\nimport { toast } from \"sonner\"\r\n\r\ninterface RateManagerProps {\r\n    initialRates?: Record<string, number>\r\n    kabadiwalaId: string\r\n}\r\n\r\n// Real-time market rates - Delhi, December 2025\r\nconst DEFAULT_RATES = {\r\n    \"Iron\": 31,\r\n    \"Copper\": 580,\r\n    \"Brass\": 350,\r\n    \"Aluminium\": 105,\r\n    \"Newspaper\": 14,\r\n    \"Plastic\": 12,\r\n    \"Cardboard\": 9,\r\n    \"E-Waste\": 45,\r\n    \"Steel\": 28,\r\n    \"Books\": 12,\r\n    \"Glass Bottles\": 2,\r\n    \"PET Bottles\": 8\r\n}\r\n\r\nexport function RateManager({ initialRates, kabadiwalaId }: RateManagerProps) {\r\n    const [rates, setRates] = useState<Record<string, number>>(\r\n        initialRates && Object.keys(initialRates).length > 0 ? initialRates : DEFAULT_RATES\r\n    )\r\n    const [isEditing, setIsEditing] = useState(false)\r\n    const [saving, setSaving] = useState(false)\r\n    const [newItemName, setNewItemName] = useState(\"\")\r\n    const [newItemPrice, setNewItemPrice] = useState(\"\")\r\n\r\n    const handleSave = async () => {\r\n        setSaving(true)\r\n        try {\r\n            const res = await fetch(\"/api/kabadiwala/rates\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ rates })\r\n            })\r\n\r\n            if (res.ok) {\r\n                toast.success(\"Rates updated successfully!\")\r\n                setIsEditing(false)\r\n            } else {\r\n                toast.error(\"Failed to update rates\")\r\n            }\r\n        } catch {\r\n            toast.error(\"Network error\")\r\n        } finally {\r\n            setSaving(false)\r\n        }\r\n    }\r\n\r\n    const updateRate = (item: string, price: number) => {\r\n        setRates(prev => ({ ...prev, [item]: price }))\r\n    }\r\n\r\n    const removeRate = (item: string) => {\r\n        const newRates = { ...rates }\r\n        delete newRates[item]\r\n        setRates(newRates)\r\n    }\r\n\r\n    const addNewItem = () => {\r\n        if (!newItemName || !newItemPrice) return\r\n        setRates(prev => ({ ...prev, [newItemName]: parseFloat(newItemPrice) }))\r\n        setNewItemName(\"\")\r\n        setNewItemPrice(\"\")\r\n    }\r\n\r\n    return (\r\n        <Card className=\"h-full border-blue-100 dark:border-blue-900 shadow-sm\">\r\n            <CardHeader className=\"pb-3 border-b bg-muted/20\">\r\n                <div className=\"flex justify-between items-center\">\r\n                    <div>\r\n                        <CardTitle className=\"flex items-center gap-2\">\r\n                            <IndianRupee className=\"h-5 w-5 text-blue-600\" />\r\n                            Rate Card\r\n                        </CardTitle>\r\n                        <CardDescription>Manage your buying prices</CardDescription>\r\n                    </div>\r\n                    {!isEditing ? (\r\n                        <Button size=\"sm\" variant=\"outline\" onClick={() => setIsEditing(true)}>\r\n                            <Edit2 className=\"h-4 w-4 mr-2\" /> Edit Rates\r\n                        </Button>\r\n                    ) : (\r\n                        <div className=\"flex gap-2\">\r\n                            <Button size=\"sm\" variant=\"ghost\" onClick={() => setIsEditing(false)}>Cancel</Button>\r\n                            <Button size=\"sm\" onClick={handleSave} disabled={saving}>\r\n                                {saving && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n                                Save\r\n                            </Button>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </CardHeader>\r\n            <CardContent className=\"p-0\">\r\n                <div className=\"divide-y max-h-[400px] overflow-y-auto\">\r\n                    {Object.entries(rates).map(([item, price]) => (\r\n                        <div key={item} className=\"flex justify-between items-center p-4 hover:bg-muted/50 transition-colors\">\r\n                            <span className=\"font-medium text-sm\">{item}</span>\r\n                            {isEditing ? (\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <div className=\"relative w-24\">\r\n                                        <span className=\"absolute left-2 top-1/2 -translate-y-1/2 text-muted-foreground text-xs\"></span>\r\n                                        <Input\r\n                                            type=\"number\"\r\n                                            value={price}\r\n                                            onChange={(e) => updateRate(item, parseFloat(e.target.value))}\r\n                                            className=\"h-8 pl-6 text-right\"\r\n                                        />\r\n                                    </div>\r\n                                    <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 text-destructive hover:bg-red-50\" onClick={() => removeRate(item)}>\r\n                                        <Trash2 className=\"h-3 w-3\" />\r\n                                    </Button>\r\n                                </div>\r\n                            ) : (\r\n                                <Badge variant=\"secondary\" className=\"font-mono text-base bg-blue-50 text-blue-700 hover:bg-blue-100 border-blue-200\">\r\n                                    {price}<span className=\"text-[10px] text-muted-foreground ml-1\">/kg</span>\r\n                                </Badge>\r\n                            )}\r\n                        </div>\r\n                    ))}\r\n\r\n                    {/* Add New Item Row */}\r\n                    {isEditing && (\r\n                        <div className=\"p-4 bg-muted/30\">\r\n                            <Label className=\"text-xs text-muted-foreground mb-2 block\">Add New Item</Label>\r\n                            <div className=\"flex gap-2\">\r\n                                <Input\r\n                                    placeholder=\"Item name\"\r\n                                    value={newItemName}\r\n                                    onChange={(e) => setNewItemName(e.target.value)}\r\n                                    className=\"h-8 text-sm\"\r\n                                />\r\n                                <div className=\"relative w-24\">\r\n                                    <span className=\"absolute left-2 top-1/2 -translate-y-1/2 text-muted-foreground text-xs\"></span>\r\n                                    <Input\r\n                                        type=\"number\"\r\n                                        placeholder=\"0\"\r\n                                        value={newItemPrice}\r\n                                        onChange={(e) => setNewItemPrice(e.target.value)}\r\n                                        className=\"h-8 pl-6 text-right\"\r\n                                    />\r\n                                </div>\r\n                                <Button size=\"icon\" className=\"h-8 w-8 shrink-0\" onClick={addNewItem} disabled={!newItemName || !newItemPrice}>\r\n                                    <Plus className=\"h-4 w-4\" />\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </CardContent>\r\n            {!isEditing && (\r\n                <CardFooter className=\"bg-muted/10 p-3 text-xs text-muted-foreground justify-center border-t\">\r\n                    Last updated: Just now\r\n                </CardFooter>\r\n            )}\r\n        </Card>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\dashboard\\ReferralWidget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":15},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nE:\\edrivekabadi\\kabadiwala\\src\\components\\dashboard\\ReferralWidget.tsx:12:38\n  10 | export function ReferralWidget() {\n  11 |     const [copied, setCopied] = useState(false)\n> 12 |     const referralCode = \"KABADI-\" + Math.random().toString(36).substring(2, 7).toUpperCase()\n     |                                      ^^^^^^^^^^^^^ Cannot call impure function\n  13 |\n  14 |     const handleCopy = () => {\n  15 |         navigator.clipboard.writeText(referralCode)","line":12,"column":38,"nodeType":null,"endLine":12,"endColumn":51}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Gift, Copy, Share2, Check } from \"lucide-react\"\r\nimport { toast } from \"sonner\"\r\n\r\nexport function ReferralWidget() {\r\n    const [copied, setCopied] = useState(false)\r\n    const referralCode = \"KABADI-\" + Math.random().toString(36).substring(2, 7).toUpperCase()\r\n\r\n    const handleCopy = () => {\r\n        navigator.clipboard.writeText(referralCode)\r\n        setCopied(true)\r\n        toast.success(\"Referral code copied!\")\r\n        setTimeout(() => setCopied(false), 2000)\r\n    }\r\n\r\n    const handleShare = async () => {\r\n        if (navigator.share) {\r\n            try {\r\n                await navigator.share({\r\n                    title: 'Join Kabadiwala!',\r\n                    text: `Use my code ${referralCode} to get extra rewards on your first scrap pickup!`,\r\n                    url: window.location.origin\r\n                })\r\n            } catch (err) {\r\n                console.log(\"Share failed\", err)\r\n            }\r\n        } else {\r\n            handleCopy()\r\n        }\r\n    }\r\n\r\n    return (\r\n        <Card className=\"border-none shadow-lg bg-gradient-to-br from-purple-50 to-indigo-50 dark:from-purple-950/20 dark:to-indigo-950/20 overflow-hidden\">\r\n            <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"flex items-center gap-2 text-purple-700 dark:text-purple-400\">\r\n                    <Gift className=\"h-5 w-5\" />\r\n                    Refer & Earn\r\n                </CardTitle>\r\n                <CardDescription>\r\n                    Invite friends and get <span className=\"font-bold text-foreground\">50 coins</span> each!\r\n                </CardDescription>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n                <div className=\"bg-white/60 dark:bg-card/50 p-4 rounded-xl border border-dashed border-purple-200 dark:border-purple-800 text-center space-y-3\">\r\n                    <p className=\"text-sm text-muted-foreground\">Your Unique Code</p>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <code className=\"flex-1 bg-background py-2 px-3 rounded-lg border font-mono text-lg font-bold tracking-wider text-center\">\r\n                            {referralCode}\r\n                        </code>\r\n                        <Button size=\"icon\" variant=\"outline\" onClick={handleCopy}>\r\n                            {copied ? <Check className=\"h-4 w-4 text-green-600\" /> : <Copy className=\"h-4 w-4\" />}\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n                <Button className=\"w-full bg-purple-600 hover:bg-purple-700 text-white\" onClick={handleShare}>\r\n                    <Share2 className=\"h-4 w-4 mr-2\" /> Share with Friends\r\n                </Button>\r\n            </CardContent>\r\n        </Card>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\dashboard\\ScrapRatesTicker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\favorites\\FavoriteCard.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":72,"column":29,"nodeType":"JSXOpeningElement","endLine":72,"endColumn":119}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Heart, Loader2, Star, MapPin, MessageCircle, Package, Trash2 } from \"lucide-react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Card, CardContent } from \"@/components/ui/card\"\r\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport Link from \"next/link\"\r\nimport { toast } from \"sonner\"\r\n\r\ninterface FavoriteKabadiwala {\r\n    favoriteId: string\r\n    kabadiwala: {\r\n        id: string\r\n        name: string | null\r\n        phone: string\r\n        image: string | null\r\n        kabadiwalaProfile?: {\r\n            businessName: string\r\n            serviceArea: string | null\r\n            rating: number\r\n            totalReviews: number\r\n            totalPickups: number\r\n            isVerified: boolean\r\n            rates: string | null\r\n        } | null\r\n    }\r\n}\r\n\r\ninterface FavoriteCardProps {\r\n    favorite: FavoriteKabadiwala\r\n    onRemove?: () => void\r\n}\r\n\r\nexport function FavoriteCard({ favorite, onRemove }: FavoriteCardProps) {\r\n    const [removing, setRemoving] = useState(false)\r\n    const k = favorite.kabadiwala\r\n    const profile = k.kabadiwalaProfile\r\n\r\n    const handleRemove = async () => {\r\n        setRemoving(true)\r\n        try {\r\n            const res = await fetch(`/api/favorites?kabadiwalaId=${k.id}`, {\r\n                method: \"DELETE\"\r\n            })\r\n            if (res.ok) {\r\n                toast.success(\"Removed from favorites\")\r\n                onRemove?.()\r\n            } else {\r\n                toast.error(\"Failed to remove\")\r\n            }\r\n        } catch {\r\n            toast.error(\"Something went wrong\")\r\n        } finally {\r\n            setRemoving(false)\r\n        }\r\n    }\r\n\r\n    // Parse rates\r\n    let rates: Record<string, number> = {}\r\n    try {\r\n        if (profile?.rates) rates = JSON.parse(profile.rates)\r\n    } catch { }\r\n\r\n    return (\r\n        <Card className=\"hover:shadow-lg transition-all duration-300 group\">\r\n            <CardContent className=\"p-4\">\r\n                <div className=\"flex gap-4\">\r\n                    <Avatar className=\"h-16 w-16 border-2 border-primary/10\">\r\n                        {k.image ? (\r\n                            <img src={k.image} alt={profile?.businessName || k.name || \"\"} className=\"object-cover\" />\r\n                        ) : (\r\n                            <AvatarFallback className=\"bg-gradient-to-br from-green-400 to-green-600 text-white text-xl font-bold\">\r\n                                {profile?.businessName?.[0] || k.name?.[0] || 'K'}\r\n                            </AvatarFallback>\r\n                        )}\r\n                    </Avatar>\r\n\r\n\r\n                    <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"flex items-start justify-between\">\r\n                            <div>\r\n                                <h3 className=\"font-semibold text-lg flex items-center gap-2\">\r\n                                    {profile?.businessName || k.name}\r\n                                    {profile?.isVerified && (\r\n                                        <Badge variant=\"secondary\" className=\"text-xs gap-1\">\r\n                                             Verified\r\n                                        </Badge>\r\n                                    )}\r\n                                </h3>\r\n                                {profile?.serviceArea && (\r\n                                    <p className=\"text-sm text-muted-foreground flex items-center gap-1\">\r\n                                        <MapPin className=\"h-3 w-3\" />\r\n                                        {profile.serviceArea}\r\n                                    </p>\r\n                                )}\r\n                            </div>\r\n\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                size=\"icon\"\r\n                                className=\"text-red-500 hover:text-red-600 hover:bg-red-50 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                onClick={handleRemove}\r\n                                disabled={removing}\r\n                            >\r\n                                {removing ? (\r\n                                    <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                                ) : (\r\n                                    <Trash2 className=\"h-4 w-4\" />\r\n                                )}\r\n                            </Button>\r\n                        </div>\r\n\r\n                        {/* Stats */}\r\n                        <div className=\"flex items-center gap-4 mt-2 text-sm\">\r\n                            <span className=\"flex items-center gap-1\">\r\n                                <Star className=\"h-4 w-4 fill-yellow-500 text-yellow-500\" />\r\n                                <span className=\"font-medium\">{profile?.rating?.toFixed(1) || \"0.0\"}</span>\r\n                                <span className=\"text-muted-foreground\">({profile?.totalReviews || 0})</span>\r\n                            </span>\r\n                            <span className=\"flex items-center gap-1 text-muted-foreground\">\r\n                                <Package className=\"h-4 w-4\" />\r\n                                {profile?.totalPickups || 0} pickups\r\n                            </span>\r\n                        </div>\r\n\r\n                        {/* Sample Rates */}\r\n                        {Object.keys(rates).length > 0 && (\r\n                            <div className=\"flex flex-wrap gap-2 mt-3\">\r\n                                {Object.entries(rates).slice(0, 4).map(([material, price]) => (\r\n                                    <Badge key={material} variant=\"outline\" className=\"text-xs capitalize\">\r\n                                        {material}: {price}/kg\r\n                                    </Badge>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Actions */}\r\n                        <div className=\"flex gap-2 mt-4\">\r\n                            <Link href={`/chat/${k.id}`}>\r\n                                <Button size=\"sm\" variant=\"outline\" className=\"gap-1\">\r\n                                    <MessageCircle className=\"h-4 w-4\" />\r\n                                    Chat\r\n                                </Button>\r\n                            </Link>\r\n                            <Link href={`/book/${k.id}`}>\r\n                                <Button size=\"sm\" className=\"gap-1\">\r\n                                    <Package className=\"h-4 w-4\" />\r\n                                    Book Pickup\r\n                                </Button>\r\n                            </Link>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </CardContent>\r\n        </Card>\r\n    )\r\n}\r\n\r\n// Favorite Toggle Button for Market page\r\ninterface FavoriteButtonProps {\r\n    kabadiwalaId: string\r\n    isFavorited?: boolean\r\n    onToggle?: (favorited: boolean) => void\r\n}\r\n\r\nexport function FavoriteButton({ kabadiwalaId, isFavorited = false, onToggle }: FavoriteButtonProps) {\r\n    const [favorited, setFavorited] = useState(isFavorited)\r\n    const [loading, setLoading] = useState(false)\r\n\r\n    const toggle = async () => {\r\n        setLoading(true)\r\n        try {\r\n            if (favorited) {\r\n                const res = await fetch(`/api/favorites?kabadiwalaId=${kabadiwalaId}`, {\r\n                    method: \"DELETE\"\r\n                })\r\n                if (res.ok) {\r\n                    setFavorited(false)\r\n                    onToggle?.(false)\r\n                    toast.success(\"Removed from favorites\")\r\n                }\r\n            } else {\r\n                const res = await fetch(\"/api/favorites\", {\r\n                    method: \"POST\",\r\n                    headers: { \"Content-Type\": \"application/json\" },\r\n                    body: JSON.stringify({ kabadiwalaId })\r\n                })\r\n                if (res.ok) {\r\n                    setFavorited(true)\r\n                    onToggle?.(true)\r\n                    toast.success(\"Added to favorites!\")\r\n                } else if (res.status === 409) {\r\n                    setFavorited(true)\r\n                }\r\n            }\r\n        } catch {\r\n            toast.error(\"Something went wrong\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <Button\r\n            variant=\"ghost\"\r\n            size=\"icon\"\r\n            onClick={toggle}\r\n            disabled={loading}\r\n            className={favorited ? \"text-pink-500\" : \"text-muted-foreground hover:text-pink-500\"}\r\n        >\r\n            {loading ? (\r\n                <Loader2 className=\"h-5 w-5 animate-spin\" />\r\n            ) : (\r\n                <Heart className={`h-5 w-5 ${favorited ? \"fill-current\" : \"\"}`} />\r\n            )}\r\n        </Button>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\favorites\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\gamification\\green-wallet-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\kabadiwala-card.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Phone' is defined but never used.","line":4,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":51},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":49,"column":21,"nodeType":"JSXOpeningElement","endLine":53,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Badge } from \"@/components/ui/badge\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { CheckCircle, MapPin, MessageCircle, Phone, Star } from \"lucide-react\"\r\nimport Link from \"next/link\"\r\nimport { FavoriteButtonWrapper } from \"@/app/market/FavoriteButtonWrapper\"\r\n\r\ninterface KabadiwalaProfileProps {\r\n    profile: {\r\n        id: string\r\n        userId: string\r\n        businessName: string\r\n        coverImage: string | null\r\n        isVerified: boolean\r\n        serviceArea: string | null\r\n        rating: number\r\n        bio: string | null\r\n        rates: string | null\r\n        totalReviews: number\r\n        totalPickups: number\r\n        user: {\r\n            phone: string\r\n            image: string | null\r\n        }\r\n    }\r\n    isFavorited: boolean\r\n}\r\n\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"\r\nimport { QuickChatSheet } from \"@/components/chat/QuickChatSheet\"\r\n\r\nexport function KabadiwalaCard({ profile, isFavorited }: KabadiwalaProfileProps) {\r\n    // Parse rates safely\r\n    const parseRates = (ratesStr: string | null) => {\r\n        if (!ratesStr) return null\r\n        try {\r\n            return JSON.parse(ratesStr) as Record<string, number>\r\n        } catch {\r\n            return null\r\n        }\r\n    }\r\n\r\n    const rates = parseRates(profile.rates)\r\n\r\n    return (\r\n        <Card className=\"flex flex-col hover:shadow-lg transition-shadow overflow-hidden\">\r\n            {profile.coverImage && (\r\n                <div className=\"h-32 w-full bg-muted relative\">\r\n                    <img\r\n                        src={profile.coverImage}\r\n                        alt={profile.businessName}\r\n                        className=\"w-full h-full object-cover\"\r\n                    />\r\n                </div>\r\n            )}\r\n            <CardHeader className=\"pb-3 relative\">\r\n                {profile.coverImage && <div className=\"absolute top-0 left-0 w-full h-12 bg-gradient-to-b from-background/0 to-background/0\" />}\r\n\r\n                <div className=\"flex justify-between items-start\">\r\n                    <div className=\"flex-1 flex gap-3\">\r\n                        <Avatar className=\"h-12 w-12 border-2 border-background shadow-sm\">\r\n                            <AvatarImage src={profile.user.image || undefined} />\r\n                            <AvatarFallback>{profile.businessName[0]}</AvatarFallback>\r\n                        </Avatar>\r\n                        <div>\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <CardTitle className=\"text-xl\">{profile.businessName}</CardTitle>\r\n                                {profile.isVerified && (\r\n                                    <Badge variant=\"secondary\" className=\"gap-1 text-xs px-1.5 h-5\">\r\n                                        <CheckCircle className=\"h-3 w-3 text-blue-500\" />\r\n                                        Verified\r\n                                    </Badge>\r\n                                )}\r\n                            </div>\r\n                            <p className=\"text-sm text-muted-foreground flex items-center mt-1\">\r\n                                <MapPin className=\"h-3 w-3 mr-1\" /> {profile.serviceArea || \"Local\"}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex flex-col items-end gap-2\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Badge variant=\"secondary\" className=\"flex items-center\">\r\n                                <Star className=\"h-3 w-3 mr-1 fill-yellow-500 text-yellow-500\" />\r\n                                {profile.rating.toFixed(1)}\r\n                            </Badge>\r\n                            <FavoriteButtonWrapper\r\n                                kabadiwalaId={profile.userId}\r\n                                initialFavorited={isFavorited}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </CardHeader>\r\n            <CardContent className=\"flex-1\">\r\n                {profile.bio && (\r\n                    <p className=\"text-sm text-muted-foreground mb-3 line-clamp-2\">\r\n                        {profile.bio}\r\n                    </p>\r\n                )}\r\n\r\n                {/* Rates */}\r\n                {rates && (\r\n                    <div className=\"mb-3\">\r\n                        <p className=\"text-sm font-medium mb-2\">Rates (/kg)</p>\r\n                        <div className=\"flex flex-wrap gap-1\">\r\n                            {Object.entries(rates).slice(0, 4).map(([material, price]) => (\r\n                                <Badge key={material} variant=\"outline\" className=\"text-xs capitalize\">\r\n                                    {material}: {price}\r\n                                </Badge>\r\n                            ))}\r\n                            {Object.keys(rates).length > 4 && (\r\n                                <Badge variant=\"outline\" className=\"text-xs\">\r\n                                    +{Object.keys(rates).length - 4} more\r\n                                </Badge>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"flex gap-2 flex-wrap\">\r\n                    <Badge variant=\"outline\">{profile.totalReviews} Reviews</Badge>\r\n                    <Badge variant=\"outline\">{profile.totalPickups} Pickups</Badge>\r\n                </div>\r\n            </CardContent>\r\n            <CardFooter className=\"flex gap-3 pt-0\">\r\n                <QuickChatSheet\r\n                    otherUserId={profile.userId}\r\n                    businessName={profile.businessName}\r\n                    userName={profile.user.phone} // Fallback name\r\n                    userImage={profile.user.image}\r\n                    isVerified={profile.isVerified}\r\n                    trigger={\r\n                        <Button variant=\"outline\" className=\"flex-1 border-primary/20 hover:bg-primary/5 hover:text-primary transition-all group\">\r\n                            <MessageCircle className=\"mr-2 h-4 w-4 group-hover:scale-110 transition-transform\" />\r\n                            Quick Chat\r\n                        </Button>\r\n                    }\r\n                />\r\n\r\n                <Link href={`/book/${profile.userId}`} className=\"flex-1\">\r\n                    <Button className=\"w-full bg-gradient-to-r from-primary to-green-600 hover:from-primary/90 hover:to-green-700 shadow-lg shadow-green-500/20 group relative overflow-hidden\">\r\n                        <div className=\"absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300\" />\r\n                        <span className=\"relative flex items-center justify-center gap-2\">\r\n                            Book Pickup\r\n                            <span className=\"flex h-2 w-2 relative\">\r\n                                <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75\"></span>\r\n                                <span className=\"relative inline-flex rounded-full h-2 w-2 bg-white\"></span>\r\n                            </span>\r\n                        </span>\r\n                    </Button>\r\n                </Link>\r\n            </CardFooter>\r\n        </Card>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\layout\\MobileNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\orders\\OrderCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":6,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":6,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":50}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\"\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogDescription,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogTrigger,\r\n} from \"@/components/ui/dialog\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport {\r\n    MapPin, Calendar, Clock, Star, CheckCircle, XCircle,\r\n    Phone, MessageCircle, Loader2, Package, Ban\r\n} from \"lucide-react\"\r\nimport Link from \"next/link\"\r\nimport { toast } from \"sonner\"\r\nimport { OrderTimeline } from \"./OrderTimeline\"\r\n\r\ninterface Order {\r\n    id: string\r\n    status: string\r\n    address: string\r\n    pickupDate: string | null\r\n    totalAmount: number | null\r\n    items: string | null\r\n    createdAt: string\r\n    buyer: {\r\n        id: string\r\n        name: string | null\r\n        phone: string\r\n        kabadiwalaProfile?: {\r\n            businessName: string\r\n            rating: number\r\n            isVerified: boolean\r\n        } | null\r\n    }\r\n    review?: {\r\n        rating: number\r\n        comment: string | null\r\n    } | null\r\n}\r\n\r\ninterface OrderCardProps {\r\n    order: Order\r\n    userRole: \"SELLER\" | \"KABADIWALA\"\r\n    onStatusUpdate?: () => void\r\n}\r\n\r\nexport function OrderCard({ order, userRole, onStatusUpdate }: OrderCardProps) {\r\n    const [loading, setLoading] = useState(false)\r\n    const [cancelDialogOpen, setCancelDialogOpen] = useState(false)\r\n    const [cancelReason, setCancelReason] = useState(\"\")\r\n    const [completeDialogOpen, setCompleteDialogOpen] = useState(false)\r\n    const [totalAmount, setTotalAmount] = useState(\"\")\r\n\r\n    const updateStatus = async (status: string, extra?: Record<string, unknown>) => {\r\n        setLoading(true)\r\n        try {\r\n            const res = await fetch(`/api/orders/${order.id}`, {\r\n                method: \"PATCH\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ status, ...extra })\r\n            })\r\n            if (res.ok) {\r\n                toast.success(`Order ${status.toLowerCase()}!`)\r\n                onStatusUpdate?.()\r\n            } else {\r\n                toast.error(\"Failed to update order\")\r\n            }\r\n        } catch {\r\n            toast.error(\"Something went wrong\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    const handleCancel = () => {\r\n        updateStatus(\"CANCELLED\", { cancelReason })\r\n        setCancelDialogOpen(false)\r\n    }\r\n\r\n    const handleComplete = () => {\r\n        updateStatus(\"COMPLETED\", { totalAmount: parseFloat(totalAmount) || 0 })\r\n        setCompleteDialogOpen(false)\r\n    }\r\n\r\n    const getStatusColor = (status: string) => {\r\n        switch (status) {\r\n            case \"REQUESTED\": return \"bg-yellow-500/10 text-yellow-600 border-yellow-500/20\"\r\n            case \"ACCEPTED\": return \"bg-blue-500/10 text-blue-600 border-blue-500/20\"\r\n            case \"COMPLETED\": return \"bg-green-500/10 text-green-600 border-green-500/20\"\r\n            case \"CANCELLED\": return \"bg-red-500/10 text-red-600 border-red-500/20\"\r\n            default: return \"\"\r\n        }\r\n    }\r\n\r\n    const getStatusIcon = (status: string) => {\r\n        switch (status) {\r\n            case \"REQUESTED\": return <Clock className=\"h-3 w-3\" />\r\n            case \"ACCEPTED\": return <Package className=\"h-3 w-3\" />\r\n            case \"COMPLETED\": return <CheckCircle className=\"h-3 w-3\" />\r\n            case \"CANCELLED\": return <Ban className=\"h-3 w-3\" />\r\n            default: return null\r\n        }\r\n    }\r\n\r\n    const businessName = order.buyer.kabadiwalaProfile?.businessName || order.buyer.name\r\n    const isVerified = order.buyer.kabadiwalaProfile?.isVerified\r\n\r\n    return (\r\n        <Card className=\"hover:shadow-lg transition-all duration-300 border-l-4\" style={{\r\n            borderLeftColor: order.status === \"COMPLETED\" ? \"#22c55e\" :\r\n                order.status === \"CANCELLED\" ? \"#ef4444\" :\r\n                    order.status === \"ACCEPTED\" ? \"#3b82f6\" : \"#eab308\"\r\n        }}>\r\n            <CardContent className=\"p-4\">\r\n                <div className=\"flex flex-col md:flex-row md:items-start justify-between gap-4\">\r\n                    {/* Order Info */}\r\n                    <div className=\"flex gap-4 flex-1\">\r\n                        <Avatar className=\"h-12 w-12 border-2 border-primary/10\">\r\n                            <AvatarFallback className=\"bg-gradient-to-br from-primary/20 to-primary/5 text-primary font-bold\">\r\n                                {businessName?.[0] || 'K'}\r\n                            </AvatarFallback>\r\n                        </Avatar>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                            <div className=\"flex items-center gap-2 flex-wrap\">\r\n                                <p className=\"font-semibold text-lg\">{businessName}</p>\r\n                                {isVerified && (\r\n                                    <Badge variant=\"secondary\" className=\"gap-1 text-xs\">\r\n                                        <CheckCircle className=\"h-3 w-3 text-blue-500\" />\r\n                                        Verified\r\n                                    </Badge>\r\n                                )}\r\n                            </div>\r\n                            <p className=\"text-sm text-muted-foreground flex items-center gap-1 mt-1\">\r\n                                <MapPin className=\"h-3 w-3 flex-shrink-0\" />\r\n                                <span className=\"truncate\">{order.address}</span>\r\n                            </p>\r\n                            <div className=\"flex flex-wrap items-center gap-3 mt-2 text-sm text-muted-foreground\">\r\n                                <span className=\"flex items-center gap-1\">\r\n                                    <Calendar className=\"h-3 w-3\" />\r\n                                    {order.pickupDate\r\n                                        ? new Date(order.pickupDate).toLocaleDateString('en-IN', {\r\n                                            day: 'numeric', month: 'short', year: 'numeric'\r\n                                        })\r\n                                        : \"Date TBD\"}\r\n                                </span>\r\n                                {order.totalAmount && order.totalAmount > 0 && (\r\n                                    <span className=\"font-semibold text-green-600\">\r\n                                        {order.totalAmount.toLocaleString()}\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Timeline (Hidden on small screens if needed, or always shown) */}\r\n                    <div className=\"hidden md:block w-1/3 px-4\">\r\n                        <OrderTimeline\r\n                            status={order.status}\r\n                            createdAt={order.createdAt}\r\n                            pickupDate={order.pickupDate}\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Status & Actions */}\r\n                    <div className=\"flex flex-col items-end gap-3\">\r\n                        <Badge className={`${getStatusColor(order.status)} flex items-center gap-1`}>\r\n                            {getStatusIcon(order.status)}\r\n                            {order.status}\r\n                        </Badge>\r\n\r\n                        {/* Action Buttons based on role and status */}\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            {/* Kabadiwala Actions */}\r\n                            {userRole === \"KABADIWALA\" && order.status === \"REQUESTED\" && (\r\n                                <>\r\n                                    <Button\r\n                                        size=\"sm\"\r\n                                        onClick={() => updateStatus(\"ACCEPTED\")}\r\n                                        disabled={loading}\r\n                                        className=\"bg-green-600 hover:bg-green-700\"\r\n                                    >\r\n                                        {loading ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <CheckCircle className=\"h-4 w-4 mr-1\" />}\r\n                                        Accept\r\n                                    </Button>\r\n                                    <Dialog open={cancelDialogOpen} onOpenChange={setCancelDialogOpen}>\r\n                                        <DialogTrigger asChild>\r\n                                            <Button size=\"sm\" variant=\"destructive\">\r\n                                                <XCircle className=\"h-4 w-4 mr-1\" /> Decline\r\n                                            </Button>\r\n                                        </DialogTrigger>\r\n                                        <DialogContent>\r\n                                            <DialogHeader>\r\n                                                <DialogTitle>Decline Order</DialogTitle>\r\n                                                <DialogDescription>\r\n                                                    Please provide a reason for declining this order.\r\n                                                </DialogDescription>\r\n                                            </DialogHeader>\r\n                                            <Textarea\r\n                                                placeholder=\"Reason (optional)...\"\r\n                                                value={cancelReason}\r\n                                                onChange={(e) => setCancelReason(e.target.value)}\r\n                                            />\r\n                                            <Button variant=\"destructive\" onClick={handleCancel} disabled={loading}>\r\n                                                {loading && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n                                                Confirm Decline\r\n                                            </Button>\r\n                                        </DialogContent>\r\n                                    </Dialog>\r\n                                </>\r\n                            )}\r\n\r\n                            {userRole === \"KABADIWALA\" && order.status === \"ACCEPTED\" && (\r\n                                <Dialog open={completeDialogOpen} onOpenChange={setCompleteDialogOpen}>\r\n                                    <DialogTrigger asChild>\r\n                                        <Button size=\"sm\" className=\"bg-green-600 hover:bg-green-700\">\r\n                                            <CheckCircle className=\"h-4 w-4 mr-1\" /> Mark Complete\r\n                                        </Button>\r\n                                    </DialogTrigger>\r\n                                    <DialogContent>\r\n                                        <DialogHeader>\r\n                                            <DialogTitle>Complete Pickup</DialogTitle>\r\n                                            <DialogDescription>\r\n                                                Enter the total amount paid to the customer.\r\n                                            </DialogDescription>\r\n                                        </DialogHeader>\r\n                                        <div className=\"space-y-4\">\r\n                                            <div>\r\n                                                <Label>Total Amount Paid ()</Label>\r\n                                                <Input\r\n                                                    type=\"number\"\r\n                                                    placeholder=\"e.g. 500\"\r\n                                                    value={totalAmount}\r\n                                                    onChange={(e) => setTotalAmount(e.target.value)}\r\n                                                />\r\n                                            </div>\r\n                                            <Button onClick={handleComplete} disabled={loading} className=\"w-full\">\r\n                                                {loading && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n                                                Complete Order\r\n                                            </Button>\r\n                                        </div>\r\n                                    </DialogContent>\r\n                                </Dialog>\r\n                            )}\r\n\r\n                            {/* Seller Actions */}\r\n                            {userRole === \"SELLER\" && order.status === \"REQUESTED\" && (\r\n                                <Dialog open={cancelDialogOpen} onOpenChange={setCancelDialogOpen}>\r\n                                    <DialogTrigger asChild>\r\n                                        <Button size=\"sm\" variant=\"outline\" className=\"text-red-500 border-red-200 hover:bg-red-50\">\r\n                                            <XCircle className=\"h-4 w-4 mr-1\" /> Cancel\r\n                                        </Button>\r\n                                    </DialogTrigger>\r\n                                    <DialogContent>\r\n                                        <DialogHeader>\r\n                                            <DialogTitle>Cancel Order</DialogTitle>\r\n                                            <DialogDescription>\r\n                                                Are you sure you want to cancel this pickup request?\r\n                                            </DialogDescription>\r\n                                        </DialogHeader>\r\n                                        <Textarea\r\n                                            placeholder=\"Reason (optional)...\"\r\n                                            value={cancelReason}\r\n                                            onChange={(e) => setCancelReason(e.target.value)}\r\n                                        />\r\n                                        <Button variant=\"destructive\" onClick={handleCancel} disabled={loading}>\r\n                                            {loading && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n                                            Confirm Cancel\r\n                                        </Button>\r\n                                    </DialogContent>\r\n                                </Dialog>\r\n                            )}\r\n\r\n                            {/* Common Actions */}\r\n                            <Link href={`/chat/${order.buyer.id}`}>\r\n                                <Button size=\"sm\" variant=\"outline\">\r\n                                    <MessageCircle className=\"h-4 w-4 mr-1\" /> Chat\r\n                                </Button>\r\n                            </Link>\r\n\r\n                            <a href={`tel:${order.buyer.phone}`}>\r\n                                <Button size=\"sm\" variant=\"outline\">\r\n                                    <Phone className=\"h-4 w-4 mr-1\" /> Call\r\n                                </Button>\r\n                            </a>\r\n\r\n                            {/* Review Button for Completed Orders */}\r\n                            {order.status === \"COMPLETED\" && !order.review && userRole === \"SELLER\" && (\r\n                                <Link href={`/reviews/${order.id}`}>\r\n                                    <Button size=\"sm\" variant=\"secondary\">\r\n                                        <Star className=\"h-4 w-4 mr-1\" /> Rate\r\n                                    </Button>\r\n                                </Link>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Show Review Stars if exists */}\r\n                        {order.review && (\r\n                            <div className=\"flex items-center gap-1\">\r\n                                {[...Array(5)].map((_, i) => (\r\n                                    <Star\r\n                                        key={i}\r\n                                        className={`h-4 w-4 ${i < order.review!.rating\r\n                                            ? \"fill-yellow-500 text-yellow-500\"\r\n                                            : \"text-gray-300\"\r\n                                            }`}\r\n                                    />\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Mobile Timeline */}\r\n                <div className=\"md:hidden mt-4 pt-4 border-t\">\r\n                    <OrderTimeline\r\n                        status={order.status}\r\n                        createdAt={order.createdAt}\r\n                        pickupDate={order.pickupDate}\r\n                    />\r\n                </div>\r\n            </CardContent>\r\n        </Card>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\orders\\OrderTimeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\orders\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\profile\\EcoImpactVisualizer.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":31,"column":43,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[1231,1297],"text":"\r\n                    See the difference you&apos;ve made by recycling "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[1231,1297],"text":"\r\n                    See the difference you&lsquo;ve made by recycling "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[1231,1297],"text":"\r\n                    See the difference you&#39;ve made by recycling "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[1231,1297],"text":"\r\n                    See the difference you&rsquo;ve made by recycling "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\"\r\nimport { Leaf, Wind, Zap, Droplets, TreePine } from \"lucide-react\"\r\n\r\ninterface EcoImpactProps {\r\n    totalWeight: number // in kg\r\n}\r\n\r\nexport function EcoImpactVisualizer({ totalWeight }: EcoImpactProps) {\r\n    // Impact multipliers (approximate values)\r\n    // 1kg mixed scrap savings:\r\n    const CO2_SAVED = 1.5 // kg of CO2\r\n    const ENERGY_SAVED = 4 // kWh\r\n    const WATER_SAVED = 20 // Liters\r\n    const TREES_SAVED = 0.02 // Trees per kg (50kg = 1 tree)\r\n\r\n    const co2 = (totalWeight * CO2_SAVED).toFixed(1)\r\n    const energy = (totalWeight * ENERGY_SAVED).toFixed(0)\r\n    const water = (totalWeight * WATER_SAVED).toFixed(0)\r\n    const trees = (totalWeight * TREES_SAVED).toFixed(1)\r\n\r\n    return (\r\n        <Card className=\"border-none shadow-lg bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950/20 dark:to-card overflow-hidden\">\r\n            <CardHeader>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                    <Leaf className=\"h-6 w-6 text-green-600\" />\r\n                    Your Eco Impact\r\n                </CardTitle>\r\n                <CardDescription>\r\n                    See the difference you've made by recycling {totalWeight}kg of waste!\r\n                </CardDescription>\r\n            </CardHeader>\r\n            <CardContent className=\"grid grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                <div className=\"bg-white/60 dark:bg-card/50 p-4 rounded-xl flex flex-col items-center text-center space-y-2\">\r\n                    <div className=\"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-full text-blue-600\">\r\n                        <Wind className=\"h-6 w-6\" />\r\n                    </div>\r\n                    <div>\r\n                        <p className=\"text-2xl font-bold\">{co2} kg</p>\r\n                        <p className=\"text-sm text-muted-foreground\">CO2 Avoided</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white/60 dark:bg-card/50 p-4 rounded-xl flex flex-col items-center text-center space-y-2\">\r\n                    <div className=\"p-3 bg-yellow-100 dark:bg-yellow-900/30 rounded-full text-yellow-600\">\r\n                        <Zap className=\"h-6 w-6\" />\r\n                    </div>\r\n                    <div>\r\n                        <p className=\"text-2xl font-bold\">{energy} kWh</p>\r\n                        <p className=\"text-sm text-muted-foreground\">Energy Saved</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white/60 dark:bg-card/50 p-4 rounded-xl flex flex-col items-center text-center space-y-2\">\r\n                    <div className=\"p-3 bg-cyan-100 dark:bg-cyan-900/30 rounded-full text-cyan-600\">\r\n                        <Droplets className=\"h-6 w-6\" />\r\n                    </div>\r\n                    <div>\r\n                        <p className=\"text-2xl font-bold\">{water} L</p>\r\n                        <p className=\"text-sm text-muted-foreground\">Water Saved</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white/60 dark:bg-card/50 p-4 rounded-xl flex flex-col items-center text-center space-y-2\">\r\n                    <div className=\"p-3 bg-green-100 dark:bg-green-900/30 rounded-full text-green-600\">\r\n                        <TreePine className=\"h-6 w-6\" />\r\n                    </div>\r\n                    <div>\r\n                        <p className=\"text-2xl font-bold\">{trees}</p>\r\n                        <p className=\"text-sm text-muted-foreground\">Trees Planted</p>\r\n                    </div>\r\n                </div>\r\n            </CardContent>\r\n        </Card>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\providers.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\stories\\StoriesBar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'idx' is defined but never used.","line":149,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":149,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Plus } from \"lucide-react\"\r\nimport { StoryRing } from \"./StoryRing\"\r\nimport { StoryViewer } from \"./StoryViewer\"\r\nimport { StoryCreator } from \"./StoryCreator\"\r\nimport { cn } from \"@/lib/utils\"\r\n\r\ninterface Story {\r\n    id: string\r\n    mediaUrl?: string\r\n    mediaType: string\r\n    text?: string\r\n    bgColor?: string\r\n    caption?: string\r\n    createdAt: string\r\n    hasViewed?: boolean\r\n}\r\n\r\ninterface StoryGroup {\r\n    user: {\r\n        id: string\r\n        name: string | null\r\n        image?: string | null\r\n        kabadiwalaProfile?: { businessName: string } | null\r\n    }\r\n    stories: Story[]\r\n    hasUnviewed: boolean\r\n}\r\n\r\ninterface StoriesBarProps {\r\n    currentUserId?: string\r\n    className?: string\r\n}\r\n\r\nexport function StoriesBar({ currentUserId, className }: StoriesBarProps) {\r\n    const [storyGroups, setStoryGroups] = useState<StoryGroup[]>([])\r\n    const [loading, setLoading] = useState(true)\r\n    const [viewerOpen, setViewerOpen] = useState(false)\r\n    const [selectedGroupIndex, setSelectedGroupIndex] = useState(0)\r\n    const [creatorOpen, setCreatorOpen] = useState(false)\r\n\r\n    const fetchStories = async () => {\r\n        try {\r\n            // Check if online first to avoid unnecessary fetch errors\r\n            if (typeof navigator !== 'undefined' && !navigator.onLine) {\r\n                console.log(\"Offline, skipping story fetch\")\r\n                setLoading(false)\r\n                return\r\n            }\r\n\r\n            const res = await fetch(\"/api/stories\", { credentials: 'include' })\r\n            if (res.ok) {\r\n                const data = await res.json()\r\n                if (Array.isArray(data)) {\r\n                    setStoryGroups(data)\r\n                } else {\r\n                    console.error(\"Stories API returned non-array:\", data)\r\n                    setStoryGroups([])\r\n                }\r\n            } else {\r\n                // Silently fail on 500/400 errors, just keep existing stories or empty\r\n                console.warn(\"API Error fetching stories\", res.status)\r\n            }\r\n        } catch (error) {\r\n            // Silently handle network errors to avoid crashing UI with Red Box\r\n            console.error(\"Network error fetching stories (handled):\", error)\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        fetchStories()\r\n        // Refresh stories every minute\r\n        const interval = setInterval(fetchStories, 60000)\r\n        return () => clearInterval(interval)\r\n    }, [])\r\n\r\n    const handleStoryClick = (index: number) => {\r\n        setSelectedGroupIndex(index)\r\n        setViewerOpen(true)\r\n    }\r\n\r\n    const handleStoryCreated = () => {\r\n        setCreatorOpen(false)\r\n        fetchStories() // Refresh\r\n    }\r\n\r\n    // Find if current user has stories\r\n    const ownStoryIndex = storyGroups.findIndex(g => g.user.id === currentUserId)\r\n    const hasOwnStory = ownStoryIndex !== -1\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className={cn(\"flex gap-4 overflow-x-auto py-4 px-2 scrollbar-hide\", className)}>\r\n                {[...Array(5)].map((_, i) => (\r\n                    <div key={i} className=\"flex flex-col items-center gap-1 animate-pulse\">\r\n                        <div className=\"w-16 h-16 rounded-full bg-gray-200 dark:bg-gray-700\" />\r\n                        <div className=\"w-12 h-3 rounded bg-gray-200 dark:bg-gray-700\" />\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <div className={cn(\"flex gap-4 overflow-x-auto py-4 px-2 scrollbar-hide\", className)}>\r\n                {/* Add Story Button */}\r\n                {currentUserId && (\r\n                    <button\r\n                        onClick={() => hasOwnStory ? handleStoryClick(ownStoryIndex) : setCreatorOpen(true)}\r\n                        className=\"flex flex-col items-center gap-1 focus:outline-none transition-transform hover:scale-105 active:scale-95\"\r\n                    >\r\n                        <div className=\"relative\">\r\n                            <div className={cn(\r\n                                \"w-16 h-16 rounded-full flex items-center justify-center\",\r\n                                hasOwnStory\r\n                                    ? \"bg-gradient-to-tr from-yellow-400 via-pink-500 to-purple-600 p-[3px]\"\r\n                                    : \"border-2 border-dashed border-gray-300 dark:border-gray-600\"\r\n                            )}>\r\n                                {hasOwnStory ? (\r\n                                    <div className=\"w-full h-full rounded-full bg-white dark:bg-gray-900 p-[2px] flex items-center justify-center\">\r\n                                        <div className=\"w-full h-full rounded-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center text-white font-bold\">\r\n                                            {storyGroups[ownStoryIndex]?.user.name?.[0] || \"Y\"}\r\n                                        </div>\r\n                                    </div>\r\n                                ) : (\r\n                                    <Plus className=\"h-6 w-6 text-gray-400\" />\r\n                                )}\r\n                            </div>\r\n                            {!hasOwnStory && (\r\n                                <div className=\"absolute -bottom-1 -right-1 w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-white\">\r\n                                    <Plus className=\"h-4 w-4\" />\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                        <span className=\"text-xs text-muted-foreground truncate w-16 text-center\">\r\n                            {hasOwnStory ? \"Your Story\" : \"Add Story\"}\r\n                        </span>\r\n                    </button>\r\n                )}\r\n\r\n                {/* Other Stories */}\r\n                {storyGroups\r\n                    .filter(g => g.user.id !== currentUserId)\r\n                    .map((group, idx) => {\r\n                        const actualIndex = storyGroups.findIndex(g => g.user.id === group.user.id)\r\n                        return (\r\n                            <StoryRing\r\n                                key={group.user.id}\r\n                                name={group.user.kabadiwalaProfile?.businessName || group.user.name || \"User\"}\r\n                                image={group.user.image}\r\n                                hasUnviewed={group.hasUnviewed}\r\n                                onClick={() => handleStoryClick(actualIndex)}\r\n                            />\r\n                        )\r\n                    })}\r\n            </div>\r\n\r\n            {/* Story Viewer Modal */}\r\n            {viewerOpen && storyGroups.length > 0 && (\r\n                <StoryViewer\r\n                    storyGroups={storyGroups}\r\n                    initialGroupIndex={selectedGroupIndex}\r\n                    currentUserId={currentUserId}\r\n                    onClose={() => {\r\n                        setViewerOpen(false)\r\n                        fetchStories() // Refresh after viewing\r\n                    }}\r\n                />\r\n            )}\r\n\r\n            {/* Story Creator Modal */}\r\n            {creatorOpen && (\r\n                <StoryCreator\r\n                    onClose={() => setCreatorOpen(false)}\r\n                    onCreated={handleStoryCreated}\r\n                />\r\n            )}\r\n        </>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\stories\\StoriesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\stories\\StoryCreator.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Camera' is defined but never used.","line":16,"column":62,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":68},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":306,"column":49,"nodeType":"JSXOpeningElement","endLine":310,"endColumn":51}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Story Creator Component\r\n * -----------------------\r\n * Create text-based or image-based stories.\r\n * Features:\r\n * - Text stories with color backgrounds\r\n * - Image stories (upload or paste URL)\r\n * - Multiple images (up to 5) for batch story creation\r\n * - Optional captions\r\n * - Preview before posting\r\n */\r\n\"use client\"\r\n\r\nimport { useState, useRef } from \"react\"\r\nimport { motion, AnimatePresence } from \"framer-motion\"\r\nimport { X, Image as ImageIcon, Type, Send, Loader2, Upload, Camera, Plus, Trash2 } from \"lucide-react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { cn } from \"@/lib/utils\"\r\nimport { toast } from \"sonner\"\r\n\r\ninterface StoryCreatorProps {\r\n    onClose: () => void\r\n    onCreated: () => void\r\n}\r\n\r\nconst bgColors = [\r\n    \"#10b981\", // Green\r\n    \"#3b82f6\", // Blue\r\n    \"#8b5cf6\", // Purple\r\n    \"#ec4899\", // Pink\r\n    \"#f59e0b\", // Amber\r\n    \"#ef4444\", // Red\r\n    \"#06b6d4\", // Cyan\r\n    \"#84cc16\", // Lime\r\n    \"#6366f1\", // Indigo\r\n    \"#000000\", // Black\r\n]\r\n\r\nconst MAX_IMAGES = 5\r\n\r\ninterface UploadedImage {\r\n    url: string\r\n    caption: string\r\n}\r\n\r\nexport function StoryCreator({ onClose, onCreated }: StoryCreatorProps) {\r\n    const [mode, setMode] = useState<\"TEXT\" | \"IMAGE\">(\"TEXT\")\r\n    const [text, setText] = useState(\"\")\r\n    const [bgColor, setBgColor] = useState(bgColors[0])\r\n    const [caption, setCaption] = useState(\"\")\r\n    const [loading, setLoading] = useState(false)\r\n    const [uploading, setUploading] = useState(false)\r\n    const [error, setError] = useState(\"\")\r\n    const fileInputRef = useRef<HTMLInputElement>(null)\r\n\r\n    // Multi-image state\r\n    const [images, setImages] = useState<UploadedImage[]>([])\r\n    const [currentImageIndex, setCurrentImageIndex] = useState(0)\r\n\r\n    const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const files = Array.from(e.target.files || [])\r\n        if (!files.length) return\r\n\r\n        // Check max limit\r\n        if (images.length + files.length > MAX_IMAGES) {\r\n            toast.error(`Maximum ${MAX_IMAGES} images allowed`)\r\n            return\r\n        }\r\n\r\n        // Validate all files\r\n        const allowedTypes = [\"image/jpeg\", \"image/png\", \"image/gif\", \"image/webp\"]\r\n        for (const file of files) {\r\n            if (!allowedTypes.includes(file.type)) {\r\n                toast.error(`${file.name}: Only JPEG, PNG, GIF, WebP allowed`)\r\n                return\r\n            }\r\n            if (file.size > 5 * 1024 * 1024) {\r\n                toast.error(`${file.name}: File too large. Max 5MB allowed.`)\r\n                return\r\n            }\r\n        }\r\n\r\n        setUploading(true)\r\n        setError(\"\")\r\n\r\n        try {\r\n            const uploadPromises = files.map(async (file) => {\r\n                const formData = new FormData()\r\n                formData.append(\"file\", file)\r\n                formData.append(\"type\", \"story\")\r\n\r\n                const res = await fetch(\"/api/upload\", {\r\n                    method: \"POST\",\r\n                    body: formData,\r\n                    credentials: 'include'\r\n                })\r\n\r\n                if (!res.ok) {\r\n                    const data = await res.json()\r\n                    throw new Error(data.error || \"Upload failed\")\r\n                }\r\n\r\n                const data = await res.json()\r\n                return { url: data.url, caption: \"\" }\r\n            })\r\n\r\n            const uploadedImages = await Promise.all(uploadPromises)\r\n            setImages(prev => [...prev, ...uploadedImages])\r\n            toast.success(`${uploadedImages.length} image(s) uploaded!`)\r\n        } catch (err) {\r\n            setError(err instanceof Error ? err.message : \"Upload failed\")\r\n            toast.error(\"Failed to upload images\")\r\n        } finally {\r\n            setUploading(false)\r\n        }\r\n    }\r\n\r\n    const removeImage = (index: number) => {\r\n        setImages(prev => prev.filter((_, i) => i !== index))\r\n        if (currentImageIndex >= images.length - 1) {\r\n            setCurrentImageIndex(Math.max(0, images.length - 2))\r\n        }\r\n    }\r\n\r\n    const updateImageCaption = (index: number, newCaption: string) => {\r\n        setImages(prev => prev.map((img, i) =>\r\n            i === index ? { ...img, caption: newCaption } : img\r\n        ))\r\n    }\r\n\r\n    const handleSubmit = async () => {\r\n        setError(\"\")\r\n        setLoading(true)\r\n\r\n        try {\r\n            if (mode === \"TEXT\") {\r\n                // Single text story\r\n                const body = { mediaType: \"TEXT\", text, bgColor, caption: caption || undefined }\r\n                const res = await fetch(\"/api/stories\", {\r\n                    method: \"POST\",\r\n                    headers: { \"Content-Type\": \"application/json\" },\r\n                    body: JSON.stringify(body),\r\n                    credentials: 'include'\r\n                })\r\n\r\n                if (!res.ok) {\r\n                    const data = await res.json()\r\n                    throw new Error(data.error || \"Failed to create story\")\r\n                }\r\n\r\n                toast.success(\"Story created!\")\r\n            } else {\r\n                // Multiple image stories\r\n                let successCount = 0\r\n                for (const img of images) {\r\n                    const body = {\r\n                        mediaType: \"IMAGE\",\r\n                        mediaUrl: img.url,\r\n                        caption: img.caption || undefined\r\n                    }\r\n\r\n                    const res = await fetch(\"/api/stories\", {\r\n                        method: \"POST\",\r\n                        headers: { \"Content-Type\": \"application/json\" },\r\n                        body: JSON.stringify(body),\r\n                        credentials: 'include'\r\n                    })\r\n\r\n                    if (res.ok) {\r\n                        successCount++\r\n                    }\r\n                }\r\n\r\n                if (successCount === images.length) {\r\n                    toast.success(`${successCount} stories created!`)\r\n                } else if (successCount > 0) {\r\n                    toast.warning(`${successCount}/${images.length} stories created`)\r\n                } else {\r\n                    throw new Error(\"Failed to create stories\")\r\n                }\r\n            }\r\n\r\n            onCreated()\r\n        } catch (err) {\r\n            setError(err instanceof Error ? err.message : \"Something went wrong\")\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    const isValid = mode === \"TEXT\" ? text.trim().length > 0 : images.length > 0\r\n\r\n    return (\r\n        <AnimatePresence>\r\n            <motion.div\r\n                initial={{ opacity: 0 }}\r\n                animate={{ opacity: 1 }}\r\n                exit={{ opacity: 0 }}\r\n                className=\"fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4\"\r\n            >\r\n                <motion.div\r\n                    initial={{ scale: 0.9, opacity: 0 }}\r\n                    animate={{ scale: 1, opacity: 1 }}\r\n                    exit={{ scale: 0.9, opacity: 0 }}\r\n                    className=\"bg-background rounded-2xl w-full max-w-lg overflow-hidden max-h-[90vh] flex flex-col\"\r\n                >\r\n                    {/* Header */}\r\n                    <div className=\"flex items-center justify-between p-4 border-b\">\r\n                        <h2 className=\"font-semibold text-lg\">Create Story</h2>\r\n                        <Button variant=\"ghost\" size=\"icon\" onClick={onClose}>\r\n                            <X className=\"h-5 w-5\" />\r\n                        </Button>\r\n                    </div>\r\n\r\n                    {/* Mode Toggle */}\r\n                    <div className=\"flex gap-2 p-4 border-b\">\r\n                        <Button\r\n                            variant={mode === \"TEXT\" ? \"default\" : \"outline\"}\r\n                            onClick={() => setMode(\"TEXT\")}\r\n                            className=\"flex-1\"\r\n                        >\r\n                            <Type className=\"h-4 w-4 mr-2\" />\r\n                            Text\r\n                        </Button>\r\n                        <Button\r\n                            variant={mode === \"IMAGE\" ? \"default\" : \"outline\"}\r\n                            onClick={() => setMode(\"IMAGE\")}\r\n                            className=\"flex-1\"\r\n                        >\r\n                            <ImageIcon className=\"h-4 w-4 mr-2\" />\r\n                            Images {images.length > 0 && `(${images.length})`}\r\n                        </Button>\r\n                    </div>\r\n\r\n                    {/* Content */}\r\n                    <div className=\"p-4 space-y-4 overflow-y-auto flex-1\">\r\n                        {mode === \"TEXT\" ? (\r\n                            <>\r\n                                {/* Text Preview */}\r\n                                <div\r\n                                    className=\"aspect-[9/16] max-h-[300px] rounded-xl flex items-center justify-center p-6 transition-colors\"\r\n                                    style={{ backgroundColor: bgColor }}\r\n                                >\r\n                                    <p className=\"text-white text-xl font-bold text-center leading-relaxed\">\r\n                                        {text || \"Your story text will appear here...\"}\r\n                                    </p>\r\n                                </div>\r\n\r\n                                {/* Text Input */}\r\n                                <Textarea\r\n                                    placeholder=\"Type your story text...\"\r\n                                    value={text}\r\n                                    onChange={(e) => setText(e.target.value)}\r\n                                    className=\"resize-none\"\r\n                                    rows={3}\r\n                                    maxLength={200}\r\n                                />\r\n                                <p className=\"text-xs text-muted-foreground text-right\">\r\n                                    {text.length}/200\r\n                                </p>\r\n\r\n                                {/* Color Picker */}\r\n                                <div>\r\n                                    <p className=\"text-sm font-medium mb-2\">Background Color</p>\r\n                                    <div className=\"flex gap-2 flex-wrap\">\r\n                                        {bgColors.map(color => (\r\n                                            <button\r\n                                                key={color}\r\n                                                onClick={() => setBgColor(color)}\r\n                                                className={cn(\r\n                                                    \"w-8 h-8 rounded-full transition-transform hover:scale-110\",\r\n                                                    bgColor === color && \"ring-2 ring-offset-2 ring-primary\"\r\n                                                )}\r\n                                                style={{ backgroundColor: color }}\r\n                                            />\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Caption for text */}\r\n                                <Input\r\n                                    placeholder=\"Add a caption (optional)...\"\r\n                                    value={caption}\r\n                                    onChange={(e) => setCaption(e.target.value)}\r\n                                    maxLength={100}\r\n                                />\r\n                            </>\r\n                        ) : (\r\n                            <>\r\n                                {/* Image Grid Preview */}\r\n                                {images.length > 0 && (\r\n                                    <div className=\"grid grid-cols-3 gap-2\">\r\n                                        {images.map((img, index) => (\r\n                                            <div\r\n                                                key={index}\r\n                                                className={cn(\r\n                                                    \"relative aspect-square rounded-lg overflow-hidden border-2 cursor-pointer transition-all\",\r\n                                                    currentImageIndex === index\r\n                                                        ? \"border-primary ring-2 ring-primary/30\"\r\n                                                        : \"border-transparent hover:border-muted-foreground/30\"\r\n                                                )}\r\n                                                onClick={() => setCurrentImageIndex(index)}\r\n                                            >\r\n                                                <img\r\n                                                    src={img.url}\r\n                                                    alt={`Story ${index + 1}`}\r\n                                                    className=\"w-full h-full object-cover\"\r\n                                                />\r\n                                                <button\r\n                                                    onClick={(e) => {\r\n                                                        e.stopPropagation()\r\n                                                        removeImage(index)\r\n                                                    }}\r\n                                                    className=\"absolute top-1 right-1 p-1 bg-red-500 rounded-full text-white hover:bg-red-600\"\r\n                                                >\r\n                                                    <Trash2 className=\"h-3 w-3\" />\r\n                                                </button>\r\n                                                <div className=\"absolute bottom-1 left-1 px-1.5 py-0.5 bg-black/60 rounded text-[10px] text-white\">\r\n                                                    {index + 1}\r\n                                                </div>\r\n                                            </div>\r\n                                        ))}\r\n\r\n                                        {/* Add More Button */}\r\n                                        {images.length < MAX_IMAGES && (\r\n                                            <button\r\n                                                onClick={() => fileInputRef.current?.click()}\r\n                                                disabled={uploading}\r\n                                                className=\"aspect-square rounded-lg border-2 border-dashed border-muted-foreground/30 flex flex-col items-center justify-center gap-1 text-muted-foreground hover:border-primary hover:text-primary transition-colors\"\r\n                                            >\r\n                                                {uploading ? (\r\n                                                    <Loader2 className=\"h-6 w-6 animate-spin\" />\r\n                                                ) : (\r\n                                                    <>\r\n                                                        <Plus className=\"h-6 w-6\" />\r\n                                                        <span className=\"text-[10px]\">Add More</span>\r\n                                                    </>\r\n                                                )}\r\n                                            </button>\r\n                                        )}\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Caption for current image */}\r\n                                {images.length > 0 && (\r\n                                    <Input\r\n                                        placeholder={`Caption for image ${currentImageIndex + 1} (optional)...`}\r\n                                        value={images[currentImageIndex]?.caption || \"\"}\r\n                                        onChange={(e) => updateImageCaption(currentImageIndex, e.target.value)}\r\n                                        maxLength={100}\r\n                                    />\r\n                                )}\r\n\r\n                                {/* Empty State / Upload Area */}\r\n                                {images.length === 0 && (\r\n                                    <div\r\n                                        className=\"aspect-[9/16] max-h-[300px] rounded-xl overflow-hidden relative border-2 border-dashed border-gray-300 dark:border-gray-600\"\r\n                                    >\r\n                                        <button\r\n                                            onClick={() => fileInputRef.current?.click()}\r\n                                            disabled={uploading}\r\n                                            className=\"w-full h-full flex flex-col items-center justify-center gap-3 text-muted-foreground hover:text-primary transition-colors\"\r\n                                        >\r\n                                            {uploading ? (\r\n                                                <>\r\n                                                    <Loader2 className=\"h-12 w-12 animate-spin\" />\r\n                                                    <span>Uploading...</span>\r\n                                                </>\r\n                                            ) : (\r\n                                                <>\r\n                                                    <Upload className=\"h-12 w-12\" />\r\n                                                    <span className=\"font-medium\">Click to upload images</span>\r\n                                                    <span className=\"text-xs\">Up to {MAX_IMAGES} images at once</span>\r\n                                                    <span className=\"text-xs text-muted-foreground\">JPEG, PNG, GIF, WebP (Max 5MB each)</span>\r\n                                                </>\r\n                                            )}\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n\r\n                                <input\r\n                                    ref={fileInputRef}\r\n                                    type=\"file\"\r\n                                    accept=\"image/jpeg,image/png,image/gif,image/webp\"\r\n                                    onChange={handleFileSelect}\r\n                                    className=\"hidden\"\r\n                                    multiple\r\n                                />\r\n\r\n                                {/* Story count info */}\r\n                                {images.length > 0 && (\r\n                                    <p className=\"text-xs text-center text-muted-foreground\">\r\n                                        {images.length} {images.length === 1 ? 'story' : 'stories'} will be created\r\n                                    </p>\r\n                                )}\r\n                            </>\r\n                        )}\r\n\r\n                        {/* Error */}\r\n                        {error && (\r\n                            <p className=\"text-sm text-red-500 text-center\">{error}</p>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Footer */}\r\n                    <div className=\"p-4 border-t\">\r\n                        <Button\r\n                            className=\"w-full\"\r\n                            onClick={handleSubmit}\r\n                            disabled={!isValid || loading || uploading}\r\n                        >\r\n                            {loading ? (\r\n                                <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\r\n                            ) : (\r\n                                <Send className=\"h-4 w-4 mr-2\" />\r\n                            )}\r\n                            {mode === \"IMAGE\" && images.length > 1\r\n                                ? `Share ${images.length} Stories`\r\n                                : \"Share Story\"\r\n                            }\r\n                        </Button>\r\n                    </div>\r\n                </motion.div>\r\n            </motion.div>\r\n        </AnimatePresence>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\stories\\StoryRing.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":67,"column":29,"nodeType":"JSXOpeningElement","endLine":75,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\ninterface StoryRingProps {\r\n    name: string\r\n    image?: string | null\r\n    hasUnviewed: boolean\r\n    isOwnStory?: boolean\r\n    onClick?: () => void\r\n    size?: \"sm\" | \"md\" | \"lg\"\r\n}\r\n\r\nconst sizeClasses = {\r\n    sm: {\r\n        ring: \"w-14 h-14\",\r\n        avatar: \"w-12 h-12\",\r\n        text: \"text-[10px] w-14\"\r\n    },\r\n    md: {\r\n        ring: \"w-18 h-18\",\r\n        avatar: \"w-16 h-16\",\r\n        text: \"text-xs w-18\"\r\n    },\r\n    lg: {\r\n        ring: \"w-22 h-22\",\r\n        avatar: \"w-20 h-20\",\r\n        text: \"text-sm w-22\"\r\n    }\r\n}\r\n\r\nexport function StoryRing({\r\n    name,\r\n    image,\r\n    hasUnviewed,\r\n    isOwnStory = false,\r\n    onClick,\r\n    size = \"md\"\r\n}: StoryRingProps) {\r\n    const sizes = sizeClasses[size]\r\n\r\n    return (\r\n        <button\r\n            onClick={onClick}\r\n            className=\"flex flex-col items-center gap-1 focus:outline-none transition-transform hover:scale-105 active:scale-95\"\r\n        >\r\n            {/* Gradient Ring */}\r\n            <div\r\n                className={cn(\r\n                    sizes.ring,\r\n                    \"rounded-full p-[3px] flex items-center justify-center\",\r\n                    hasUnviewed\r\n                        ? \"bg-gradient-to-tr from-yellow-400 via-pink-500 to-purple-600\"\r\n                        : \"bg-gray-300 dark:bg-gray-600\"\r\n                )}\r\n            >\r\n                {/* White/Dark inner ring */}\r\n                <div className=\"w-full h-full rounded-full bg-white dark:bg-gray-900 p-[2px] flex items-center justify-center\">\r\n                    {/* Avatar */}\r\n                    <div\r\n                        className={cn(\r\n                            sizes.avatar,\r\n                            \"rounded-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center text-white font-bold overflow-hidden\"\r\n                        )}\r\n                    >\r\n                        {image ? (\r\n                            <img\r\n                                src={image}\r\n                                alt={name}\r\n                                className=\"w-full h-full object-cover\"\r\n                                onError={(e) => {\r\n                                    // Hide broken image and show fallback\r\n                                    e.currentTarget.style.display = 'none'\r\n                                }}\r\n                            />\r\n                        ) : null}\r\n                        {/* Always show fallback initial behind image */}\r\n                        <span className=\"text-lg absolute\">{name?.[0]?.toUpperCase() || \"?\"}</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Name */}\r\n            <span\r\n                className={cn(\r\n                    sizes.text,\r\n                    \"truncate text-center text-muted-foreground\",\r\n                    isOwnStory && \"font-medium\"\r\n                )}\r\n            >\r\n                {isOwnStory ? \"Your Story\" : name?.split(\" \")[0] || \"User\"}\r\n            </span>\r\n        </button>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\stories\\StoryViewer.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nE:\\edrivekabadi\\kabadiwala\\src\\components\\stories\\StoryViewer.tsx:118:13\n  116 |                 })\n  117 |         } else {\n> 118 |             setViewCount(null)\n      |             ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  119 |             setViewers([])\n  120 |         }\n  121 |     }, [currentStory, isOwnStory])","line":118,"column":13,"nodeType":null,"endLine":118,"endColumn":25},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `currentGroup.stories.length`, but the source dependencies were [currentStoryIndex, currentGroupIndex, currentGroup?.stories.length, storyGroups.length, onClose]. Inferred different dependency than source.\n\nE:\\edrivekabadi\\kabadiwala\\src\\components\\stories\\StoryViewer.tsx:124:39\n  122 |\n  123 |     // Navigate to next story\n> 124 |     const goToNextStory = useCallback(() => {\n      |                                       ^^^^^^^\n> 125 |         if (currentStoryIndex < currentGroup.stories.length - 1) {\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 126 |             setCurrentStoryIndex(prev => prev + 1)\n      \n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 139 |         }\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 140 |     }, [currentStoryIndex, currentGroupIndex, currentGroup?.stories.length, storyGroups.length, onClose])\n      | ^^^^^^ Could not preserve existing manual memoization\n  141 |\n  142 |     // Progress timer\n  143 |     useEffect(() => {","line":124,"column":39,"nodeType":null,"endLine":140,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":184,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":184,"endColumn":23},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":275,"column":29,"nodeType":"JSXOpeningElement","endLine":279,"endColumn":31},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":361,"column":61,"nodeType":"JSXOpeningElement","endLine":361,"endColumn":138}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Story Viewer Component\r\n * ----------------------\r\n * Full-screen story viewer with:\r\n * - Auto-progress timer (5s per story)\r\n * - Tap to pause/resume\r\n * - Swipe/click navigation\r\n * - View count for own stories\r\n * - WhatsApp-like viewers list panel\r\n * - Delete option for own stories\r\n */\r\n\"use client\"\r\n\r\nimport { useState, useEffect, useRef, useCallback } from \"react\"\r\nimport { motion, AnimatePresence } from \"framer-motion\"\r\nimport { X, ChevronLeft, ChevronRight, Eye, Trash2, MoreVertical, ChevronUp, Users } from \"lucide-react\"\r\nimport { cn } from \"@/lib/utils\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\"\r\nimport {\r\n    DropdownMenu,\r\n    DropdownMenuContent,\r\n    DropdownMenuItem,\r\n    DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\"\r\n\r\ninterface Story {\r\n    id: string\r\n    mediaUrl?: string\r\n    mediaType: string\r\n    text?: string\r\n    bgColor?: string\r\n    caption?: string\r\n    createdAt: string\r\n    hasViewed?: boolean\r\n}\r\n\r\ninterface StoryGroup {\r\n    user: {\r\n        id: string\r\n        name: string | null\r\n        image?: string | null\r\n        kabadiwalaProfile?: { businessName: string } | null\r\n    }\r\n    stories: Story[]\r\n    hasUnviewed: boolean\r\n}\r\n\r\ninterface Viewer {\r\n    id: string\r\n    viewedAt: string\r\n    viewer: {\r\n        id: string\r\n        name: string | null\r\n        image: string | null\r\n    }\r\n}\r\n\r\ninterface StoryViewerProps {\r\n    storyGroups: StoryGroup[]\r\n    initialGroupIndex: number\r\n    currentUserId?: string\r\n    onClose: () => void\r\n}\r\n\r\nexport function StoryViewer({ storyGroups, initialGroupIndex, currentUserId, onClose }: StoryViewerProps) {\r\n    const [currentGroupIndex, setCurrentGroupIndex] = useState(initialGroupIndex)\r\n    const [currentStoryIndex, setCurrentStoryIndex] = useState(0)\r\n    const [progress, setProgress] = useState(0)\r\n    const [isPaused, setIsPaused] = useState(false)\r\n    const [viewCount, setViewCount] = useState<number | null>(null)\r\n    const [viewers, setViewers] = useState<Viewer[]>([])\r\n    const [showViewers, setShowViewers] = useState(false)\r\n    // Use refs to track if component is mounted to prevent state updates after unmount\r\n    const isMounted = useRef(true)\r\n    const progressInterval = useRef<NodeJS.Timeout | null>(null)\r\n\r\n    const currentGroup = storyGroups[currentGroupIndex]\r\n    const currentStory = currentGroup?.stories[currentStoryIndex]\r\n    const isOwnStory = currentUserId === currentGroup?.user.id\r\n\r\n    const STORY_DURATION = 5000 // 5 seconds per story\r\n\r\n    useEffect(() => {\r\n        isMounted.current = true\r\n        return () => {\r\n            isMounted.current = false\r\n        }\r\n    }, [])\r\n\r\n    // Record view\r\n    useEffect(() => {\r\n        if (currentStory && !isOwnStory) {\r\n            // Use fire-and-forget for view recording\r\n            fetch(`/api/stories/${currentStory.id}/view`, { method: \"POST\", credentials: 'include' })\r\n                .catch(err => console.error(\"Failed to record view\", err))\r\n        }\r\n    }, [currentStory, isOwnStory])\r\n\r\n    // Load view count and viewers for own stories\r\n    useEffect(() => {\r\n        if (currentStory && isOwnStory) {\r\n            fetch(`/api/stories/${currentStory.id}/view`, { credentials: 'include' })\r\n                .then(res => res.json())\r\n                .then(data => {\r\n                    if (isMounted.current) {\r\n                        setViewCount(data.total || 0)\r\n                        setViewers(data.views || [])\r\n                    }\r\n                })\r\n                .catch(() => {\r\n                    if (isMounted.current) {\r\n                        setViewCount(null)\r\n                        setViewers([])\r\n                    }\r\n                })\r\n        } else {\r\n            setViewCount(null)\r\n            setViewers([])\r\n        }\r\n    }, [currentStory, isOwnStory])\r\n\r\n    // Navigate to next story\r\n    const goToNextStory = useCallback(() => {\r\n        if (currentStoryIndex < currentGroup.stories.length - 1) {\r\n            setCurrentStoryIndex(prev => prev + 1)\r\n            setProgress(0)\r\n            setShowViewers(false)\r\n        } else if (currentGroupIndex < storyGroups.length - 1) {\r\n            setCurrentGroupIndex(prev => prev + 1)\r\n            setCurrentStoryIndex(0)\r\n            setProgress(0)\r\n            setShowViewers(false)\r\n        } else {\r\n            // Defer onClose to avoid \"Cannot update component while rendering\"\r\n            setTimeout(() => {\r\n                if (isMounted.current) onClose()\r\n            }, 0)\r\n        }\r\n    }, [currentStoryIndex, currentGroupIndex, currentGroup?.stories.length, storyGroups.length, onClose])\r\n\r\n    // Progress timer\r\n    useEffect(() => {\r\n        if (isPaused || showViewers) return\r\n\r\n        progressInterval.current = setInterval(() => {\r\n            if (!isMounted.current) return\r\n\r\n            setProgress(prev => {\r\n                if (prev >= 100) {\r\n                    // Start transition to next story\r\n                    // Clear interval immediately to prevent multiple triggers\r\n                    if (progressInterval.current) clearInterval(progressInterval.current)\r\n                    goToNextStory()\r\n                    return 0\r\n                }\r\n                return prev + (100 / (STORY_DURATION / 100))\r\n            })\r\n        }, 100)\r\n\r\n        return () => {\r\n            if (progressInterval.current) clearInterval(progressInterval.current)\r\n        }\r\n    }, [currentStoryIndex, currentGroupIndex, isPaused, showViewers, goToNextStory])\r\n\r\n    const goToPrevStory = () => {\r\n        if (currentStoryIndex > 0) {\r\n            setCurrentStoryIndex(prev => prev - 1)\r\n            setProgress(0)\r\n            setShowViewers(false)\r\n        } else if (currentGroupIndex > 0) {\r\n            setCurrentGroupIndex(prev => prev - 1)\r\n            setCurrentStoryIndex(storyGroups[currentGroupIndex - 1].stories.length - 1)\r\n            setProgress(0)\r\n            setShowViewers(false)\r\n        }\r\n    }\r\n\r\n    const handleDelete = async () => {\r\n        if (!currentStory) return\r\n        try {\r\n            await fetch(`/api/stories/${currentStory.id}`, { method: \"DELETE\", credentials: 'include' })\r\n            goToNextStory()\r\n        } catch (error) {\r\n            console.error(\"Failed to delete story\")\r\n        }\r\n    }\r\n\r\n    const getDisplayName = () => {\r\n        if (currentGroup.user.kabadiwalaProfile?.businessName) {\r\n            return currentGroup.user.kabadiwalaProfile.businessName\r\n        }\r\n        return currentGroup.user.name || \"User\"\r\n    }\r\n\r\n    const getTimeAgo = (dateString: string) => {\r\n        const date = new Date(dateString)\r\n        const now = new Date()\r\n        const diff = now.getTime() - date.getTime()\r\n        const hours = Math.floor(diff / (1000 * 60 * 60))\r\n        if (hours < 1) {\r\n            const minutes = Math.floor(diff / (1000 * 60))\r\n            return `${minutes}m ago`\r\n        }\r\n        return `${hours}h ago`\r\n    }\r\n\r\n    if (!currentGroup || !currentStory) return null\r\n\r\n    return (\r\n        <AnimatePresence>\r\n            <motion.div\r\n                initial={{ opacity: 0 }}\r\n                animate={{ opacity: 1 }}\r\n                exit={{ opacity: 0 }}\r\n                className=\"fixed inset-0 z-50 bg-black flex items-center justify-center\"\r\n                onMouseDown={() => !showViewers && setIsPaused(true)}\r\n                onMouseUp={() => !showViewers && setIsPaused(false)}\r\n                onTouchStart={() => !showViewers && setIsPaused(true)}\r\n                onTouchEnd={() => !showViewers && setIsPaused(false)}\r\n            >\r\n                {/* Story Container */}\r\n                <div className=\"relative w-full h-full max-w-md mx-auto\">\r\n                    {/* Progress Bars */}\r\n                    <div className=\"absolute top-4 left-4 right-4 z-20 flex gap-1\">\r\n                        {currentGroup.stories.map((_, idx) => (\r\n                            <div key={idx} className=\"flex-1 h-1 bg-white/30 rounded-full overflow-hidden\">\r\n                                <div\r\n                                    className=\"h-full bg-white transition-all duration-100\"\r\n                                    style={{\r\n                                        width: idx === currentStoryIndex ? `${progress}%` :\r\n                                            idx < currentStoryIndex ? \"100%\" : \"0%\"\r\n                                    }}\r\n                                />\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Header */}\r\n                    <div className=\"absolute top-8 left-4 right-4 z-20 flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center text-white font-semibold\">\r\n                                {getDisplayName()[0]}\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-white font-semibold text-sm\">{getDisplayName()}</p>\r\n                                <p className=\"text-white/70 text-xs\">{getTimeAgo(currentStory.createdAt)}</p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            {isOwnStory && (\r\n                                <DropdownMenu>\r\n                                    <DropdownMenuTrigger asChild>\r\n                                        <Button variant=\"ghost\" size=\"icon\" className=\"text-white\">\r\n                                            <MoreVertical className=\"h-5 w-5\" />\r\n                                        </Button>\r\n                                    </DropdownMenuTrigger>\r\n                                    <DropdownMenuContent>\r\n                                        <DropdownMenuItem onClick={handleDelete} className=\"text-red-600\">\r\n                                            <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                                            Delete Story\r\n                                        </DropdownMenuItem>\r\n                                    </DropdownMenuContent>\r\n                                </DropdownMenu>\r\n                            )}\r\n                            <Button variant=\"ghost\" size=\"icon\" className=\"text-white\" onClick={onClose}>\r\n                                <X className=\"h-6 w-6\" />\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Story Content */}\r\n                    <div className=\"w-full h-full flex items-center justify-center\">\r\n                        {currentStory.mediaType === \"IMAGE\" && currentStory.mediaUrl ? (\r\n                            <img\r\n                                src={currentStory.mediaUrl}\r\n                                alt=\"Story\"\r\n                                className=\"w-full h-full object-contain\"\r\n                            />\r\n                        ) : (\r\n                            <div\r\n                                className=\"w-full h-full flex items-center justify-center p-8\"\r\n                                style={{ backgroundColor: currentStory.bgColor || \"#10b981\" }}\r\n                            >\r\n                                <p className=\"text-white text-2xl md:text-4xl font-bold text-center leading-relaxed\">\r\n                                    {currentStory.text}\r\n                                </p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Caption */}\r\n                    {currentStory.caption && (\r\n                        <div className=\"absolute bottom-20 left-4 right-4 z-20\">\r\n                            <p className=\"text-white text-center bg-black/50 px-4 py-2 rounded-lg\">\r\n                                {currentStory.caption}\r\n                            </p>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* View Count Button (own stories) - Opens viewers panel */}\r\n                    {isOwnStory && viewCount !== null && (\r\n                        <button\r\n                            onClick={() => setShowViewers(!showViewers)}\r\n                            className=\"absolute bottom-4 left-4 z-20 flex items-center gap-2 text-white/80 hover:text-white transition-colors bg-black/30 px-3 py-2 rounded-full\"\r\n                        >\r\n                            <Eye className=\"h-5 w-5\" />\r\n                            <span>{viewCount} {viewCount === 1 ? 'view' : 'views'}</span>\r\n                            <ChevronUp className={cn(\"h-4 w-4 transition-transform\", showViewers && \"rotate-180\")} />\r\n                        </button>\r\n                    )}\r\n\r\n                    {/* Viewers Panel (WhatsApp-like) */}\r\n                    <AnimatePresence>\r\n                        {showViewers && isOwnStory && (\r\n                            <motion.div\r\n                                initial={{ y: \"100%\" }}\r\n                                animate={{ y: 0 }}\r\n                                exit={{ y: \"100%\" }}\r\n                                transition={{ type: \"spring\", damping: 25, stiffness: 300 }}\r\n                                className=\"absolute bottom-0 left-0 right-0 z-30 bg-slate-900/95 backdrop-blur-xl rounded-t-3xl max-h-[60%] overflow-hidden\"\r\n                            >\r\n                                {/* Handle */}\r\n                                <div className=\"flex justify-center py-2\">\r\n                                    <div className=\"w-10 h-1 bg-white/30 rounded-full\" />\r\n                                </div>\r\n\r\n                                {/* Header */}\r\n                                <div className=\"flex items-center justify-between px-4 py-3 border-b border-white/10\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <Users className=\"h-5 w-5 text-white/70\" />\r\n                                        <span className=\"font-semibold text-white\">Viewers</span>\r\n                                        <span className=\"text-white/50 text-sm\">({viewCount})</span>\r\n                                    </div>\r\n                                    <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        className=\"text-white/70\"\r\n                                        onClick={() => setShowViewers(false)}\r\n                                    >\r\n                                        <X className=\"h-5 w-5\" />\r\n                                    </Button>\r\n                                </div>\r\n\r\n                                {/* Viewers List */}\r\n                                <div className=\"overflow-y-auto max-h-[40vh] p-2\">\r\n                                    {viewers.length === 0 ? (\r\n                                        <div className=\"text-center py-8 text-white/50\">\r\n                                            <Eye className=\"h-10 w-10 mx-auto mb-2 opacity-50\" />\r\n                                            <p>No views yet</p>\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div className=\"space-y-1\">\r\n                                            {viewers.map((view) => (\r\n                                                <div\r\n                                                    key={view.id}\r\n                                                    className=\"flex items-center gap-3 p-3 rounded-xl hover:bg-white/5 transition-colors\"\r\n                                                >\r\n                                                    <Avatar className=\"h-10 w-10\">\r\n                                                        {view.viewer?.image ? (\r\n                                                            <img src={view.viewer.image} alt=\"\" className=\"w-full h-full object-cover\" />\r\n                                                        ) : (\r\n                                                            <AvatarFallback className=\"bg-gradient-to-br from-primary to-primary/50 text-white\">\r\n                                                                {view.viewer?.name?.[0] || '?'}\r\n                                                            </AvatarFallback>\r\n                                                        )}\r\n                                                    </Avatar>\r\n                                                    <div className=\"flex-1\">\r\n                                                        <p className=\"font-medium text-white\">\r\n                                                            {view.viewer?.name || 'Unknown User'}\r\n                                                        </p>\r\n                                                        <p className=\"text-xs text-white/50\">\r\n                                                            {getTimeAgo(view.viewedAt)}\r\n                                                        </p>\r\n                                                    </div>\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </motion.div>\r\n                        )}\r\n                    </AnimatePresence>\r\n\r\n                    {/* Navigation */}\r\n                    <button\r\n                        onClick={goToPrevStory}\r\n                        className=\"absolute left-0 top-0 bottom-0 w-1/3 z-10\"\r\n                        aria-label=\"Previous story\"\r\n                    />\r\n                    <button\r\n                        onClick={goToNextStory}\r\n                        className=\"absolute right-0 top-0 bottom-0 w-2/3 z-10\"\r\n                        aria-label=\"Next story\"\r\n                    />\r\n\r\n                    {/* Side Navigation Arrows (Desktop) */}\r\n                    <button\r\n                        onClick={goToPrevStory}\r\n                        className={cn(\r\n                            \"absolute left-2 top-1/2 -translate-y-1/2 z-20 p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors hidden md:block\",\r\n                            currentGroupIndex === 0 && currentStoryIndex === 0 && \"invisible\"\r\n                        )}\r\n                    >\r\n                        <ChevronLeft className=\"h-6 w-6\" />\r\n                    </button>\r\n                    <button\r\n                        onClick={goToNextStory}\r\n                        className=\"absolute right-2 top-1/2 -translate-y-1/2 z-20 p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors hidden md:block\"\r\n                    >\r\n                        <ChevronRight className=\"h-6 w-6\" />\r\n                    </button>\r\n                </div>\r\n            </motion.div>\r\n        </AnimatePresence>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\stories\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\sonner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\components\\user-tracker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'locAccess' is assigned a value but never used.","line":28,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_e' is defined but never used.","line":34,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":51,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * User Tracker Component\r\n * ----------------------\r\n * Background telemetry component that tracks user permissions.\r\n * Collects:\r\n * - GPS location (latitude/longitude)\r\n * - Camera permission status\r\n * - Location permission status\r\n * \r\n * Syncs to server every 2 minutes via /api/user/telemetry.\r\n * Used by Admin Panel's Insights page for location tracking.\r\n */\r\n\"use client\"\r\n\r\nimport { useEffect } from \"react\"\r\nimport { useSession } from \"next-auth/react\"\r\n\r\nexport function UserTracker() {\r\n    const { data: session } = useSession()\r\n\r\n    useEffect(() => {\r\n        if (!session?.user) return\r\n\r\n        const checkPermissionsAndSync = async () => {\r\n            let lat: number | null = null\r\n            let lng: number | null = null\r\n            let camAccess = false\r\n            let locAccess = false\r\n\r\n            // 1. Check Camera Permission\r\n            try {\r\n                const camStatus = await navigator.permissions.query({ name: 'camera' as PermissionName })\r\n                camAccess = camStatus.state === 'granted'\r\n            } catch (_e) {\r\n                // Ignore if not supported\r\n            }\r\n\r\n            // 2. Check/Request Location Permission\r\n            if (\"geolocation\" in navigator) {\r\n                navigator.permissions.query({ name: 'geolocation' }).then(async (result) => {\r\n                    locAccess = result.state === 'granted'\r\n\r\n                    if (result.state === 'granted' || result.state === 'prompt') {\r\n                        navigator.geolocation.getCurrentPosition(\r\n                            (position) => {\r\n                                lat = position.coords.latitude\r\n                                lng = position.coords.longitude\r\n                                locAccess = true\r\n                                sendTelemetry(lat, lng, camAccess, true)\r\n                            },\r\n                            (_error) => {\r\n                                sendTelemetry(null, null, camAccess, false)\r\n                            }\r\n                        )\r\n                    } else {\r\n                        sendTelemetry(null, null, camAccess, false)\r\n                    }\r\n                })\r\n            } else {\r\n                sendTelemetry(null, null, camAccess, false)\r\n            }\r\n        }\r\n\r\n        const sendTelemetry = async (lat: number | null, lng: number | null, cam: boolean, loc: boolean) => {\r\n            try {\r\n                await fetch(\"/api/user/telemetry\", {\r\n                    method: \"POST\",\r\n                    headers: { \"Content-Type\": \"application/json\" },\r\n                    body: JSON.stringify({\r\n                        latitude: lat,\r\n                        longitude: lng,\r\n                        cameraAccess: cam,\r\n                        locationAccess: loc\r\n                    })\r\n                })\r\n            } catch (error) {\r\n                console.error(\"Telemetry sync failed\", error)\r\n            }\r\n        }\r\n\r\n        // Run on mount and every 2 minutes\r\n        checkPermissionsAndSync()\r\n        const interval = setInterval(checkPermissionsAndSync, 120000)\r\n\r\n        return () => clearInterval(interval)\r\n    }, [session])\r\n\r\n    return null // Invisible component\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\lib\\db.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\lib\\mail.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\lib\\notifications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\lib\\scrap-categories.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\lib\\security.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\lib\\verification.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\src\\types\\next-auth.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\test-api.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\test-db.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":51}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nconst { PrismaClient } = require('@prisma/client')\r\nconst prisma = new PrismaClient()\r\n\r\nasync function main() {\r\n    try {\r\n        console.log(\"Connecting to DB...\")\r\n        const count = await prisma.user.count()\r\n        console.log(\"User count:\", count)\r\n        const featured = await prisma.kabadiwalaProfile.findMany({\r\n            take: 1\r\n        })\r\n        console.log(\"Featured query success:\", featured.length)\r\n    } catch (e) {\r\n        console.error(\"DB Error:\", e)\r\n    } finally {\r\n        await prisma.$disconnect()\r\n    }\r\n}\r\n\r\nmain()\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\edrivekabadi\\kabadiwala\\verify-env.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":27,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":47}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nconst { loadEnvConfig } = require('@next/env')\r\n\r\nconst projectDir = process.cwd()\r\nloadEnvConfig(projectDir)\r\n\r\nif (process.env.AUTH_SECRET) {\r\n    console.log(\"AUTH_SECRET is set (Length: \" + process.env.AUTH_SECRET.length + \")\")\r\n} else {\r\n    console.log(\"AUTH_SECRET is MISSING in environment!\")\r\n}\r\n\r\nif (process.env.DATABASE_URL) {\r\n    console.log(\"DATABASE_URL is set.\")\r\n} else {\r\n    console.log(\"DATABASE_URL is MISSING!\")\r\n}\r\n","usedDeprecatedRules":[]}]